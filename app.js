!function($global){"use strict";function $extend(e,t){function n(){}n.prototype=e;var a=new n;for(var r in t)a[r]=t[r];return t.toString!==Object.prototype.toString&&(a.toString=t.toString),a}function $iterator(e){return e instanceof Array?function(){return HxOverrides.iter(e)}:"function"==typeof e.iterator?$bind(e,e.iterator):e.iterator}function $bind(e,t){if(null==t)return null;null==t.__id__&&(t.__id__=$fid++);var n;return null==e.hx__closures__?e.hx__closures__={}:n=e.hx__closures__[t.__id__],null==n&&(n=function(){return n.method.apply(n.scope,arguments)},n.scope=e,n.method=t,e.hx__closures__[t.__id__]=n),n}var $estr=function(){return js_Boot.__string_rec(this,"")},DateTools=function(){};DateTools.__name__=["DateTools"],DateTools.__format_get=function(e,t){switch(t){case"%":return"%";case"A":return DateTools.DAY_NAMES[e.getDay()];case"B":return DateTools.MONTH_NAMES[e.getMonth()];case"C":return StringTools.lpad(Std.string(e.getFullYear()/100|0),"0",2);case"D":return DateTools.__format(e,"%m/%d/%y");case"F":return DateTools.__format(e,"%Y-%m-%d");case"I":case"l":var n=e.getHours()%12;return StringTools.lpad(Std.string(0==n?12:n),"I"==t?"0":" ",2);case"M":return StringTools.lpad(Std.string(e.getMinutes()),"0",2);case"R":return DateTools.__format(e,"%H:%M");case"S":return StringTools.lpad(Std.string(e.getSeconds()),"0",2);case"T":return DateTools.__format(e,"%H:%M:%S");case"Y":return Std.string(e.getFullYear());case"a":return DateTools.DAY_SHORT_NAMES[e.getDay()];case"b":case"h":return DateTools.MONTH_SHORT_NAMES[e.getMonth()];case"d":return StringTools.lpad(Std.string(e.getDate()),"0",2);case"e":return Std.string(e.getDate());case"H":case"k":return StringTools.lpad(Std.string(e.getHours()),"H"==t?"0":" ",2);case"m":return StringTools.lpad(Std.string(e.getMonth()+1),"0",2);case"n":return"\n";case"p":return e.getHours()>11?"PM":"AM";case"r":return DateTools.__format(e,"%I:%M:%S %p");case"s":return Std.string(e.getTime()/1e3|0);case"t":return"\t";case"u":var a=e.getDay();return 0==a?"7":null==a?"null":""+a;case"w":return Std.string(e.getDay());case"y":return StringTools.lpad(Std.string(e.getFullYear()%100),"0",2);default:throw new js__$Boot_HaxeError("Date.format %"+t+"- not implemented yet.")}},DateTools.__format=function(e,t){for(var n="",a=0;;){var r=t.indexOf("%",a);if(r<0)break;var i=r-a;n+=null==i?HxOverrides.substr(t,a,null):HxOverrides.substr(t,a,i),n+=Std.string(DateTools.__format_get(e,HxOverrides.substr(t,r+1,1))),a=r+2}var o=t.length-a;return n+=null==o?HxOverrides.substr(t,a,null):HxOverrides.substr(t,a,o)},DateTools.format=function(e,t){return DateTools.__format(e,t)};var EReg=function(e,t){this.r=new RegExp(e,t.split("u").join(""))};EReg.__name__=["EReg"],EReg.prototype={r:null,match:function(e){return this.r.global&&(this.r.lastIndex=0),this.r.m=this.r.exec(e),this.r.s=e,null!=this.r.m},__class__:EReg};var HxOverrides=function(){};HxOverrides.__name__=["HxOverrides"],HxOverrides.strDate=function(e){var t=e.length;switch(t){case 8:var n=e.split(":"),a=new Date;return a.setTime(0),a.setUTCHours(n[0]),a.setUTCMinutes(n[1]),a.setUTCSeconds(n[2]),a;case 10:var r=e.split("-");return new Date(r[0],r[1]-1,r[2],0,0,0);case 19:var i=e.split(" "),o=i[0].split("-"),s=i[1].split(":");return new Date(o[0],o[1]-1,o[2],s[0],s[1],s[2]);default:throw new js__$Boot_HaxeError("Invalid date format : "+e)}},HxOverrides.cca=function(e,t){var n=e.charCodeAt(t);if(n==n)return n},HxOverrides.substr=function(e,t,n){if(null==n)n=e.length;else if(n<0){if(0!=t)return"";n=e.length+n}return e.substr(t,n)},HxOverrides.remove=function(e,t){var n=e.indexOf(t);return n!=-1&&(e.splice(n,1),!0)},HxOverrides.iter=function(e){return{cur:0,arr:e,hasNext:function(){return this.cur<this.arr.length},next:function(){return this.arr[this.cur++]}}};var Lambda=function(){};Lambda.__name__=["Lambda"],Lambda.array=function(e){for(var t=[],n=$iterator(e)();n.hasNext();){var a=n.next();t.push(a)}return t},Lambda.has=function(e,t){for(var n=$iterator(e)();n.hasNext();){var a=n.next();if(a==t)return!0}return!1},Lambda.exists=function(e,t){for(var n=$iterator(e)();n.hasNext();){var a=n.next();if(t(a))return!0}return!1},Lambda.filter=function(e,t){for(var n=new List,a=$iterator(e)();a.hasNext();){var r=a.next();t(r)&&n.add(r)}return n},Lambda.count=function(e,t){var n=0;if(null==t)for(var a=$iterator(e)();a.hasNext();){a.next();++n}else for(var r=$iterator(e)();r.hasNext();){var i=r.next();t(i)&&++n}return n};var List=function(){this.length=0};List.__name__=["List"],List.prototype={h:null,q:null,length:null,add:function(e){var t=new _$List_ListNode(e,null);null==this.h?this.h=t:this.q.next=t,this.q=t,this.length++},iterator:function(){return new _$List_ListIterator(this.h)},__class__:List};var _$List_ListNode=function(e,t){this.item=e,this.next=t};_$List_ListNode.__name__=["_List","ListNode"],_$List_ListNode.prototype={item:null,next:null,__class__:_$List_ListNode};var _$List_ListIterator=function(e){this.head=e};_$List_ListIterator.__name__=["_List","ListIterator"],_$List_ListIterator.prototype={head:null,hasNext:function(){return null!=this.head},next:function(){var e=this.head.item;return this.head=this.head.next,e},__class__:_$List_ListIterator},Math.__name__=["Math"];var Outline=function(){};Outline.__name__=["Outline"],Outline.giftWrap=function(e){for(var t=e[0],n=0;n<e.length;){var a=e[n];++n,a.a<t.a&&(t=a)}for(var r=[];;){if(r.push(t)>e.length)return r;for(var i=e[0],o=0;o<e.length;){var s=e[o];++o,(i==t||(i.a-t.a)*(s.b-t.b)>(i.b-t.b)*(s.a-t.a))&&(i=s)}if(t=i,t==r[0])break}return r.push(r[0]),r},Outline.of=function(e){if(e.length<2)return[];var t,n=e[0],a=e[e.length-1],r=new tink_core_MPair(a.a-n.a,a.b-n.b);t=r;var i,o=t,s=1/Math.sqrt(o.a*o.a+o.b*o.b),l=new tink_core_MPair(o.a*s,o.b*s);i=l;for(var _=i,u=tink_geom2__$Matrix_Matrix_$Impl_$.transformPoint(Outline.cw,_),c=0,d=0;d<e.length;){var p=e[d];++d;var h,g=new tink_core_MPair(p.a-n.a,p.b-n.b);h=g;var m=h;if(c=Math.max(Math.abs(u.a*m.a+u.b*m.b),c),c>5)break}if(c<5){var v,f=new tink_core_MPair(25*_.a,25*_.b);v=f;var $,b=v,w=new tink_core_MPair(n.a-b.a,n.b-b.b);$=w;var k,y=new tink_core_MPair(25*u.a,25*u.b);k=y;var x,C=k,D=new tink_core_MPair(n.a+C.a,n.b+C.b);x=D;var S,I=new tink_core_MPair(25*u.a,25*u.b);S=I;var T,M=S,A=new tink_core_MPair(a.a+M.a,a.b+M.b);T=A;var L,E=new tink_core_MPair(25*_.a,25*_.b);L=E;var H,P=L,N=new tink_core_MPair(a.a+P.a,a.b+P.b);H=N;var O,B=new tink_core_MPair(25*u.a,25*u.b);O=B;var R,F=O,q=new tink_core_MPair(a.a-F.a,a.b-F.b);R=q;var z,j=new tink_core_MPair(25*u.a,25*u.b);z=j;var X,V=z,W=new tink_core_MPair(n.a-V.a,n.b-V.b);X=W;var U,Q=new tink_core_MPair(25*_.a,25*_.b);U=Q;var Y,G=U,J=new tink_core_MPair(n.a-G.a,n.b-G.b);return Y=J,[$,x,T,H,R,X,Y]}var K=Outline.giftWrap(e);K.push(K[1]);for(var Z=[],ee=1,te=K.length-1;ee<te;){var ne,ae=ee++,re=K[ae],ie=K[ae-1],oe=new tink_core_MPair(re.a-ie.a,re.b-ie.b);ne=oe;var se,le=ne,_e=1/Math.sqrt(le.a*le.a+le.b*le.b),ue=new tink_core_MPair(le.a*_e,le.b*_e);se=ue;var ce,de=se,pe=K[ae+1],he=new tink_core_MPair(re.a-pe.a,re.b-pe.b);ce=he;var ge,me=ce,ve=1/Math.sqrt(me.a*me.a+me.b*me.b),fe=new tink_core_MPair(me.a*ve,me.b*ve);ge=fe;var $e,be=ge,we=new tink_core_MPair(de.a+be.a,de.b+be.b);$e=we;var ke,ye=[$e],xe=new tink_core_MPair(de.a-be.a,de.b-be.b);ke=xe;var Ce=ke;Math.sqrt(Ce.a*Ce.a+Ce.b*Ce.b)<Outline.sq2&&(ye.push(tink_geom2__$Matrix_Matrix_$Impl_$.transformPoint(Outline.ccw,de)),ye.unshift(tink_geom2__$Matrix_Matrix_$Impl_$.transformPoint(Outline.cw,be)));for(var De=0;De<ye.length;){var Se=ye[De];++De;var Ie,Te=25/Math.sqrt(Se.a*Se.a+Se.b*Se.b),Me=new tink_core_MPair(Se.a*Te,Se.b*Te);Ie=Me;var Ae,Le=Ie,Ee=new tink_core_MPair(re.a+Le.a,re.b+Le.b);Ae=Ee;var He=Ae;isNaN(He.a)||Z.push(He)}}return Outline.giftWrap(Z)};var Reflect=function(){};Reflect.__name__=["Reflect"],Reflect.field=function(e,t){try{return e[t]}catch(n){return null}},Reflect.fields=function(e){var t=[];if(null!=e){var n=Object.prototype.hasOwnProperty;for(var a in e)"__id__"!=a&&"hx__closures__"!=a&&n.call(e,a)&&t.push(a)}return t},Reflect.isObject=function(e){if(null==e)return!1;var t=typeof e;return"string"==t||"object"==t&&null==e.__enum__||"function"==t&&null!=(e.__name__||e.__ename__)},Reflect.copy=function(e){for(var t={},n=0,a=Reflect.fields(e);n<a.length;){var r=a[n];++n,t[r]=Reflect.field(e,r)}return t};var Std=function(){};Std.__name__=["Std"],Std.string=function(e){return js_Boot.__string_rec(e,"")},Std.parseInt=function(e){var t=parseInt(e,10);return 0!=t||120!=HxOverrides.cca(e,1)&&88!=HxOverrides.cca(e,1)||(t=parseInt(e)),isNaN(t)?null:t},Std.random=function(e){return e<=0?0:Math.floor(Math.random()*e)};var StringBuf=function(){this.b=""};StringBuf.__name__=["StringBuf"],StringBuf.prototype={b:null,__class__:StringBuf};var StringTools=function(){};StringTools.__name__=["StringTools"],StringTools.startsWith=function(e,t){return e.length>=t.length&&HxOverrides.substr(e,0,t.length)==t},StringTools.isSpace=function(e,t){var n=HxOverrides.cca(e,t);return n>8&&n<14||32==n},StringTools.ltrim=function(e){for(var t=e.length,n=0;n<t&&StringTools.isSpace(e,n);)++n;return n>0?HxOverrides.substr(e,n,t-n):e},StringTools.rtrim=function(e){for(var t=e.length,n=0;n<t&&StringTools.isSpace(e,t-n-1);)++n;return n>0?HxOverrides.substr(e,0,t-n):e},StringTools.trim=function(e){return StringTools.ltrim(StringTools.rtrim(e))},StringTools.lpad=function(e,t,n){if(t.length<=0)return e;for(;e.length<n;)e=t+e;return e},StringTools.replace=function(e,t,n){return e.split(t).join(n)};var ValueType={__ename__:!0,__constructs__:["TNull","TInt","TFloat","TBool","TObject","TFunction","TClass","TEnum","TUnknown"]};ValueType.TNull=["TNull",0],ValueType.TNull.toString=$estr,ValueType.TNull.__enum__=ValueType,ValueType.TInt=["TInt",1],ValueType.TInt.toString=$estr,ValueType.TInt.__enum__=ValueType,ValueType.TFloat=["TFloat",2],ValueType.TFloat.toString=$estr,ValueType.TFloat.__enum__=ValueType,ValueType.TBool=["TBool",3],ValueType.TBool.toString=$estr,ValueType.TBool.__enum__=ValueType,ValueType.TObject=["TObject",4],ValueType.TObject.toString=$estr,ValueType.TObject.__enum__=ValueType,ValueType.TFunction=["TFunction",5],ValueType.TFunction.toString=$estr,ValueType.TFunction.__enum__=ValueType,ValueType.TClass=function(e){var t=["TClass",6,e];return t.__enum__=ValueType,t.toString=$estr,t},ValueType.TEnum=function(e){var t=["TEnum",7,e];return t.__enum__=ValueType,t.toString=$estr,t},ValueType.TUnknown=["TUnknown",8],ValueType.TUnknown.toString=$estr,ValueType.TUnknown.__enum__=ValueType;var Type=function(){};Type.__name__=["Type"],Type.getClassName=function(e){var t=e.__name__;return null==t?null:t.join(".")},Type.getInstanceFields=function(e){var t=[];for(var n in e.prototype)t.push(n);return HxOverrides.remove(t,"__class__"),HxOverrides.remove(t,"__properties__"),t},Type["typeof"]=function(e){var t=typeof e;switch(t){case"boolean":return ValueType.TBool;case"function":return e.__name__||e.__ename__?ValueType.TObject:ValueType.TFunction;case"number":return Math.ceil(e)==e%2147483648?ValueType.TInt:ValueType.TFloat;case"object":if(null==e)return ValueType.TNull;var n=e.__enum__;if(null!=n)return ValueType.TEnum(n);var a=js_Boot.getClass(e);return null!=a?ValueType.TClass(a):ValueType.TObject;case"string":return ValueType.TClass(String);case"undefined":return ValueType.TNull;default:return ValueType.TUnknown}};var Xml=function(e){this.nodeType=e,this.children=[],this.attributeMap=new haxe_ds_StringMap};Xml.__name__=["Xml"],Xml.parse=function(e){return haxe_xml_Parser.parse(e)},Xml.createElement=function(e){var t=new Xml(Xml.Element);if(t.nodeType!=Xml.Element)throw new js__$Boot_HaxeError("Bad node type, expected Element but found "+t.nodeType);return t.nodeName=e,t},Xml.createPCData=function(e){var t=new Xml(Xml.PCData);if(t.nodeType==Xml.Document||t.nodeType==Xml.Element)throw new js__$Boot_HaxeError("Bad node type, unexpected "+t.nodeType);return t.nodeValue=e,t},Xml.createCData=function(e){var t=new Xml(Xml.CData);if(t.nodeType==Xml.Document||t.nodeType==Xml.Element)throw new js__$Boot_HaxeError("Bad node type, unexpected "+t.nodeType);return t.nodeValue=e,t},Xml.createComment=function(e){var t=new Xml(Xml.Comment);if(t.nodeType==Xml.Document||t.nodeType==Xml.Element)throw new js__$Boot_HaxeError("Bad node type, unexpected "+t.nodeType);return t.nodeValue=e,t},Xml.createDocType=function(e){var t=new Xml(Xml.DocType);if(t.nodeType==Xml.Document||t.nodeType==Xml.Element)throw new js__$Boot_HaxeError("Bad node type, unexpected "+t.nodeType);return t.nodeValue=e,t},Xml.createProcessingInstruction=function(e){var t=new Xml(Xml.ProcessingInstruction);if(t.nodeType==Xml.Document||t.nodeType==Xml.Element)throw new js__$Boot_HaxeError("Bad node type, unexpected "+t.nodeType);return t.nodeValue=e,t},Xml.createDocument=function(){return new Xml(Xml.Document)},Xml.prototype={nodeType:null,nodeName:null,nodeValue:null,parent:null,children:null,attributeMap:null,get:function(e){if(this.nodeType!=Xml.Element)throw new js__$Boot_HaxeError("Bad node type, expected Element but found "+this.nodeType);var t=this.attributeMap;return null!=__map_reserved[e]?t.getReserved(e):t.h[e]},set:function(e,t){if(this.nodeType!=Xml.Element)throw new js__$Boot_HaxeError("Bad node type, expected Element but found "+this.nodeType);var n=this.attributeMap;null!=__map_reserved[e]?n.setReserved(e,t):n.h[e]=t},exists:function(e){if(this.nodeType!=Xml.Element)throw new js__$Boot_HaxeError("Bad node type, expected Element but found "+this.nodeType);var t=this.attributeMap;return null!=__map_reserved[e]?t.existsReserved(e):t.h.hasOwnProperty(e)},elementsNamed:function(e){if(this.nodeType!=Xml.Document&&this.nodeType!=Xml.Element)throw new js__$Boot_HaxeError("Bad node type, expected Element or Document but found "+this.nodeType);for(var t=[],n=0,a=this.children;n<a.length;){var r=a[n];++n;var i;if(r.nodeType==Xml.Element){if(r.nodeType!=Xml.Element)throw new js__$Boot_HaxeError("Bad node type, expected Element but found "+r.nodeType);i=r.nodeName==e}else i=!1;i&&t.push(r)}var o=t;return HxOverrides.iter(o)},firstElement:function(){if(this.nodeType!=Xml.Document&&this.nodeType!=Xml.Element)throw new js__$Boot_HaxeError("Bad node type, expected Element or Document but found "+this.nodeType);for(var e=0,t=this.children;e<t.length;){var n=t[e];if(++e,n.nodeType==Xml.Element)return n}return null},addChild:function(e){if(this.nodeType!=Xml.Document&&this.nodeType!=Xml.Element)throw new js__$Boot_HaxeError("Bad node type, expected Element or Document but found "+this.nodeType);null!=e.parent&&e.parent.removeChild(e),this.children.push(e),e.parent=this},removeChild:function(e){if(this.nodeType!=Xml.Document&&this.nodeType!=Xml.Element)throw new js__$Boot_HaxeError("Bad node type, expected Element or Document but found "+this.nodeType);return!!HxOverrides.remove(this.children,e)&&(e.parent=null,!0)},__class__:Xml};var api_EventEmitter=function(){};api_EventEmitter.__name__=["api","EventEmitter"];var api_Runtime=function(){};api_Runtime.__name__=["api","Runtime"],api_Runtime.__interfaces__=[api_EventEmitter],api_Runtime.prototype={isFullscreen:null,isOnline:null,setFullscreen:null,isStandalone:null,isBookShelf:null,onClose:null,exit:null,storage:null,getInstalledArchives:null,handleLink:null,login:null,isLoggedIn:null,getUserSsoData:null,__class__:api_Runtime};var api_storage_DataStore=function(){};api_storage_DataStore.__name__=["api","storage","DataStore"],api_storage_DataStore.__interfaces__=[api_EventEmitter],api_storage_DataStore.prototype={get:null,set:null,keys:null,__class__:api_storage_DataStore};var api_storage_Provider=function(){};api_storage_Provider.__name__=["api","storage","Provider"],api_storage_Provider.prototype={forProduct:null,__class__:api_storage_Provider};var api_storage_Storage=function(){};api_storage_Storage.__name__=["api","storage","Storage"],api_storage_Storage.prototype={dataStore:null,__class__:api_storage_Storage};var dua__$Bookmarks_Bookmark_$Impl_$={};dua__$Bookmarks_Bookmark_$Impl_$.__name__=["dua","_Bookmarks","Bookmark_Impl_"],dua__$Bookmarks_Bookmark_$Impl_$.get_text=function(e){return dua_annotations__$Data_AnnotationContent_$Impl_$.getData(e.annotationContent)},dua__$Bookmarks_Bookmark_$Impl_$.set_text=function(e,t){return e.annotationContent=dua_annotations__$Data_AnnotationContent_$Impl_$.ofData(t),e.dirty=!0,t},dua__$Bookmarks_Bookmark_$Impl_$.get_guid=function(e){var t=e.annotationPosition;return HxOverrides.substr(t,t.indexOf(":")+1,null)},dua__$Bookmarks_Bookmark_$Impl_$.get_page=function(e){return Std.parseInt(e.annotationPosition)},dua__$Bookmarks_Bookmark_$Impl_$._new=function(e){var t={annotationId:"",annotationTypeId:"dua_bookmark",readOnly:!1,dirty:!0,annotationPosition:dua_annotations__$Data_AnnotationPosition_$Impl_$.ofObject({page:e,guid:utils_GUID.create()}),annotationContent:dua_annotations__$Data_AnnotationContent_$Impl_$.ofData("")};return t};var dua_Bookmarks=function(e){this.app=e,this.store=dua_annotations_AnnotationStore.getInstance(),this.bookmarks=[],this.layer=pagr_Dom.query(".bookmarks",pagr_Windows.get("bookmarks"))[0],pagr__$Dom_Query_$Impl_$.on(".window.bookmarks .add","click",null,tink_core__$Callback_Callback_$Impl_$.fromNiladic($bind(this,this.addBookmark))),pagr__$Dom_Query_$Impl_$.on(".window.bookmarks .edit","click",null,$bind(this,this.editBookmark)),pagr__$Dom_Query_$Impl_$.on(".window.bookmarks .delete","click",null,$bind(this,this.deleteBookmark)),pagr__$Dom_Query_$Impl_$.on(".window.bookmarks textarea","change",null,$bind(this,this.changeText)),this.store.get_synced().handle(tink_core__$Callback_Callback_$Impl_$.fromNiladic($bind(this,this.refreshAll)))};dua_Bookmarks.__name__=["dua","Bookmarks"],dua_Bookmarks.prototype={app:null,store:null,bookmarks:null,layer:null,refreshAll:function(){this.bookmarks=this.store.find(function(e,t){return"dua_bookmark"==t.annotationTypeId}),this.layer.innerHTML=this.bookmarks.map($bind(this,this.render)).join("")},getBookmark:function(e){e=pagr_Dom.nearest(e,"[data-guid]");for(var t=e.getAttribute("data-guid"),n=0,a=this.bookmarks;n<a.length;){var r=a[n];if(++n,dua__$Bookmarks_Bookmark_$Impl_$.get_guid(r)==t)return r}throw new js__$Boot_HaxeError("assert")},editBookmark:function(e){var t=this.getView(this.getBookmark(e.at)),n=pagr_Dom.query("textarea",t)[0];n.focus()},deleteBookmark:function(e){var t=this.getBookmark(e.at);HxOverrides.remove(this.bookmarks,t),this.layer.removeChild(this.getView(t)),this.store.softDelete(t)},changeText:function(e){var t=this.getBookmark(e.at);dua__$Bookmarks_Bookmark_$Impl_$.set_text(t,e.at.value),this.store.set(t)},getView:function(e){return pagr_Dom.query('.bookmark[data-guid="'+dua__$Bookmarks_Bookmark_$Impl_$.get_guid(e)+'"]')[0]},addBookmark:function(){var e=dua__$Bookmarks_Bookmark_$Impl_$._new(this.app.get_page());this.bookmarks.push(e),this.store.add(e),this.addView(e)},addView:function(e){var t=pagr_Dom.getElement(this.render(e));return this.layer.appendChild(t),t},render:function(e){var t=tink_template__$Html_Html_$Impl_$.buffer(),n="\r\n";t.s+=n;var a='<div class="bookmark" data-guid="';t.s+=a;var r=tink_template__$Html_Html_$Impl_$.escape(dua__$Bookmarks_Bookmark_$Impl_$.get_guid(e));t.s+=r;var i='">\r\n\t';t.s+=i;var o=dua__$Bookmarks_Bookmark_$Impl_$.get_page(e)-dua__$Bookmarks_Bookmark_$Impl_$.get_page(e)%2,s='\r\n\t<div class="data">\r\n    <div class="thumbs">\r\n      ';t.s+=s;var l=this.thumb(o,this.app.get_page());t.s+=l;var _="\r\n      ";t.s+=_;var u=this.thumb(o+1,this.app.get_page());t.s+=u;var c='\r\n      <a class="clickarea left" href="?page=';t.s+=c;var d=tink_template__$Html_Html_$Impl_$.of(o);t.s+=d;var p='"></a>\r\n      <a class="clickarea right" href="?page=';t.s+=p;var h=tink_template__$Html_Html_$Impl_$.of(o+1);t.s+=h;var g='"></a>\r\n    </div>\r\n    <textarea>';t.s+=g;var m=tink_template__$Html_Html_$Impl_$.escape(dua__$Bookmarks_Bookmark_$Impl_$.get_text(e));t.s+=m;var v='</textarea>\r\n\t</div>\r\n\t<div class="controls">\r\n\t  <button class="delete"><i class="fa fa-trash"></i></button>\r\n\t  <button class="edit"><i class="fa dua-pencil"></i></button>\r\n\t</div>\r\n  </div>\r\n\r\n';t.s+=v;var f=t.s;return f},thumb:function(e,t){var n=tink_template__$Html_Html_$Impl_$.buffer(),a="\r\n";n.s+=a;var r='<button class="selected-page" data-page="';n.s+=r;var i=tink_template__$Html_Html_$Impl_$.of(e);n.s+=i;var o='">\r\n  <!-- <button class="selected-page';if(n.s+=o,e==t){var s=" selected";n.s+=s}var l='" data-page="';n.s+=l;var _=tink_template__$Html_Html_$Impl_$.of(e);n.s+=_;var u='"> -->\r\n\t<a href="?page=';n.s+=u;var c=tink_template__$Html_Html_$Impl_$.of(e);n.s+=c;var d='">';n.s+=d;var p=this.app.pages.renderThumb(e);n.s+=p;var h="</a>\r\n\t<label>";n.s+=h;var g=tink_template__$Html_Html_$Impl_$.escape(this.app.pages.getTitle(e));n.s+=g;var m="</label>\r\n  </button>\r\n";n.s+=m;var v=n.s;return v},__class__:dua_Bookmarks};var pagr_Dom=function(){};pagr_Dom.__name__=["pagr","Dom"],pagr_Dom.getElement=function(e){return pagr_Dom.helper.innerHTML=e,pagr_Dom.helper.firstElementChild},pagr_Dom.nearest=function(e,t){return pagr_Dom.parents(e,t)[0]},pagr_Dom.parents=function(e,t){for(var n=[];null!=e;)null!=$bind(e,e.matches)&&e.matches(t)&&n.push(e),e=null!=e.parentElement?e.parentElement:e.parentNode;return n},pagr_Dom.transform=function(e,t){e.style.transform=t},pagr_Dom.toggleFullScreen=function(e,t){pagr_App.runtime.setFullscreen(t)},pagr_Dom.isFullscreen=function(e){return pagr_App.runtime.isFullscreen()},pagr_Dom.query=function(e,t){if(null==t)return window.document.querySelectorAll(e);var n,a=t.id;if(null==a)if(window.document.documentElement.contains(t)){for(var r=t,i=[];r!=window.document.documentElement;){var o=r.tagName.toLowerCase();r=r.parentElement,i.push(o)}var s=i;s.reverse(),n=s.join(">")}else n="#"+(t.id="_hx_"+pagr_Dom.counter++);else if(""==a)if(window.document.documentElement.contains(t)){for(var l=t,_=[];l!=window.document.documentElement;){var u=l.tagName.toLowerCase();l=l.parentElement,_.push(u)}var c=_;c.reverse(),n=c.join(">")}else n="#"+(t.id="_hx_"+pagr_Dom.counter++);else{var d=a;n="#"+d}var p=t.querySelectorAll(""+n+" "+e);return p},pagr_Dom.once=function(e,t,n){var a=null;return a=pagr_Dom.on(e,t,null,function(e){n(e),null!=a&&a.dissolve()})},pagr_Dom.on=function(e,t,n,a){if(null==n&&(n=!1),null==e){var r=new tink_core__$Callback_SimpleLink(function(){});return r}for(var i=function(e){a(e)},o=function(){for(var a=0,r=t.split(" ");a<r.length;){var o=r[a];++a,e.removeEventListener(o,i,n)}},s=0,l=t.split(" ");s<l.length;){var _=l[s];++s,e.addEventListener(_,i,n)}var u=new tink_core__$Callback_SimpleLink(o);return u},pagr_Dom.es5ify=function(o){for(var ret={},accessors=new haxe_ds_StringMap,get=function(e){var t=HxOverrides.substr(e,4,null);if(!(null!=__map_reserved[t]?accessors.existsReserved(t):accessors.h.hasOwnProperty(t))){var n={};null!=__map_reserved[t]?accessors.setReserved(t,n):accessors.h[t]=n}return null!=__map_reserved[t]?accessors.getReserved(t):accessors.h[t]},_g=0,_g1=Type.getInstanceFields(null==o?null:js_Boot.getClass(o));_g<_g1.length;){var f=_g1[_g];++_g,Type["typeof"](Reflect.field(o,f))==ValueType.TFunction&&(StringTools.startsWith(f,"get_")?get(f).get=eval("(function (context) { return "+("function () { return context."+f+"() }")+"; })")(o):StringTools.startsWith(f,"set_")?get(f).set=eval("(function (context) { return "+("function (param) { context."+f+"(param); }")+"; })")(o):ret[f]=eval("(function (context) { return "+("function () { return context."+f+".apply(context, arguments); }")+"; })")(o))}for(var __tink_tmp35=accessors,iterator_field=__tink_tmp35.keys();iterator_field.hasNext();){var field1=iterator_field.next(),acc1=null!=__map_reserved[field1]?__tink_tmp35.getReserved(field1):__tink_tmp35.h[field1];Object.defineProperty(ret,field1,acc1)}return ret};var dua_ConfirmDialog=function(){};dua_ConfirmDialog.__name__=["dua","ConfirmDialog"],dua_ConfirmDialog.show=function(e,t,n){return null==t&&(t=!1),null==n&&(n={}),null==n.confirm&&(n.confirm="OK"),null==n.cancel&&(n.cancel="Abbrechen"),null==n.details&&(n.details=""),tink_core__$Future_Future_$Impl_$.async(function(a){dua_ConfirmDialog.confirm(e,t,n).handle(function(e){e&&a(tink_core_Noise.Noise)})})},dua_ConfirmDialog.confirm=function(e,t,n){null==t&&(t=!1),null==n&&(n={}),null==n.confirm&&(n.confirm="OK"),null==n.cancel&&(n.cancel="Abbrechen"),null==n.details&&(n.details=""),dua_ConfirmDialog.msgEl.innerHTML=e,dua_ConfirmDialog.cancelBtn.classList.toggle("hidden",!t),dua_ConfirmDialog.cancelBtn.value=n.cancel,dua_ConfirmDialog.confirmBtn.value=n.confirm,null==dua_ConfirmDialog.detailsEl&&(dua_ConfirmDialog.detailsEl=window.document.createElement("div"),dua_ConfirmDialog.msgEl.parentNode.appendChild(dua_ConfirmDialog.detailsEl),dua_ConfirmDialog.detailsEl.className="details"),dua_ConfirmDialog.detailsEl.innerHTML=n.details,dua_ConfirmDialog.toggler.checked=!0,pagr_App.bindings.updateBindings(dua_ConfirmDialog.window);for(var a=new tink_core_FutureTrigger,r=0,i=[dua_ConfirmDialog.confirmBtn,dua_ConfirmDialog.cancelBtn];r<i.length;){var o=[i[r]];++r,pagr_Dom.once(o[0],"click",tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(e){return function(){a.trigger(e[0]==dua_ConfirmDialog.confirmBtn),dua_ConfirmDialog.toggler.checked=!1}}(o)))}return a};var dua_Cover=function(e){this.zoom=1,this.app=e,this.viewport=pagr_Dom.query(".pagr .viewport")[0];var t,n=new tink_core_MPair(0,0);t=n,this.clipPos=t;var a,r=new tink_core_MPair(0,0);a=r,this.clipSize=a,this.isIE=!window.ActiveXObject&&"ActiveXObject"in window||/Edge\/\d./i.test(navigator.userAgent);var i=pagr_Dom.query(".focus-cover>g>g>text");this.toggler=pagr_Dom.query("#focus-cover")[0],this.cover=pagr_Dom.query(".focus-cover")[0],this.coverRect=pagr_Dom.query(".focus-cover>rect")[0],this.clipper=pagr_Dom.query("#focus path")[0],this.handler=pagr_Dom.query(".focus-cover>g>#clipper")[0],this.mover=i[0],this.resizer=i[1];var o,s=new tink_core_MPair(0,0);o=s,this.set_clipSize(o),this.zoom=1/(e.correction.a*e.transform.a),this.initEvents(),this.handleResize()};dua_Cover.__name__=["dua","Cover"],dua_Cover.prototype={app:null,width:null,height:null,clipPos:null,clipSize:null,zoom:null,toggler:null,cover:null,coverRect:null,clipper:null,handler:null,mover:null,resizer:null,isIE:null,initEvents:function(){var e=this;this.app.get_orientationChanged().handle(tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){e.toggler.checked=!1})),this.app.get_viewportChanged().handle(tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){e.handleResize();new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){if(e.handleResize(),pagr_App.runtime.isStandalone()){new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){e.handleResize()},500),$bind($_,$_.stop)))}},500),$bind($_,$_.stop)))})),this.app.get_zoomChanged().handle(tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){e.zoom=1/(e.app.correction.a*e.app.transform.a)})),window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&this.app.pages.get_navigated().handle(function(t){var n=pagr_Dom.query("rect.covered")[0];if(null!=n){n.removeAttribute("clip-path"),e.mover.removeAttribute("filter"),e.mover.setAttribute("filter","url(#highlight)");new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){n.setAttribute("clip-path","url(#focus)"),e.resizer.removeAttribute("filter"),e.resizer.setAttribute("filter","url(#highlight)")},10),$bind($_,$_.stop)))}}),pagr_Dom.on(this.toggler,"change",null,function(t){var n=e.toggler.checked;if(e.app.isCovered=n,n){e.coverRect.classList.remove("covered");var a,r=new tink_core_MPair(0,0);a=r,e.set_clipSize(a);var i,o=new tink_core_MPair(0,0);i=o,e.set_clipPos(i);new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay($bind(e,e.handleResize),10),$bind($_,$_.stop)))}}),pagr_Dom.on(this.coverRect,"panstart",null,$bind(this,this.drawClip)),pagr_Dom.on(this.mover,"panstart",null,$bind(this,this.moveClip)),pagr_Dom.on(this.resizer,"panstart",null,$bind(this,this.resizeClip))},drawClip:function(e){var t=this;if(!this.coverRect.classList.contains("covered")){e.stopPropagation(),this.coverRect.classList.add("drawing");var n,a=e.gesture.pointers[0],r=this.getPos(a),i=this.zoom,o=new tink_core_MPair(r.a*i,r.b*i);n=o,this.set_clipPos(n),this.updateClip();var s=pagr_Dom.on(window.document,"panmove",null,function(e){var n,a=e.gesture.pointers[0],i=t.getPos(a),o=r.a>i.a?i.a:r.a,s=r.b>i.b?i.b:r.b,l=new tink_core_MPair(o,s);n=l;var _,u=n,c=t.zoom,d=new tink_core_MPair(u.a*c,u.b*c);_=d,t.set_clipPos(_);var p,h=new tink_core_MPair(r.a-i.a,r.b-i.b);p=h;var g,m=p,v=t.zoom,f=new tink_core_MPair(m.a*v,m.b*v);g=f,t.set_clipSize(g),t.updateClip()});pagr_Dom.once(window.document,"panend",tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){t.coverRect.classList.remove("drawing"),t.coverRect.classList.add("covered"),null!=s&&s.dissolve()}))}},resizeClip:function(e){var t=this;if(this.coverRect.classList.contains("covered")){e.stopPropagation(),this.coverRect.classList.add("drawing"),this.coverRect.classList.remove("covered");var n=e.gesture.pointers[0],a=this.getPos(n),r=pagr_Dom.on(window.document,"panmove",null,function(e){var n=e.gesture.pointers[0],r=t.getPos(n);if(r.a>t.get_clipPos().a+30&&r.b>t.get_clipPos().b+30){var i,o=t.get_clipSize(),s=new tink_core_MPair(r.a-a.a,r.b-a.b);i=s;var l,_=i,u=t.zoom,c=new tink_core_MPair(_.a*u,_.b*u);l=c;var d,p=l,h=new tink_core_MPair(o.a+p.a,o.b+p.b);d=h,t.set_clipSize(d),t.updateClip(),a=r}});pagr_Dom.once(window.document,"panend",tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){t.coverRect.classList.remove("drawing"),t.coverRect.classList.add("covered"),null!=r&&r.dissolve()}))}},moveClip:function(e){var t=this;if(this.coverRect.classList.contains("covered")){e.stopPropagation(),this.coverRect.classList.add("drawing"),this.coverRect.classList.remove("covered");var n=e.gesture.pointers[0],a=this.getPos(n),r=pagr_Dom.on(window.document,"panmove",null,function(e){var n,r=e.gesture.pointers[0],i=t.getPos(r),o=t.get_clipPos(),s=new tink_core_MPair(i.a-a.a,i.b-a.b);n=s;var l,_=n,u=t.zoom,c=new tink_core_MPair(_.a*u,_.b*u);l=c;var d,p=l,h=new tink_core_MPair(o.a+p.a,o.b+p.b);d=h,t.set_clipPos(d),t.updateClip(),a=i});pagr_Dom.once(window.document,"panend",tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){t.coverRect.classList.remove("drawing"),t.coverRect.classList.add("covered"),null!=r&&r.dissolve()}))}},updateClip:function(){var e=1/this.zoom,t=this.get_clipPos().a,n=this.get_clipPos().b,a=this.get_clipSize().a,r=this.get_clipSize().b,i=dua_Views.clipPath(t,n,a,r);this.mover.setAttribute("x",(t+a)*e-30+""),this.mover.setAttribute("y",n*e+15+""),this.resizer.setAttribute("x",(t+a)*e-32+""),this.resizer.setAttribute("y",(n+r)*e-20+""),this.clipper.setAttribute("d",dua_Views.clipPath(0,0,this.width,this.height)+" "+i),this.handler.setAttribute("d",i),this.isIE&&this.mover.parentNode.setAttribute("transform","scale("+this.zoom+")")},getPos:function(e){var t,n=this.cover.getBoundingClientRect(),a=new tink_core_MPair(e.clientX-n.left,e.clientY-n.top-window.pageYOffset);return t=a},setClipPos:function(e){if(0==this.get_clipPos().a&&0==this.get_clipPos().b||0==e.a&&0==e.b)return e;var t,n=this.cover.getBoundingClientRect(),a=this.handler.getBoundingClientRect(),r=n.right,i=this.get_clipPos().a-e.a,o=this.get_clipPos().b-e.b,s=Math.min(i,(a.left-n.left)*this.zoom),l=Math.min(o,(a.top-n.top)*this.zoom),_=new tink_core_MPair(Math.round(100*(i<0&&a.right>r?(a.right-r)*this.zoom:s))/100,Math.round(100*(o<0&&a.bottom>n.bottom?(a.bottom-n.bottom)*this.zoom:l))/100);t=_;var u,c=t,d=this.get_clipPos(),p=new tink_core_MPair(d.a-c.a,d.b-c.b);return u=p},setClipSize:function(e){var t,n=this.handler.getBoundingClientRect(),a=this.cover.getBoundingClientRect(),r=Math.min(Math.abs(e.a),(a.right-n.left)*this.zoom),i=Math.min(Math.abs(e.b),(a.bottom-n.top)*this.zoom),o=new tink_core_MPair(Math.round(100*r)/100,Math.round(100*i)/100);
return t=o},handleResize:function(){if(null!=this.toggler&&this.toggler.checked){this.zoom=1/(this.app.correction.a*this.app.transform.a);var e=this.cover.getBoundingClientRect(),t=e.width,n=e.height;this.width=t*this.zoom,this.height=n*this.zoom,this.clipper.setAttribute("d",dua_Views.clipPath(0,0,this.width,this.height)),this.updateClip()}},get_clipPos:function(){return this.clipPos},set_clipPos:function(e){return this.clipPos=this.setClipPos(e),e},get_clipSize:function(){return this.clipSize},set_clipSize:function(e){return this.clipSize=this.setClipSize(e),e},__class__:dua_Cover};var pagr_App=function(e){this.isFixing=!1,this.isPaning=!1,this.isCovered=!1;var t=this;this._orientationChanged=new tink_core_SignalTrigger,this._zoomChanged=new tink_core_SignalTrigger,this._viewportChanged=new tink_core_SignalTrigger,this.viewportChanged=this._viewportChanged,this.zoomChanged=this._zoomChanged,this.orientationChanged=this._orientationChanged,this.root=pagr_Dom.query(".pagr")[0],this.viewport=pagr_Dom.query(".pagr .viewport")[0],this.dragBounds=pagr_Dom.query(".pagr .viewport .drag-bounds")[0],this.book=pagr_Dom.query(".pagr .book")[0],this.zoomable=pagr_Dom.query(".pagr .zoomable")[0],this.bookHeight=Std.parseInt(this.book.style.height),this.bookWidth=Std.parseInt(this.book.style.width),this.bookResolutions=this.book.getAttribute("data-resolutions").split(",").map(Std.parseInt);var n=window.document.createElement("style");this.viewport.insertBefore(n,this.viewport.firstChild),this.zoomSheet=n,this.transform=tink_geom2__$Matrix_Matrix_$Impl_$.IDENTITY,this.correction=tink_geom2__$Matrix_Matrix_$Impl_$.IDENTITY,this.pages=new pagr_PageController(this),this.initialSettings=e,this.settingsController=new dua_windows_Settings(e,this),this.settingsChanged=this.settingsController.get_changed(),this.modes=new pagr_modes_ModeController(this),this.r=new EReg("/*\\d+$","");var a=pagr_Dom.query("body>script")[0];a.parentElement.removeChild(a),pagr_Dom.query("head title")[0].innerHTML=this.get_settings().productInfo.title,this.initSettings(),this.initHammer(),pagr_Dom.on(window,"resize",null,tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){t.updateViewport();var e=pagr__$_$impl_Views.noScale(tink_geom2__$Matrix_Matrix_$Impl_$.concat(t.correction,t.transform));t.zoomSheet.innerHTML=e})),pagr_Dom.on(this.viewport,"transitionend",null,tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){t.updateViewport();var e=pagr__$_$impl_Views.noScale(tink_geom2__$Matrix_Matrix_$Impl_$.concat(t.correction,t.transform));t.zoomSheet.innerHTML=e})),this.updateViewport();var r=pagr__$_$impl_Views.noScale(tink_geom2__$Matrix_Matrix_$Impl_$.concat(this.correction,this.transform));this.zoomSheet.innerHTML=r,pagr_Dom.on(this.viewport,"mousewheel wheel",null,$bind(this,this.wheelZoom)),pagr_Dom.once(pagr_Dom.query("#toggle-thumb-slider")[0],"change",tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){new dua_ThumbSlider(t)})),pagr_App.bindings=new pagr_Bindings(this),this.annotations=new dua_annotations_AnnotationController(this);var i=this.get_settings().newsService;if(null!=i&&i.enabled&&new dua_NewsService(i.baseUrl,this.get_settings().productInfo.productNumber),pagr_Dom.on(this.viewport,"swiperight swipeleft",null,function(e){var n=e.type;switch(n){case"swipeleft":window.history.replaceState(t.get_page(),null,window.location.pathname.replace(t.r.r,"")+"?page="+(t.get_page()+t.get_step()));var a=t;a.set_page(a.get_page()+t.get_step());break;case"swiperight":window.history.replaceState(t.get_page(),null,window.location.pathname.replace(t.r.r,"")+"?page="+(t.get_page()-t.get_step()));var r=t;r.set_page(r.get_page()-t.get_step())}}),pagr_Dom.on(this.viewport,"pinchstart",null,$bind(this,this.handlePinch)),pagr_App.isIos){new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){t.fixIosTabBehaviour()},500),$bind($_,$_.stop)));window.addEventListener("focus",function(e){t.fixIosTabBehaviour()},!1),window.addEventListener("resize",function(e){utils_Helper.debounce("fixIosTabBehaviour",function(){t.fixIosTabBehaviour();new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){t.updateViewport()},510),$bind($_,$_.stop)))},500)},!1)}var o=function(e){var t=pagr_Dom.query(".t-fullscreen")[0].parentElement;null!=t&&pagr_App.bindings.updateBindings(),pagr_App.bindings.updateBindings(pagr_Dom.query(".ctrl-fullscreen")[0])};pagr_Dom.on(window.document,"webkitfullscreenchange",null,o),pagr_Dom.on(window.document,"mozfullscreenchange",null,o),pagr_Dom.on(window.document,"fullscreenchange",null,o),pagr_Dom.on(window.document,"MSFullscreenChange",null,o)};pagr_App.__name__=["pagr","App"],pagr_App.prototype={_orientationChanged:null,_zoomChanged:null,_viewportChanged:null,viewportChanged:null,zoomChanged:null,orientationChanged:null,root:null,viewport:null,dragBounds:null,book:null,zoomable:null,bookHeight:null,bookWidth:null,bookResolutions:null,zoomSheet:null,transform:null,correction:null,pages:null,initialSettings:null,settingsController:null,settings:null,settingsChanged:null,setSetting:function(e,t){this.settingsController.setSetting(e,t)},modes:null,step:null,fullscreen:null,orientation:null,zoom:null,isCovered:null,isPaning:null,reset:function(){if(1==this.get_zoom())return!1;this.set_zoom(1),this.updateLevelOfDetail();var e=pagr__$_$impl_Views.noScale(tink_geom2__$Matrix_Matrix_$Impl_$.concat(this.correction,this.transform));return this.zoomSheet.innerHTML=e,!0},initHammer:function(){var e=this,t=externs_HammerMaker.make(this.zoomable,{domEvents:!0,recognizers:[externs__$Hammer_HammerRecognizerConfig_$Impl_$._new(Hammer.Tap),externs__$Hammer_HammerRecognizerConfig_$Impl_$._new(Hammer.Tap,{event:"doubletap",posThreshold:50,preventDefault:!0,taps:2},["tap"]),externs__$Hammer_HammerRecognizerConfig_$Impl_$._new(Hammer.Pinch,{preventDefault:!0}),externs__$Hammer_HammerRecognizerConfig_$Impl_$._new(Hammer.Swipe,{direction:Hammer.DIRECTION_HORIZONTAL,preventDefault:!0}),externs__$Hammer_HammerRecognizerConfig_$Impl_$._new(Hammer.Pan,{threshold:0},"swipe")]});t.get("pan").set({enable:function(){if(e.get_zoom()>1||e.isCovered)return!0;var t=e.get_mode(),n=t;switch(n){case"draw":case"line":case"notes":case"selectMove":return!0;default:return!1}}}),t.get("swipe").set({enable:function(){if(1!=e.get_zoom()||e.isCovered)return!1;var t=e.get_mode(),n=t;switch(n){case"draw":case"line":return!1;default:return!0}}})},r:null,initSettings:function(){for(var e=this,t=function(t){var n=t.name,a=t.value,r=Reflect.isObject(a)?a.enabled?1:0:a;e.get_root().setAttribute("data-setting-"+n,r)},n=this.get_settings(),a=HxOverrides.iter(Reflect.fields(n));a.hasNext();){var r=a.next(),i=n[r];t({name:r,value:i})}if(this.settingsController.get_changed().handle(t),pagr_App.isTouchDevice&&this.hoverTouchUnstick(),null!=pagr_App.runtime){this.get_settings().closeDialogue.enabled&&pagr_App.runtime.onClose($bind(this,this.confirmClosing));var o=pagr_App.storage.dataStore("annotations"),s="EKV_storage";localforage.defineDriver({_driver:s,_initStorage:function(e){},clear:function(e){var t=0;o.keys(function(n){t=n.length;for(var a=0;a<n.length;){var r=n[a];++a,o.set(r,null,function(){0==(t-=1)&&e()})}})},getItem:function(e,t){o.get(e,t)},key:function(e,t){o.keys(function(n){t(n[e])})},keys:function(e){o.keys(e)},length:function(e){o.keys(function(t){e(t.length)})},removeItem:function(e,t){o.set(e,null,t)},setItem:function(e,t,n){o.set(e,t,n)},iterate:function(e,t){o.keys(function(n){var a,r,i,s,l=n.length,_=HxOverrides.iter(n);for(a=1,r=1,s=0,i=99999999;s<i&&_.hasNext();){var u=[_.next()],c=[r+s++*a],d=u[0],p=function(n,a){return function(r){e(r,a[0],n[0]),0==(l-=1)&&t()}}(c,u);o.get(d,p)}})}}).then(function(){localforage.setDriver(s)})}var l=this.get_settings().productInfo;null!=l&&localforage.config({name:l.productForm+l.productNumber,storeName:l.productNumber,version:3})},annotations:null,init:function(){window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&this.get_root().classList.toggle("mozilla",!0),this.pages.init(),this.reset()},confirmClosing:function(){if(pagr_App.epd&&pagr_App.runtime.exit(),this.get_settings().annotations.sync.allowed&&this.annotations.get_needsSync()&&!this.get_settings().annotations.sync.enabled)dua_ConfirmDialog.confirm(dua__$_$impl_Confirm.WANNA_SYNC,!0,{confirm:"Ja, synchronisieren",cancel:"Nein, beenden"}).handle(function(e){if(e){window.document.getElementById("toggle-window-Einstellungen").click();new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){window.document.querySelector('[for="annotations.sync"]').click()},380),$bind($_,$_.stop)))}else pagr_App.runtime.exit()});else{dua_ConfirmDialog.show(dua__$_$impl_Confirm.EXIT,!0,{confirm:"Ja, schließen",cancel:"Nein, abbrechen"}).handle(tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){pagr_App.runtime.exit()}));var e=this._zoomChanged,t=this.get_zoom();tink_core__$Callback_CallbackList_$Impl_$.invoke(e.handlers,t)}},getPages:function(){return this.pages.getPages()},getMousePos:function(e,t){null==t&&(t=!1);var n,a=this.viewport.getBoundingClientRect(),r=a.top+window.pageYOffset,i=this.transform.a*this.correction.a,o=new tink_core_MPair(e.clientX-a.left-a.width/2,e.clientY-r-a.height/2);n=o;var s,l=n,_=new tink_core_MPair((l.a-this.transform.tx)/i+this.bookWidth/2,(l.b-this.transform.ty)/i+this.bookHeight/2);s=_;var u=s,c=this.get_orientation();if(null==t)switch(c){case"landscape":var d,p=pagr_Dom.query(".page.active")[0].getBoundingClientRect(),h=new tink_core_MPair(this.bookWidth/2,0);d=h;var g,m=d;if(e.clientX<p.right)g=m;else{var v,f=new tink_core_MPair((-m.a),(-m.b));v=f,g=v}var $,b=new tink_core_MPair(u.a+g.a,u.b+g.b);return $=b;case"portrait":return u}else{if(0==t)return l;switch(c){case"landscape":var w,k=pagr_Dom.query(".page.active")[0].getBoundingClientRect(),y=new tink_core_MPair(this.bookWidth/2,0);w=y;var x,C=w;if(e.clientX<k.right)x=C;else{var D,S=new tink_core_MPair((-C.a),(-C.b));D=S,x=D}var I,T=new tink_core_MPair(u.a+x.a,u.b+x.b);return I=T;case"portrait":return u}}},getTouchMiddle:function(e){var t,n=this.viewport.getBoundingClientRect(),a=n.top+window.pageYOffset,r=new tink_core_MPair((e[0].clientX+e[1].clientX)/2-n.left-n.width/2,(e[0].clientY+e[1].clientY)/2-a-n.height/2);return t=r},applyTransform:function(e,t){var n=this;null==t&&(t={});var a=null!=t.animated&&t.animated,r=null==t.boundsCheck||t.boundsCheck;a&&(this.zoomable.classList.contains("animated")||(this.zoomable.classList.add("animated"),pagr_Dom.once(this.zoomable,"transitionend",tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){n.zoomable.classList.remove("animated")}))));var i=this.transform.a;this.transform=r?this.checkBounds(e):e;var o=tink_geom2__$Matrix_Matrix_$Impl_$.concat(this.correction,this.transform);pagr_Dom.transform(this.zoomable,tink_geom2__$Matrix_Matrix_$Impl_$.toString(o)),tink_core__$Callback_CallbackList_$Impl_$.invoke(this._viewportChanged.handlers,tink_core_Noise.Noise),i!=this.transform.a&&tink_core__$Callback_CallbackList_$Impl_$.invoke(this._zoomChanged.handlers,this.transform.a)},checkBounds:function(e){var t=e.a/this.transform.a;if(t>1)return e;var n=pagr_Dom.query(".page.active"),a=0,r=0,i=this.dragBounds.getBoundingClientRect(),o=n[0].getBoundingClientRect(),s=o.width*n.length*t,l=o.height*t,_=Math.max((l-i.height)/2,0),u=Math.max((s-i.width)/2,0);if(Math.abs(e.tx)>u&&(a=e.tx>0?u-e.tx:Math.abs(e.tx)-u),Math.abs(e.ty)>_&&(r=e.ty>0?_-e.ty:Math.abs(e.ty)-_),0!=a||0!=r){var c,d=new tink_core_MPair(a,r);return c=d,tink_geom2__$Matrix_Matrix_$Impl_$.move(e,c)}return e},updateLevelOfDetail:function(){for(var e=tink_geom2__$Matrix_Matrix_$Impl_$.concat(this.transform,this.correction).a*this.bookWidth,t=e*pagr_App.OPTIMAL_DENSITY,n=0;this.bookResolutions[n]<t&&n<this.bookResolutions.length-1;)++n;this.book.setAttribute("data-lod",Std.string(n+1))},wheelZoom:function(e){var t,n;if(null!=e.deltaX)t=-e.deltaY/Math.abs(e.deltaY);else if(null!=e.wheelDeltaX)t=e.wheelDeltaY/Math.abs(e.wheelDeltaY);else if(null!=e.wheelDelta)t=e.wheelDelta/Math.abs(e.wheelDelta);else{if(null==e.detail)return;t=-e.detail/Math.abs(e.wheelDelta)}n=t>0?1.1:.9090909090909091,e.preventDefault(),e.stopImmediatePropagation(),this.zoomFn(n,this.getMousePos(e)),this.updateLevelOfDetail();var a=pagr__$_$impl_Views.noScale(tink_geom2__$Matrix_Matrix_$Impl_$.concat(this.correction,this.transform));this.zoomSheet.innerHTML=a},handlePinch:function(e){var t=this,n=this.getTouchMiddle(e.gesture.pointers),a=e.gesture.scale,r=pagr_Dom.on(this.viewport,"pinchmove",null,function(e){var r=1+e.gesture.scale-a;if(r<=0||1==r)return void(a=e.gesture.scale);var i=r<1?Math.pow(.95,r):Math.pow(1.0526315789473684,r);t.zoomFn(i,n,!1),a=e.gesture.scale});pagr_Dom.once(this.viewport,"touchend",tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){var e=pagr__$_$impl_Views.noScale(tink_geom2__$Matrix_Matrix_$Impl_$.concat(t.correction,t.transform));t.zoomSheet.innerHTML=e,t.updateLevelOfDetail(),null!=r&&r.dissolve()},5),$bind($_,$_.stop)))}))},zoomFn:function(e,t,n){if(null==n&&(n=!0),null==t){var a,r=new tink_core_MPair(0,0);a=r,t=a}var i=this.get_zoom(),o=i*e;if(o<=1)return void(this.transform.a>1&&this.applyTransform(tink_geom2__$Matrix_Matrix_$Impl_$.IDENTITY,{animated:!1,boundsCheck:n}));var s=this.getMaxZoom();if(o>s){if(this.transform.a==s)return;e=s/i}var l,_=this.transform,u=new tink_core_MPair((-t.a),(-t.b));l=u,this.applyTransform(tink_geom2__$Matrix_Matrix_$Impl_$.move(tink_geom2__$Matrix_Matrix_$Impl_$.scale(tink_geom2__$Matrix_Matrix_$Impl_$.move(_,l),e),t),{animated:!1,boundsCheck:n})},btnZoomFn:function(e){this.zoomFn(e),this.updateLevelOfDetail();var t=pagr__$_$impl_Views.noScale(tink_geom2__$Matrix_Matrix_$Impl_$.concat(this.correction,this.transform));this.zoomSheet.innerHTML=t},getMaxZoom:function(){return this.bookResolutions[this.bookResolutions.length-1]/this.bookWidth*2/this.correction.a/pagr_App.DEVICE_PIXEL_RATIO},setOrientation:function(e){return e!=this.get_orientation()&&(this.get_root().setAttribute("data-orientation",e),tink_core__$Callback_CallbackList_$Impl_$.invoke(this._orientationChanged.handlers,e),this.set_page(this.get_page()),!0)},updateViewport:function(e){if(null==e||e.target==this.viewport){var t=this.viewport.clientWidth,n=this.viewport.clientHeight,a=(this.setOrientation(t>1.2*n?"landscape":"portrait"),Math.min(n/this.bookHeight,t/(this.get_step()*this.bookWidth)));if(this.correction.a!=a){var r={a:a,b:0,c:0,d:a,tx:0,ty:0};this.correction=r,this.applyTransform(this.transform,{animated:null==e||e.target==this.viewport})}}},isFixing:null,fixIosTabBehaviour:function(){var e=this;if(pagr_App.isIos&&!this.isFixing){this.isFixing=!0,window.scrollTo(100,100);new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){window.scrollTo(0,0)},100),$bind($_,$_.stop))),new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){var t=Std.string(window.innerHeight);window.document.body.style.height=t+"px",e.isFixing=!1},400),$bind($_,$_.stop)))}},hoverTouchUnstick:function(){for(var e,t=new RegExp(":hover","g".split("u").join("")),n=window.document.styleSheets.length,a=0,r=n;a<r;){var i=a++;e=window.document.styleSheets[i];for(var o=e.cssRules.length,s=0,l=o;s<l;){var _=s++,u=e.cssRules[_];null!=u.selectorText&&(u.selectorText=u.selectorText.replace(t,":active"))}}},get_viewportChanged:function(){return this.viewportChanged},get_zoomChanged:function(){return this.zoomChanged},get_orientationChanged:function(){return this.orientationChanged},get_root:function(){return this.root},get_settings:function(){return this.settingsController.settings},get_settingsChanged:function(){return this.settingsChanged},get_step:function(){return this.pages.get_step()},get_fullscreen:function(){return pagr_Dom.isFullscreen(this.get_root())},set_fullscreen:function(e){var t=this._zoomChanged,n=this.get_zoom();return tink_core__$Callback_CallbackList_$Impl_$.invoke(t.handlers,n),pagr_Dom.toggleFullScreen(this.get_root(),e),e},get_orientation:function(){return this.get_root().getAttribute("data-orientation")},get_zoom:function(){return this.transform.a},set_zoom:function(e){return this.applyTransform(tink_geom2__$Matrix_Matrix_$Impl_$.scale(this.transform,e/this.transform.a),{animated:!0}),e},get_back:function(){return this.pages.back},set_back:function(e){return this.pages.back=e,e},get_page:function(){return this.pages.get_page()},set_page:function(e){return this.pages.set_page(e),e},get_mode:function(){return this.modes.get_mode()},set_mode:function(e){return this.modes.set_mode(e),e},__class__:pagr_App};var dua_Dua=function(e){pagr_App.call(this,e)};dua_Dua.__name__=["dua","Dua"],dua_Dua.main=function(){var e,t=pagr_Dom.query("#settings-json")[0];if(null==t)e=null;else{var n=t;e=n.innerHTML}var a=dua_SettingsLoader.load("config/"+(settingsJson+".json"),null!=e,function(t){if(null==e)return haxe_Http.requestUrl(t);var n=e;return n}),r=new dua_Dua(a),i=r.get_root(),o=window.navigator.userAgent.toLowerCase();if(i.setAttribute("data-native-pdf-support",o.indexOf("safari")==-1||o.indexOf("chrome")!=-1||StringTools.startsWith(o,"win")?"0":"1"),r.get_root().setAttribute("data-os",pagr_App.platform),"win"!=pagr_App.platform&&"mac"!=pagr_App.platform){var s=a.tooltips;s.overwritable=!1,s.enabled=!1,r.settingsController.setSetting("tooltips",s)}if(dua_Dua.productNumber=a.productInfo.productNumber,pagr_App.runtime.isStandalone()?(dua_Dua.epc(),r.get_root().setAttribute("data-standalone","")):pagr_App.runtime.isBookShelf()?dua_Dua.bookshelf(r,a):r.get_root().setAttribute("data-webbased",""),pagr_App.isIos){var l=pagr_Dom.query("footer ul.right li")[0];l.parentNode.removeChild(l)}pagr_App.isIos&&(pagr__$Dom_Query_$Impl_$.on('.Sprungmarke a[target="_blank"]',"click",null,function(e){StringTools.startsWith(e.at.getAttribute("href"),"?page")||(e.event.preventDefault(),window.open(e.at.getAttribute("href"),"_blank"))}),pagr__$Dom_Query_$Impl_$.on("footer","click",null,function(e){e.at.style.display="table";new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){e.at.style.display=""},1),$bind($_,$_.stop)))}));var _=new dua_search_Form(r);dua_Dua.videoWin=new dua_windows_VideoWindow,dua_Dua.audioWin=new dua_windows_AudioWindow,dua_Dua.imageWin=new dua_windows_ImageWindow;var u="selectMove";r.set_mode(u),pagr_Windows.init(),pagr_Tooltip.init(),new dua_Welcome(r),new dua_Cover(r),new dua_Bookmarks(r);var c=new dua_materials_Sidebar(r);c.get_menuChanged().handle(tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){_.drawMaterialResults(!0)})),window.document.body.classList.toggle("dry",!1),r.init();var d=a.onlineCheck;if(d.enabled&&dua_Dua.onlineCheck(d),window.innerHeight<640)for(var p=0,h=pagr_Dom.query("input.toggler:checked");p<h.length;){var g=h[p];++p,g.click()}pagr__$Dom_Query_$Impl_$.on("input.top-overlay-toggler","change",null,function(e){for(var t=0,n=pagr_Dom.query("input.top-overlay-toggler:checked");t<n.length;){var a=n[t];++t,a!=e.at&&a.click()}e.at.focus()}),pagr__$Dom_Query_$Impl_$.on("input.toggler.sheet","change",null,function(e){for(var t=0,n=pagr_Dom.query("input.toggler.sheet:checked");t<n.length;){var a=n[t];++t,a!=e.at&&a.click()}e.at.focus()}),pagr__$Dom_Query_$Impl_$.on(".ctrl-menu-info .overlay-content label","click",null,tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){pagr_Dom.query(".ctrl-menu-info>input")[0].click()}))},dua_Dua.onlineCheck=function(e){var t=1e3*e.interval,n=pagr_Dom.query(".pagr")[0];pagr_App.runtime.isOnline()?n.removeAttribute("data-offline"):n.setAttribute("data-offline",""),window.setTimeout(function(){dua_Dua.onlineCheck(e)},t)},dua_Dua.bookshelf=function(e,t){var n=t.annotations.sync.server.baseParameter.dienstId,a=new EReg("^(.+/)*content","gu");e.get_root().setAttribute("data-bookshelf","");for(var r=pagr_App.runtime.getInstalledArchives(n),i=0;i<r.length;){var o=r[i];++i,e.get_root().setAttribute("data-klett-archive-"+o,"")}pagr__$Dom_Query_$Impl_$.on("[data-bookshelf] .app-close","click",null,tink_core__$Callback_Callback_$Impl_$.fromNiladic($bind(e,e.confirmClosing))),pagr__$Dom_Query_$Impl_$.on("[data-klett-archive-id]","click",null,function(e){var i=e.at.getAttribute("data-klett-archive-id");if(null!=i&&r.indexOf(i)==-1){e.event.preventDefault(),e.event.stopImmediatePropagation(),e.event.stopPropagation();var o=e.at.getAttribute("data-klett-archive-title");dua_ConfirmDialog.confirm("Das gewünschte Material ist im "+o+" enthalten, welches noch nicht heruntergeladen wurde.",!0,{confirm:"Online anzeigen",cancel:"Herunterladen",details:""}).handle(function(r){switch(r){case!1:pagr_App.runtime.exit();break;case!0:var i=e.event.target,o=i.getAttribute("href");if(null==o){for(var s=0,l=pagr_Dom.query("a",i);s<l.length;){var _=l[s];if(++s,"none"!=window.getComputedStyle(_).display){i=_;break}}o=i.getAttribute("href")}a.match(o)&&(o=Std.string(t.ctrlCloudIcon.link)+"/"+n+o.replace(a.r,"/content")),pagr_App.runtime.handleLink(o,i)}})}})},dua_Dua.epc=function(){var e=pagr_Dom.query("#ep2")[0];if(null!=e){var t=new haxe_crypto_BaseCode(haxe_io_Bytes.ofString("12345678"));dua_Dua.exp=JSON.parse(t.decodeString(e.innerText)),e.parentNode.removeChild(e);var n=dua_Dua.exp;if(null==n.date){if(1==n.enabled){n.duration}}else if(1==n.enabled){var a=n.date;dua_Dua.epcDt(a)}}},dua_Dua.epcDt=function(e){var t=e.split(".");t.reverse();var n=HxOverrides.strDate(t.join("-")+" 23:59:59"),a=(new Date).getTime();n.getTime()<a&&dua_Dua.epcEt();var r=pagr_App.runtime.storage(),i=r.forProduct(dua_Dua.productNumber),o=i.dataStore("epcStore");o.get("epcDt",function(e){if(null==e)o.set("epcDt",a);else{var t=e;if(a>t)o.set("epcDt",a);else{var n=e;a<n&&dua_Dua.epcEt()}}})},dua_Dua.epcEt=function(){pagr_App.epd=!0,dua_ConfirmDialog.show('Achtung das Produkt ist abgelaufen. Besuchen Sie bitte <a href="'+dua_Dua.exp.redirectUrl+'" target="blank">'+dua_Dua.exp.redirectUrl+"</a>").handle(tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){pagr_App.runtime.exit()}))},dua_Dua.__super__=pagr_App,dua_Dua.prototype=$extend(pagr_App.prototype,{__class__:dua_Dua});var dua_LinkDialog=function(e){this.localFileCb=null,this.resetCb=null,this.submitCb=null,this.resetBtnSel=".link-chooser a.reset",this.saveBtnSel=".link-chooser a.submit",this.localFileSel='.link-chooser [type="file"]',this.containerEl=e};dua_LinkDialog.__name__=["dua","LinkDialog"],dua_LinkDialog.prototype={containerEl:null,localFileSel:null,saveBtnSel:null,resetBtnSel:null,submitCb:null,resetCb:null,localFileCb:null,build:function(e){var t=this,n=new EReg("[^:/?#]+://",""),a=this.render(e);if(this.containerEl.innerHTML=a,null!=this.submitCb){var r=this.submitCb;null!=r&&r.dissolve()}if(null!=this.resetCb){var i=this.resetCb;null!=i&&i.dissolve()}var o=new tink_core_FutureTrigger,s=pagr_Dom.query(this.saveBtnSel,this.containerEl)[0],l=pagr_Dom.query(this.resetBtnSel,this.containerEl)[0],_=pagr_Dom.query(this.localFileSel,this.containerEl)[0];return this.submitCb=pagr_Dom.once(s,"click",tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){var e=pagr_Dom.query('.link-chooser [name="local"]',t.containerEl)[0],a=pagr_Dom.query('.link-chooser [name="url"]',t.containerEl)[0],r=pagr_Dom.query('.link-chooser [name="description"]',t.containerEl)[0],i=n.match(a.value)?a.value:("1"==e.value?"file:///":"http://")+a.value;o.trigger(tink_core_Outcome.Success({url:i,description:r.value,local:e.value}))})),this.resetCb=pagr_Dom.once(l,"click",tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){o.trigger(tink_core_Outcome.Failure(!1))})),this.localFileCb=pagr_Dom.once(_,"change",$bind(this,this.addLocalResource)),o},addLocalResource:function(e){var t=e.target.value,n=pagr_Dom.query('.link-chooser [name="local"]',this.containerEl)[0],a=pagr_Dom.query('.link-chooser [name="url"]',this.containerEl)[0];n.value="1",a.value=t},focus:function(){var e=pagr_Dom.query('.link-chooser [name="url"]',this.containerEl)[0];e.focus()},render:function(e){var t=tink_template__$Html_Html_$Impl_$.buffer(),n="  \r\n";t.s+=n;var a='<div class="link-chooser">\r\n      <input type="hidden" name="local" value="';if(t.s+=a,null!=e){var r=tink_template__$Html_Html_$Impl_$.escape(e.local);t.s+=r}else{var i="0";t.s+=i}var o='" />\r\n      <div class="localLink">\r\n        <label>\r\n          <input style="display:none;" type="file" />\r\n          Lokale Datei auswählen <i class="fa dua-folder"></i> oder\r\n        </label>\r\n      </div>\r\n      <div class="remoteLink">\r\n        <label for="remoteLink">URL eingeben\r\n          <input name="url" type="text" value="';if(t.s+=o,null!=e){var s=tink_template__$Html_Html_$Impl_$.escape(e.url);t.s+=s}var l='"/>\r\n        </label>            \r\n        <label for="description">Beschreibung\r\n          <input name="description" type="text" value="';if(t.s+=l,null!=e){var _=tink_template__$Html_Html_$Impl_$.escape(e.description);t.s+=_}var u='" />\r\n        </label>\r\n      </div>\r\n      <div class="footer">\r\n        <a class="submit">verlinken</a>\r\n        <a class="reset">abbrechen</a>\r\n      </div>\r\n    </div>\r\n';t.s+=u;var c=t.s;return c},__class__:dua_LinkDialog};var dua_NewsService=function(e,t){var n=this;return this.url=e,this.isbn=t,this.cookieName=t,this.newsIds=[],""==t?void pagr_Dom.query(".pagr")[0].setAttribute("data-setting-newsservice","0"):(this.toggler=pagr_Dom.query("#toggle-aside-news")[0],pagr_Dom.on(this.toggler,"change",null,function(e){if(n.toggler.checked){new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay($bind(n,n.updateNews),0),$bind($_,$_.stop)))}}),this.unreadedEl=pagr_Dom.query('label.toggler[for="toggle-aside-news"] span.badge')[0],void window.setTimeout(function(){n.loadNews()},0))};dua_NewsService.__name__=["dua","NewsService"],dua_NewsService.prototype={url:null,isbn:null,toggler:null,unreadedEl:null,news:null,newsIds:null,loadNews:function(){var e=this,t=new haxe_Http(this.url+this.isbn);t.onData=function(t){try{e.parseResponse(t)}catch(n){window.setTimeout(function(){e.loadNews()},6e4)}},t.onError=function(t){window.setTimeout(function(){e.loadNews()},6e4)},t.request()},parseResponse:function(e){var t=this,n=0,a=Xml.parse(e);return this.news=new haxe_xml_Fast(a.firstElement()),0==this.news.nodes.resolve("news_item").length?void pagr_Dom.query(".pagr")[0].setAttribute("data-setting-newsservice","0"):void pagr_App.storage.dataStore("settings").get("readedNews",function(e){for(var a=t.news.nodes.resolve("news_item").h;null!=a;){var r=a.item;a=a.next;var i=r,o=Std.parseInt(i.att.resolve("id"));t.newsIds.push(o),e.indexOf(o)==-1&&(n+=1)}if(t.set_unreaded(n),0==t.newsIds.length&&pagr_Dom.query("aside.news")[0].classList.toggle("hidden"),t.toggler.checked){new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay($bind(t,t.updateNews),0),$bind($_,$_.stop)))}})},updateNews:function(){var e=pagr_Dom.query("aside.news ul li:first-child")[0],t=dua_Views.newsContent(this.news);e.innerHTML=t,pagr_App.storage.dataStore("settings").set("readedNews",this.newsIds),this.set_unreaded(0)},set_unreaded:function(e){return this.unreadedEl.style.display=e>0?"inline-block":"none",this.unreadedEl.innerHTML=e>0?e+"":"",e},__class__:dua_NewsService};var dua_NoteEditor=function(e){null==e&&(e=".note-layer"),this.linkDialog=null;var t=this;this.editContainer=pagr_Dom.getElement(dua_NoteEditor.render()),this.editEl=pagr_Dom.query(".editable.content",this.editContainer)[0];var n;try{n=new wysihtml5.Editor(this.editEl,{toolbar:this.toolbar})}catch(a){n=null}this.editor=n,this.toolbar=this.editContainer.firstElementChild,this.linkButton=pagr_Dom.query('[data-edit-action="link"]',this.toolbar)[0],this.linkContainer=pagr_Dom.query(".link-editor",this.editContainer)[0],this.f=new tink_core_FutureTrigger,this.viewport=pagr_Dom.query(".pagr .viewport")[0],pagr_Dom.query(e)[0].appendChild(this.editContainer),this.linkDialog=new dua_LinkDialog(pagr_Dom.query(".content",this.linkContainer)[0]),pagr__$Dom_Query_$Impl_$.on("[data-edit-action]","touchend click",null,$bind(this,this.onToolbarAction)),pagr__$Dom_Query_$Impl_$.on("[data-edit-action]","mousedown",null,function(e){"cancel-link"!=e.at.getAttribute("data-edit-action")&&(t.editorCaret=t.editor.composer.selection.getBookmark())}),pagr__$Dom_Query_$Impl_$.on(".editable.content","mouseup",null,function(e){t.editorCaret=t.editor.composer.selection.getBookmark()}),pagr__$Dom_Query_$Impl_$.on(".editable.content","mousemove",null,function(e){t.editorCaret=t.editor.composer.selection.getBookmark()})};dua_NoteEditor.__name__=["dua","NoteEditor"],dua_NoteEditor.render=function(){var e=tink_template__$Html_Html_$Impl_$.buffer(),t="\r\n";e.s+=t;var n='<div class="note-editor ">\r\n    <div class="header">\r\n      <div class="title">Notiz bearbeiten</div>\r\n      <div class="toolbar">\r\n        ';e.s+=n;var a=dua_Views.tooltip(tink_template__$Html_Html_$Impl_$.escape("Link einfügen"));e.s+=a;var r='\r\n        <div class="item" data-edit-action="link">\r\n          <i class="fa fa-link"></i></label>\r\n        </div>\r\n        ';e.s+=r;var i=dua_Views.tooltip(tink_template__$Html_Html_$Impl_$.escape("Link löschen"));e.s+=i;var o='\r\n        <div class="item" data-edit-action="unlink">\r\n          <i class="fa fa-unlink"></i>\r\n        </div>\r\n        ';e.s+=o;var s=dua_Views.tooltip(tink_template__$Html_Html_$Impl_$.escape("Speichern"));e.s+=s;var l='\r\n        <div class="item" data-edit-action="save">\r\n          <i class="fa dua-save"></i>\r\n        </div>\r\n        <div class="item" data-edit-action="cancel">\r\n          <i class="fa dua-close"></i>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class="editable content"></div>\r\n    <div class="link-editor">\r\n      <div class="header">\r\n        <div class="title">Link einfügen</div>\r\n        <div class="toolbar">\r\n        <div class="item" data-edit-action="cancel-link">\r\n          <i class="fa dua-close"></i>\r\n        </div>\r\n      </div>\r\n      </div>\r\n      <div class="content"></div>\r\n    </div>\r\n  </div>\r\n';e.s+=l;var _=e.s;return _},dua_NoteEditor.prototype={editContainer:null,editor:null,editorCaret:null,toolbar:null,linkButton:null,linkContainer:null,linkDialog:null,f:null,viewport:null,onToolbarAction:function(e){this.editor.composer.selection.setBookmark(this.editorCaret);var t=e.at.getAttribute("data-edit-action");switch(e.event.preventDefault(),t){case"cancel":this.editContainer.blur(),this.editContainer.classList.toggle("active",!1),this.hideLinkDialog(),this.f.trigger(tink_core_Outcome.Success(this.editor.getValue(!1)));break;case"cancel-link":this.hideLinkDialog();break;case"link":this.showLinkDialog();break;case"save":this.editContainer.blur(),this.editContainer.classList.toggle("active",!1),this.hideLinkDialog(),this.f.trigger(tink_core_Outcome.Success(this.editor.getValue(!1)));break;case"unlink":0!=this.editor.composer.commands.state("createLink")&&this.editor.composer.commands.exec("removeLink")}},edit:function(e){return this.f=new tink_core_FutureTrigger,this.editContainer.classList.toggle("active",!0),this.editContainer.focus(),this.editor.setValue(e),this.editor.focus(!0),this.f},hide:function(){this.editContainer.blur(),this.editContainer.classList.toggle("active",!1),this.hideLinkDialog(),this.f.trigger(tink_core_Outcome.Success(this.editor.getValue(!1)))},showLinkDialog:function(){var e=this,t=this.editor.composer.commands.state("createLink");this.linkButton.classList.add("active"),this.linkContainer.classList.add("active"),this.linkDialog.build({url:t?t[0].href:"",description:"",local:"0"}).handle(function(t){switch(t[1]){case 0:var n=t[2];e.editor.composer.selection.setBookmark(e.editorCaret),e.editor.composer.commands.exec("createLink",{href:n.url,target:"_blank","data-local":n.local}),e.hideLinkDialog();break;case 1:0==t[2]&&(e.editor.composer.selection.setBookmark(e.editorCaret),e.hideLinkDialog())}}),this.linkDialog.focus()},hideLinkDialog:function(){
this.linkButton.classList.remove("active"),this.linkContainer.classList.remove("active")},colorize:function(e){this.editContainer.setAttribute("data-color",dua_modes__$_$impl_NotesUI.getColor(e))},position:function(e,t){var n=this.editContainer.getBoundingClientRect(),a=this.viewport.parentElement.getBoundingClientRect();this.editContainer.style.left=e+"px",this.editContainer.style.top=t+"px",this.editContainer.classList.toggle("close-top",t<n.height+a.top+10)},__class__:dua_NoteEditor};var dua_SettingsLoader=function(){};dua_SettingsLoader.__name__=["dua","SettingsLoader"],dua_SettingsLoader.load=function(e,t,n){null==n&&(n=haxe_Http.requestUrl);var a;try{a=JSON.parse(n(e))}catch(r){a={}}return t?a:utils_Helper.merge(a,null==a.include?dua_SettingsLoader.DEFAULT:dua_SettingsLoader.load(haxe_io_Path.join([haxe_io_Path.directory(e),a.include]),null,n))};var dua_ThumbSlider=function(e){this.centerPage=1,this.slideCallback=null,this.translateX=0,this.rowPages=1;var t=this;this.app=e,this.inputEl=pagr_Dom.query(".position input")[0],this.getEls(),pagr_Dom.on(window,"resize",null,tink_core__$Callback_Callback_$Impl_$.fromNiladic($bind(this,this.handleResize)));externs_HammerMaker.make(this.view,{domEvents:!0,recognizers:[externs__$Hammer_HammerRecognizerConfig_$Impl_$._new(Hammer.Tap),externs__$Hammer_HammerRecognizerConfig_$Impl_$._new(Hammer.Pan,{threshold:0,direction:Hammer.DIRECTION_ALL}),externs__$Hammer_HammerRecognizerConfig_$Impl_$._new(Hammer.Press,{threshold:1e3})]});e.pages.get_navigated().handle(function(e){var t=pagr_Dom.query("#toggle-thumb-slider")[0];t.checked=!1}),pagr__$Dom_Query_$Impl_$.on(".position input","click",null,function(e){var t=pagr_Dom.query("#toggle-thumb-slider")[0];new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){t.checked=!0},500),$bind($_,$_.stop)))});var n=pagr_Dom.query(".position .go")[0];pagr__$Dom_Query_$Impl_$.on(".position .go","click",null,tink_core__$Callback_Callback_$Impl_$.fromNiladic($bind(this,this.navigate))),pagr__$Dom_Query_$Impl_$.on(".position input","keyup",null,function(e){13==e.event.keyCode&&n.click()}),pagr_Dom.on(this.view,"panstart",null,$bind(this,this.onStartDrag)),pagr__$Dom_Query_$Impl_$.on(".overview a.slide","click",null,$bind(this,this.onSlide)),pagr__$Dom_Query_$Impl_$.on(".overview a.slide","press",null,$bind(this,this.startSlide)),pagr__$Dom_Query_$Impl_$.on("body","touchend mouseup",null,tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){if(null!=t.slideCallback){var e=t.slideCallback;null!=e&&e.dissolve(),t.slideCallback=null}})),pagr__$Dom_Query_$Impl_$.on("#toggle-thumb-slider","change",null,function(e){var n=e.at;n.checked&&(t.handleResize(),t.centerEl.focus())}),this.handleResize()};dua_ThumbSlider.__name__=["dua","ThumbSlider"],dua_ThumbSlider.prototype={app:null,viewport:null,view:null,content:null,centerEl:null,pages:null,rowPages:null,translateX:null,slideCallback:null,centerPage:null,inputEl:null,navigate:function(){var e=this.inputEl.value,t=titleToPage[e];if(null!=t){var n='.window.overview a.nav[href="?page='+t+'"]';pagr_Dom.query(n)[0].click(),this.inputEl.blur()}else this.app.set_page(this.app.get_page())},onStartDrag:function(e){var t=this;e.stopPropagation(),this.view.classList.add("drag");var n=0,a=e.gesture.pointers[0].clientX,r=pagr_Dom.on(this.view,"panmove",null,function(e){var r=e.gesture.pointers[0].clientX;t.translateX-=r-a,t.centerEl.style.transform="translateX(-"+t.translateX+"px)",a=r,n=e.gesture.velocityX});pagr_Dom.once(this.view,"panend",function(e){n*=200;var i=t.pages[1].getBoundingClientRect(),o="landscape"==t.app.get_orientation()?2:1,s=Std.parseInt(window.getComputedStyle(t.pages[1]).marginRight),l=i.width*o+s;null!=r&&r.dissolve(),t.translateX-=e.gesture.pointers[0].clientX-a;var _=Math.ceil((t.translateX-n)/l*o);t.set_centerPage(_%2==1?_-1:_),t.view.classList.remove("drag"),t.doSlide()})},startSlide:function(e){var t=this,n=new haxe_Timer(100);n.run=function(){t.onSlide(e)};var a=new tink_core__$Callback_SimpleLink($bind(n,n.stop));this.slideCallback=a},onSlide:function(e){var t=e.at,n=t.classList.contains("next")?1:-1,a="landscape"==this.app.get_orientation()?2:1,r=this;r.set_centerPage(r.get_centerPage()+n*a),this.doSlide()},setActivePage:function(){for(var e=this.app.get_page(),t=e+1,n=0,a=pagr_Dom.query(".window.overview a.active");n<a.length;){var r=a[n];++n,r.classList.toggle("active")}for(var i=t-this.app.get_step()+1,o=t+1;i<o;){var s=i++,l=pagr_Dom.query(".window.overview a.nav:nth-child("+s+")"),_=l[l.length-1];null!=_&&(_.classList.toggle("active"),this.set_centerPage(e-1),this.doSlide())}},doSlide:function(){var e=this.pages[1],t=Std.parseInt(window.getComputedStyle(e).marginRight),n="landscape"==this.app.get_orientation()?2:1,a=this.get_centerPage()*e.getBoundingClientRect().width+this.get_centerPage()*t/n;this.centerEl.style.transform="translateX(-"+a+"px)",this.translateX=a},handleResize:function(){if(null!=pagr_Dom.query("#toggle-thumb-slider:checked")[0]){var e=this.viewport.getBoundingClientRect(),t=Std.parseInt(window.getComputedStyle(this.viewport).margin),n=e.left-t,a=this.pages[1].getBoundingClientRect(),r=Std.parseInt(window.getComputedStyle(this.pages[1]).marginRight),i=t+e.right,o="landscape"==this.app.get_orientation(),s=o?2:1,l=1;this.view.style.width=i+"px";var _=(i-n)/2+n-a.width*s/2;for(this.content.style.paddingLeft=_+"px",this.content.style.paddingRight=i-_-a.width*s-t+"px";l<this.pages.length;)this.pages[l].style.removeProperty("margin-right"),++l;this.rowPages=this.pages.length,o||(this.rowPages-=2);var u=this.rowPages*a.width+(this.rowPages-1)*r/s,c=this.rowPages*s;this.centerEl.style.width=Math.ceil(u)+"px";for(var d=o?c-1:c;d<this.pages.length;){var p=this.pages[d];p&&(p.style.marginRight="0"),c+=this.rowPages*s,d=o?c-1:c}this.setActivePage()}},getEls:function(){this.viewport=pagr_Dom.query(".pagr .viewport")[0],this.view=pagr_Dom.query("footer .window.overview")[0],this.content=pagr_Dom.query("footer .window.overview .view .content")[0],this.centerEl=pagr_Dom.query("footer .window.overview .view .content div")[0],this.pages=pagr_Dom.query("footer .window.overview .view .content a")},get_centerPage:function(){return this.centerPage},set_centerPage:function(e){return this.centerPage=e<=0?0:e>=this.pages.length-("landscape"==this.app.get_orientation()?0:2)?this.pages.length-("landscape"==this.app.get_orientation()?2:3):e,e},__class__:dua_ThumbSlider};var tink_template__$Html_Html_$Impl_$={};tink_template__$Html_Html_$Impl_$.__name__=["tink","template","_Html","Html_Impl_"],tink_template__$Html_Html_$Impl_$.escape=function(e){if(null==e)return null;e=null==e?"null":""+e;for(var t=0,n=0,a=e.length,r="";n<a;){var i=e.charAt(n++);switch(i){case'"':var o=t;t=n,r+=e.substring(o,t-1)+"&quot;";break;case"&":var s=t;t=n,r+=e.substring(s,t-1)+"&amp;";break;case"<":var l=t;t=n,r+=e.substring(l,t-1)+"&lt;";break;case">":var _=t;t=n,r+=e.substring(_,t-1)+"&gt;"}}var u=r+=HxOverrides.substr(e,t,null);return u},tink_template__$Html_Html_$Impl_$.of=function(e){return tink_template__$Html_Html_$Impl_$.escape(Std.string(e))},tink_template__$Html_Html_$Impl_$.buffer=function(){var e={s:""};return e};var js_Boot=function(){};js_Boot.__name__=["js","Boot"],js_Boot.getClass=function(e){if(e instanceof Array&&null==e.__enum__)return Array;var t=e.__class__;if(null!=t)return t;var n=js_Boot.__nativeClassName(e);return null!=n?js_Boot.__resolveNativeClass(n):null},js_Boot.__string_rec=function(e,t){if(null==e)return"null";if(t.length>=5)return"<...>";var n=typeof e;switch("function"==n&&(e.__name__||e.__ename__)&&(n="object"),n){case"function":return"<function>";case"object":if(e instanceof Array){if(e.__enum__){if(2==e.length)return e[0];var a=e[0]+"(";t+="\t";for(var r=2,i=e.length;r<i;){var o=r++;a+=2!=o?","+js_Boot.__string_rec(e[o],t):js_Boot.__string_rec(e[o],t)}return a+")"}var s=e.length,l="[";t+="\t";for(var _=0,u=s;_<u;){var c=_++;l+=(c>0?",":"")+js_Boot.__string_rec(e[c],t)}return l+="]"}var d;try{d=e.toString}catch(p){return"???"}if(null!=d&&d!=Object.toString&&"function"==typeof d){var h=e.toString();if("[object Object]"!=h)return h}var g=null,m="{\n";t+="\t";var v=null!=e.hasOwnProperty;for(var g in e)v&&!e.hasOwnProperty(g)||"prototype"!=g&&"__class__"!=g&&"__super__"!=g&&"__interfaces__"!=g&&"__properties__"!=g&&(2!=m.length&&(m+=", \n"),m+=t+g+" : "+js_Boot.__string_rec(e[g],t));return t=t.substring(1),m+="\n"+t+"}";case"string":return e;default:return String(e)}},js_Boot.__interfLoop=function(e,t){if(null==e)return!1;if(e==t)return!0;var n=e.__interfaces__;if(null!=n)for(var a=0,r=n.length;a<r;){var i=a++,o=n[i];if(o==t||js_Boot.__interfLoop(o,t))return!0}return js_Boot.__interfLoop(e.__super__,t)},js_Boot.__instanceof=function(e,t){if(null==t)return!1;switch(t){case Array:return e instanceof Array&&null==e.__enum__;case Bool:return"boolean"==typeof e;case Dynamic:return!0;case Float:return"number"==typeof e;case Int:return"number"==typeof e&&(0|e)===e;case String:return"string"==typeof e;default:if(null==e)return!1;if("function"==typeof t){if(e instanceof t)return!0;if(js_Boot.__interfLoop(js_Boot.getClass(e),t))return!0}else if("object"==typeof t&&js_Boot.__isNativeObj(t)&&e instanceof t)return!0;return t==Class&&null!=e.__name__||(t==Enum&&null!=e.__ename__||e.__enum__==t)}},js_Boot.__nativeClassName=function(e){var t=js_Boot.__toStr.call(e).slice(8,-1);return"Object"==t||"Function"==t||"Math"==t||"JSON"==t?null:t},js_Boot.__isNativeObj=function(e){return null!=js_Boot.__nativeClassName(e)},js_Boot.__resolveNativeClass=function(e){return $global[e]};var pagr__$_$impl_Views=function(){};pagr__$_$impl_Views.__name__=["pagr","__impl","Views"],pagr__$_$impl_Views.noScale=function(e){var t=tink_template__$Html_Html_$Impl_$.buffer(),n="\n\t.pagr .zoomable .noscale {\n\t\ttransform: scale(";t.s+=n;var a=tink_template__$Html_Html_$Impl_$.of(1/e.a);t.s+=a;var r=");\n\t}\n";t.s+=r;var i=t.s;return i};var dua_Views=function(){};dua_Views.__name__=["dua","Views"],dua_Views.pos=function(e){return"top: "+e.b+"px; left: "+e.a+"px; "},dua_Views.clipPath=function(e,t,n,a){return null==a&&(a=0),null==n&&(n=0),null==t&&(t=0),null==e&&(e=0),"M"+e+" "+t+"l"+n+" 0 0 "+a+" -"+n+" 0Z"},dua_Views.printable=function(e,t,n,a){var r=tink_template__$Html_Html_$Impl_$.buffer(),i="\n";r.s+=i;var o="<style>\n    a.print {\n      display: none;\n    }\n    .orange {\n      color: #ff6600;\n    }\n  </style>\n  ";r.s+=o;var s=e;r.s+=s;var l="\n  <div>";r.s+=l;var _=tink_template__$Html_Html_$Impl_$.escape(n);r.s+=_;var u="<br>&copy;  ";r.s+=u;var c=tink_template__$Html_Html_$Impl_$.escape(t);r.s+=c;var d=" ";r.s+=d;var p=tink_template__$Html_Html_$Impl_$.escape(a);r.s+=p;var h="</div>\n";r.s+=h;var g=r.s;return g},dua_Views.playerContent=function(e){var t=tink_template__$Html_Html_$Impl_$.buffer(),n="\n";t.s+=n;var a="<";t.s+=a;var r=tink_template__$Html_Html_$Impl_$.escape(e);t.s+=r;var i=' id="annotation-';t.s+=i;var o=tink_template__$Html_Html_$Impl_$.escape(e);t.s+=o;var s='" class="video-js vjs-default-skin vjs-big-play-centered" data-setup=\'{"nativeControlsForTouch": false, "controls": true, "autoplay": true, "preload": "metadata" }\'>\n    <p class="vjs-no-js">To view this video please enable JavaScript, and consider upgrading to a web browser that supports HTML5 video</p>\n  </';t.s+=s;var l=tink_template__$Html_Html_$Impl_$.escape(e);t.s+=l;var _=">\n";t.s+=_;var u=t.s;return u},dua_Views.tooltip=function(e,t,n){null==n&&(n="");var a=tink_template__$Html_Html_$Impl_$.buffer(),r="\n";a.s+=r;var i=tink_template__$Html_Html_$Impl_$.buffer(),o="\n    ";if(i.s+=o,t){var s="\n      <p>";i.s+=s,i.s+=e;var l="</p>\n    ";i.s+=l}else{var _="\n      ";i.s+=_,i.s+=e;var u="\n    ";i.s+=u}var c=i.s,d=c,p='<div class="tooltip" data-placement="';a.s+=p;var h=tink_template__$Html_Html_$Impl_$.escape(n);a.s+=h;var g='">\n    <div class="tooltip-top">\n      <div class="tooltip-content">\n        ';a.s+=g,a.s+=d;var m="\n      </div>\n    </div>\n  </div>\n";a.s+=m;var v=a.s;return v},dua_Views.newsContent=function(e){var t=tink_template__$Html_Html_$Impl_$.buffer(),n="\n";t.s+=n;var a='<div class="news-content">\n  ';t.s+=a;for(var r=e.nodes.resolve("news_item").h;null!=r;){var i=r.item;r=r.next;var o=i,s='\n    <div class="news">\n      ';if(t.s+=s,o.hasNode.resolve("thumb")){var l='\n      <div class="img\n        ';if(t.s+=l,Std.parseInt(o.node.resolve("thumb").att.resolve("width"))>83){var _="\n         large\n        ";t.s+=_}var u='"\n        style="background-image:url(';t.s+=u;var c=tink_template__$Html_Html_$Impl_$.escape(o.node.resolve("thumb").att.resolve("src"));t.s+=c;var d=');"></div>\n      ';t.s+=d}var p='<div class="text">\n        <h2>';t.s+=p;var h=tink_template__$Html_Html_$Impl_$.escape(o.node.resolve("title").get_innerData());t.s+=h;var g="</h2>\n        ";if(t.s+=g,o.hasNode.resolve("subtitle")){var m="\n        <p>";t.s+=m;var v=tink_template__$Html_Html_$Impl_$.escape(o.node.resolve("subtitle").get_innerData());t.s+=v;var f="</p>\n        ";t.s+=f}var $="<p>";t.s+=$;var b=o.node.resolve("text").get_innerData();t.s+=b;var w="</p>\n        ";if(t.s+=w,o.hasNode.resolve("price")){var k='\n        <p class="price">';t.s+=k;var y=tink_template__$Html_Html_$Impl_$.escape(o.node.resolve("price").get_innerData());t.s+=y;var x="</p>\n        ";t.s+=x}if(o.hasNode.resolve("url")){var C='\n        <a target="blank" href="';t.s+=C;var D=tink_template__$Html_Html_$Impl_$.escape(o.node.resolve("url").att.resolve("src"));t.s+=D;var S='">\n          <i class="dua-external-link"></i>\n          ';t.s+=S;var I=tink_template__$Html_Html_$Impl_$.escape(o.node.resolve("url").att.resolve("title"));t.s+=I;var T="\n        </a>\n        ";t.s+=T}var M="</div>\n    </div>\n  ";t.s+=M}var A="\n  </div>\n";t.s+=A;var L=t.s;return L};var dua_Welcome=function(e){var t=this;this.app=e,this.welcomeContentEl=pagr_Dom.query(".windows .welcome .content")[0],this.toggler=pagr_Dom.query("#toggle-window-welcome")[0],this.checkbox=pagr_Dom.getElement(dua_windows__$_$impl_Setting.inverseCheckbox(tink_template__$Html_Html_$Impl_$.escape("welcome"),tink_template__$Html_Html_$Impl_$.escape("Dieses Fenster beim Start nicht mehr anzeigen."))),this.welcomeContentEl.appendChild(this.checkbox);new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){e.get_settings().welcome.enabled&&(t.toggler.checked=!0),pagr_Dom.on(pagr_Dom.query("a",t.welcomeContentEl)[0],"click",null,tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){t.toggler.checked=!1}))},10),$bind($_,$_.stop)))};dua_Welcome.__name__=["dua","Welcome"],dua_Welcome.prototype={welcomeContentEl:null,toggler:null,checkbox:null,__class__:dua_Welcome};var dua__$_$impl_Confirm=function(){};dua__$_$impl_Confirm.__name__=["dua","__impl","Confirm"];var dua_annotations_ApiEndpoints=function(){};dua_annotations_ApiEndpoints.__name__=["dua","annotations","ApiEndpoints"];var dua_annotations_AnnotationController=function(e){this.showHint=!0,this.fromServerSync=!1,this.baseUrl="";var t=this;this.app=e,this.root=pagr_Dom.query(".pagr")[0],this.store=dua_annotations_AnnotationStore.getInstance(),this.endpointParameter={userSSO:"",userId:""};var n=e.get_settings();this.root.classList.toggle("sync-inactive",!0),this.annotationSettings=n.annotations,this.annotationSettings.enabled&&this.annotationSettings.sync.allowed&&(this.baseUrl=this.annotationSettings.sync.server.baseUrl,utils_Helper.mergeInto(this.endpointParameter,this.annotationSettings.sync.server.baseParameter),this.onSyncActiveChange(),e.get_settingsChanged().handle(function(e){var n=e.name,a=e.value;"annotations.sync"==n?(t.root.classList.toggle("sync-inactive",!a.enabled),t.onSyncActiveChange()):"annotations"==n&&null!=a.sync&&(t.root.classList.toggle("sync-inactive",!a.sync.enabled),t.onSyncActiveChange())}),this.store.get_changed().handle(function(e){t.fromServerSync||utils_Helper.debounce("sync",function(){t.onSyncActiveChange()},300)}))};dua_annotations_AnnotationController.__name__=["dua","annotations","AnnotationController"],dua_annotations_AnnotationController.WRONG_LOGIN=function(e){return Lambda.has([118,202,203,207,208,209,210,211,212,213,214,215,216,217],e)},dua_annotations_AnnotationController.prototype={app:null,baseUrl:null,root:null,annotationSettings:null,connectionError:null,store:null,endpointParameter:null,requestFailure:function(e){if(null!=e){e.code=null==e.code?"null":""+e.code;var t=Std.parseInt(e.code),n="Canceled"==e.message;n&&(this.annotationSettings.sync.enabled=!1,this.app.setSetting("annotations.sync",this.annotationSettings.sync)),dua_annotations_AnnotationController.WRONG_LOGIN(t)&&(this.annotationSettings.sync.enabled=!0,this.app.setSetting("annotations.sync",this.annotationSettings.sync))}},doSync:function(){var e=this,t=this.store.find(function(e,t){return!!t.dirty||""==t.annotationId}),n=this.store.find(function(e,t){return t.shouldDelete});this.alert("doSync"),tink_core__$Future_Future_$Impl_$.fromMany(this.sync({dels:n,dirty:t})).handle(tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){e.alert("synced"),e.loadList()}))},connectionCb:null,onSyncActiveChange:function(e){var t=this;null==this.connectionCb&&(e||this.annotationSettings.sync.enabled)&&(this.connectionCb=this.checkConnection().handle(function(e){if(0==e[1]&&1==e[2]){t.alert("connection establised"),t.connectionCb=null,t.connectionError=null;var n=function(e){t.endpointParameter.userSSO=e.userSSO,t.endpointParameter.userId=e.userId,t.store.userId=t.endpointParameter.userId,t.doSync()};t.root.classList.toggle("sync-inactive",!1),pagr_App.runtime.isLoggedIn()?n(pagr_App.runtime.getUserSsoData()):pagr_App.runtime.login(n,$bind(t,t.requestFailure))}}))},alert:function(e){},sync:function(e){for(var t=[],n=0,a=e.dels;n<a.length;){var r=a[n];++n,t.push(this.deleteAnnotation(r))}for(var i=0,o=e.dirty;i<o.length;){var s=o[i];++i,t.push(""!=s.annotationId?this.updateAnnotation(s):this.addAnnotation(s))}return t},addAnnotation:function(e){var t=this,n=new tink_core_FutureTrigger,a=this.prepareAnnotation(e);return a.annotationTypeId=e.annotationTypeId,this.doRequest(dua_annotations_ApiEndpoints.Create,a).handle(function(a){if(0==a[1]){var r=a[2];e.annotationId=r.annotationId,e.annotationVersion=r.annotationVersion,e.dirty=!1,t.store.set(e),n.trigger(tink_core_Outcome.Success(!0))}}),n},updateAnnotation:function(e){var t=this,n=new tink_core_FutureTrigger,a=this.prepareAnnotation(e);return a.annotationId=e.annotationId,a.annotationVersion=e.annotationVersion,this.doRequest(dua_annotations_ApiEndpoints.Update,a).handle(function(a){switch(a[1]){case 0:var r=a[2];e.dirty=!1,e.annotationVersion=r.annotationVersion,t.store.set(e),n.trigger(tink_core_Outcome.Success(!0));break;case 1:"251"==a[2].code&&(t.store["delete"](e),n.trigger(tink_core_Outcome.Success(!0)))}}),n},deleteAnnotation:function(e){var t=this,n=new tink_core_FutureTrigger,a=Reflect.copy(this.endpointParameter);return a.annotationId=e.annotationId,a.annotationVersion=e.annotationVersion,this.doRequest(dua_annotations_ApiEndpoints.Delete,a).handle(function(a){switch(a[1]){case 0:t.store["delete"](e),n.trigger(tink_core_Outcome.Success(!0));break;case 1:"251"==a[2].code&&(t.store["delete"](e),n.trigger(tink_core_Outcome.Success(!0)))}}),n},prepareAnnotation:function(e){var t=Reflect.copy(this.endpointParameter);return t.annotationContent=e.annotationContent,t.annotationPosition=e.annotationPosition,t.readablePosition="Seite "+Std.parseInt(e.annotationPosition),t.client="Online",t.dienstApiVersion="1.0",t},fromServerSync:null,loadList:function(){var e=this;this.doRequest(dua_annotations_ApiEndpoints.Read,this.endpointParameter).handle(function(t){if(0==t[1]){var n=t[2];e.alert("list loaded"),e.fromServerSync=!0;for(var a=new haxe_ds_StringMap,r=0,i=e.store.find(function(e,t){return!0});r<i.length;){var o=i[r];if(++r,""!=o.annotationId){var s=o.annotationId;null!=__map_reserved[s]?a.setReserved(s,o):a.h[s]=o}}for(var l=0,_=n.annotationList;l<_.length;){var u=_[l];++l;var c=u.annotationPosition,d={annotationId:u.annotationId,dirty:!1,readOnly:u.readOnly,dienstApiVersion:u.dienstApiVersion,client:u.client,annotationVersion:u.annotationVersion,annotationTypeId:u.annotationTypeId,annotationPosition:dua_annotations__$Data_AnnotationPosition_$Impl_$.ofString(c),annotationContent:u.annotationContent},p=e.store.get(c);if(null==p)e.store.add(d);else{p.annotationVersion<d.annotationVersion&&!p.shouldDelete&&e.store.set(d);var h=u.annotationId;(null!=__map_reserved[h]?a.existsReserved(h):a.h.hasOwnProperty(h))&&a.remove(u.annotationId)}}for(var g=new haxe_ds__$StringMap_StringMapIterator(a,a.arrayKeys());g.hasNext();){var m=g.next();e.store["delete"](m)}e.fromServerSync=!1,e.store.syncEnd()}})},doRequest:function(e,t){var n=this,a=new XMLHttpRequest,r=new tink_core_FutureTrigger;if(a.onload=function(t){var i;try{var o=e.parser(a.responseText);"error"==o.responseMessage?i=tink_core_Outcome.Failure({code:o.messageCode,message:o.errorMessage}):(n.connectionError=null,i=tink_core_Outcome.Success(o))}catch(s){i=tink_core_Outcome.Failure({code:a.status,message:a.statusText})}r.trigger(i)},t.userSSO=this.endpointParameter.userSSO,t.userId=this.endpointParameter.userId,a.onerror=function(e){r.trigger(tink_core_Outcome.Failure({code:e.target.status,message:e.target.statusText}))},a.open(e.method,this.baseUrl+e.url),this.annotationSettings.sync.server.httpAuth.enabled){var i="Basic "+btoa(Std.string(this.annotationSettings.sync.server.httpAuth.user)+":"+Std.string(this.annotationSettings.sync.server.httpAuth.password));a.setRequestHeader("Authorization",i)}return a.setRequestHeader("Accept","application/json"),a.setRequestHeader("Content-Type","application/json"),a.send(JSON.stringify(t)),r},showHint:null,checkConnection:function(e){var t=this;null==e&&(e=new tink_core_FutureTrigger);var n=function(){t.annotationSettings.sync.enabled&&t.showHint&&(dua_ConfirmDialog.show("Ein Verbindungsproblem ist aufgetreten. Ihre Notizen und Anmerkungen werden offline gespeichert. Sie werden zu einem späteren Zeitpunkt synchronisiert."),t.showHint=!1),t.root.classList.toggle("sync-inactive",!0);new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){t.checkConnection(e)},5e3),$bind($_,$_.stop)))};return pagr_App.runtime.isOnline()?(this.showHint=!0,e.trigger(tink_core_Outcome.Success(!0))):n(),e},get_needsSync:function(){return this.store.get_needsSync()},__class__:dua_annotations_AnnotationController};var dua_annotations_AnnotationStore=function(){this.userId="";var e=this;this._synced=new tink_core_SignalTrigger,this._changed=new tink_core_SignalTrigger,this.changed=this._changed,this.synced=this._synced,this.items=new haxe_ds_StringMap;new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){e.fromLocalStorage()},200),$bind($_,$_.stop)))};dua_annotations_AnnotationStore.__name__=["dua","annotations","AnnotationStore"],dua_annotations_AnnotationStore.getInstance=function(){return null==dua_annotations_AnnotationStore.instance?dua_annotations_AnnotationStore.instance=new dua_annotations_AnnotationStore:dua_annotations_AnnotationStore.instance},dua_annotations_AnnotationStore.prototype={_synced:null,_changed:null,changed:null,synced:null,items:null,userId:null,syncEnd:function(){tink_core__$Callback_CallbackList_$Impl_$.invoke(this._synced.handlers,tink_core_Noise.Noise)},softDelete:function(e){""==e.annotationId?this["delete"](e):(e.dirty=!1,e.shouldDelete=!0,this.set(e))},"delete":function(e){var t=this.getStorageKey(e);this.items.remove(t),localforage.removeItem(t)},deleteAll:function(e){for(var t=0,n=this.find(function(e,t){return!0});t<n.length;){var a=n[t];++t,null!=e&&e(a)||this.softDelete(a)}this.syncEnd()},find:function(e){for(var t=[],n=this.items.keys();n.hasNext();){var a=n.next(),r=this.items,i=null!=__map_reserved[a]?r.getReserved(a):r.h[a];""!=this.userId&&null!=i.userId&&""!=i.userId&&i.userId!=this.userId||!e(a,i)||t.push(i)}return t},findByGuid:function(e){return this.find(function(t,n){var a=n.annotationPosition;return HxOverrides.substr(a,a.indexOf(":")+1,null)==e})},add:function(e){this.set(e)},set:function(e){var t=this.getStorageKey(e);null!=e.userId&&""!=e.userId||(e.userId=this.userId);var n=this.items;null!=__map_reserved[t]?n.setReserved(t,e):n.h[t]=e,localforage.setItem(t,e),this.checkDirty()},get:function(e){if(this.exists(e)){var t=this.items;return null!=__map_reserved[e]?t.getReserved(e):t.h[e]}return null},exists:function(e){var t=this.items;return null!=__map_reserved[e]?t.existsReserved(e):t.h.hasOwnProperty(e)},fromLocalStorage:function(){var e=this;localforage.iterate(function(t,n,a){var r=e.items;null!=__map_reserved[n]?r.setReserved(n,t):r.h[n]=t},function(){e.checkDirty(),e.syncEnd()})},checkDirty:function(){var e=[],t=[];e=this.find(function(e,t){return null!=t.dirty&&t.dirty}),t=this.find(function(e,t){return null!=t.shouldDelete&&t.shouldDelete}),(t.length>0||e.length>0)&&tink_core__$Callback_CallbackList_$Impl_$.invoke(this._changed.handlers,{dirty:e,dels:t})},getStorageKey:function(e){return dua_annotations__$Data_AnnotationPosition_$Impl_$.toString(e.annotationPosition)},get_changed:function(){return this.changed},get_synced:function(){return this.synced},get_needsSync:function(){return Lambda.exists(this.items,function(e){return e.dirty})},__class__:dua_annotations_AnnotationStore};var dua_annotations__$Data_AnnotationPosition_$Impl_$={};dua_annotations__$Data_AnnotationPosition_$Impl_$.__name__=["dua","annotations","_Data","AnnotationPosition_Impl_"],dua_annotations__$Data_AnnotationPosition_$Impl_$._new=function(e,t){var n=""+e+":"+t;return n},dua_annotations__$Data_AnnotationPosition_$Impl_$.ofObject=function(e){return dua_annotations__$Data_AnnotationPosition_$Impl_$._new(e.page,e.guid)},dua_annotations__$Data_AnnotationPosition_$Impl_$.ofString=function(e){return dua_annotations__$Data_AnnotationPosition_$Impl_$._new(Std.parseInt(e),HxOverrides.substr(e,e.indexOf(":")+1,null))},dua_annotations__$Data_AnnotationPosition_$Impl_$.toString=function(e){return e};var dua_annotations__$Data_AnnotationContent_$Impl_$={};dua_annotations__$Data_AnnotationContent_$Impl_$.__name__=["dua","annotations","_Data","AnnotationContent_Impl_"],dua_annotations__$Data_AnnotationContent_$Impl_$._new=function(e){var t=JSON.stringify(e);return t},dua_annotations__$Data_AnnotationContent_$Impl_$.getData=function(e){return JSON.parse(e)},dua_annotations__$Data_AnnotationContent_$Impl_$.ofData=function(e){return dua_annotations__$Data_AnnotationContent_$Impl_$._new(e)},dua_annotations__$Data_AnnotationContent_$Impl_$.toString=function(e){return e};var dua_materials__$OwnMaterials_OwnMaterial_$Impl_$={};dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.__name__=["dua","materials","_OwnMaterials","OwnMaterial_Impl_"],dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.get_url=function(e){return dua_annotations__$Data_AnnotationContent_$Impl_$.getData(e.annotationContent).url},dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.set_url=function(e,t){var n=new EReg("[^:/?#]+:",""),a=dua_annotations__$Data_AnnotationContent_$Impl_$.getData(e.annotationContent);return n.match(t)||(t="http://"+t),a.url=t,e.annotationContent=dua_annotations__$Data_AnnotationContent_$Impl_$.ofData(a),t},dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.get_local=function(e){return dua_annotations__$Data_AnnotationContent_$Impl_$.getData(e.annotationContent).local},dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.set_local=function(e,t){var n=dua_annotations__$Data_AnnotationContent_$Impl_$.getData(e.annotationContent);return n.local=t,e.annotationContent=dua_annotations__$Data_AnnotationContent_$Impl_$.ofData(n),t},dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.get_description=function(e){return dua_annotations__$Data_AnnotationContent_$Impl_$.getData(e.annotationContent).description},dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.set_description=function(e,t){var n=dua_annotations__$Data_AnnotationContent_$Impl_$.getData(e.annotationContent);return n.description=t,e.annotationContent=dua_annotations__$Data_AnnotationContent_$Impl_$.ofData(n),t},dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.get_guid=function(e){var t=e.annotationPosition;return HxOverrides.substr(t,t.indexOf(":")+1,null)},dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.get_page=function(e){return Std.parseInt(e.annotationPosition)},dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.set_page=function(e,t){return e.annotationPosition=dua_annotations__$Data_AnnotationPosition_$Impl_$.ofObject({page:t,guid:dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.get_guid(e)}),t},dua_materials__$OwnMaterials_OwnMaterial_$Impl_$._new=function(e,t){var n;return null==t&&(t=utils_GUID.create()),n={annotationId:"",annotationTypeId:"dua_own_material",readOnly:!1,dirty:!0,annotationPosition:dua_annotations__$Data_AnnotationPosition_$Impl_$.ofObject({page:e,guid:t}),annotationContent:dua_annotations__$Data_AnnotationContent_$Impl_$.ofData({url:"",description:"",local:"0"})}};var dua_materials_OwnMaterials=function(e){var t=this;this.app=e,this.store=dua_annotations_AnnotationStore.getInstance(),this.materials=[],this.dialogLayer=pagr_Dom.query(".materials.own li div")[0],this.pages=[],null!=this.dialogLayer&&(this.bubble=pagr_Dom.nearest(this.dialogLayer,".bubble"),pagr__$Dom_Query_$Impl_$.on(".own-material .material a.delete","click",null,$bind(this,this.deleteMaterial)),pagr__$Dom_Query_$Impl_$.on(".own-material .material a.edit","click",null,$bind(this,this.editMaterial)),this.store.get_synced().handle(tink_core__$Callback_Callback_$Impl_$.fromNiladic($bind(this,this.refreshAll))),e.pages.get_navigated().handle(function(e){t.pages=e,t.refreshAll();var n=t.bubble.getAttribute("data-layer"),a=pagr_Dom.query('li[data-layer="'+n+'"]')[0];a.classList.remove("active")}),this.dialog=new dua_LinkDialog(this.dialogLayer),this.buildDialog())};dua_materials_OwnMaterials.__name__=["dua","materials","OwnMaterials"],dua_materials_OwnMaterials.prototype={app:null,store:null,materials:null,dialogLayer:null,bubble:null,dialog:null,pages:null,buildDialog:function(e){var t=this,n=!1;null==e&&(e=dua_materials__$OwnMaterials_OwnMaterial_$Impl_$._new(this.app.get_page()),n=!0),this.dialog.build({url:dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.get_url(e),description:dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.get_description(e),local:dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.get_local(e)}).handle(function(a){switch(a[1]){case 0:var r=a[2];if(dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.set_url(e,r.url),dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.set_local(e,r.local),dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.set_description(e,r.description),n){var i=t.app.get_page();dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.set_page(e,i),t.materials.push(e),t.store.add(e),t.addView(e)}else t.refresh(e);t.updateBubble(),t.buildDialog(),t.updateSiblingMaterial(e,n);break;case 1:0==a[2]&&t.buildDialog()}})},updateSiblingMaterial:function(e,t){var n=t&&"landscape"==this.app.get_orientation()?dua_materials__$OwnMaterials_OwnMaterial_$Impl_$._new(this.getSiblingPage(dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.get_page(e)),dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.get_guid(e)):this.getSiblingMaterial(e);null!=n&&(dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.set_url(n,dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.get_url(e)),dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.set_local(n,dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.get_local(e)),dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.set_description(n,dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.get_description(e)),t&&this.store.add(n))},getSiblingMaterial:function(e){var t=null,n=this.getSiblingPage(dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.get_page(e));if(n>0){var a=this.store.find(function(t,n){var a=n.annotationPosition;return HxOverrides.substr(a,a.indexOf(":")+1,null)==dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.get_guid(e)&&n!=e;
});t=a[0]}return t},getSiblingPage:function(e){return e%2==0?e+1:e-1},refreshAll:function(){var e=this;this.bubble=pagr_Dom.nearest(this.dialogLayer,".bubble");var t=pagr_Dom.query(".content .materials",this.bubble)[0];if(null!=t){var n,a=[],r=function(t){return e.store.find(function(e,n){return"dua_own_material"==n.annotationTypeId&&Std.parseInt(n.annotationPosition)==t})};if(this.app.get_page()>1){for(var i=[],o=0,s=this.pages;o<s.length;){var l=s[o];++o;for(var _=0,u=r(l.getAttribute("data-pos"));_<u.length;){var c=u[_];++_,i.push(c)}}n=i}else{for(var d=[],p=0,h=this.app.pages.all().length;p<h;)for(var g=p++,m=0,v=r(g);m<v.length;){var f=v[m];++m,d.push(f)}var $=d;$.sort(function(e,t){return Std.parseInt(e.annotationPosition)-Std.parseInt(t.annotationPosition)}),n=$}this.materials=n,this.materials=Lambda.array(Lambda.filter(this.materials,function(e){var t=dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.get_guid(e);if(a.indexOf(t)==-1){var n=dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.get_guid(e);return a.push(n),!0}return!1})),t.innerHTML=this.materials.map($bind(this,this.render)).join(""),this.updateBubble()}},editMaterial:function(e){this.buildDialog(this.getMaterial(e.at))},deleteMaterial:function(e){this.bubble=pagr_Dom.nearest(this.dialogLayer,".bubble");var t=pagr_Dom.query(".content .materials",this.bubble)[0],n=this.getMaterial(e.at),a=this.getSiblingMaterial(n);HxOverrides.remove(this.materials,n),t.removeChild(this.getView(n)),this.store.softDelete(n),this.updateBubble(),this.buildDialog(),null!=a&&"landscape"==this.app.get_orientation()&&this.store.softDelete(a)},getMaterial:function(e){e=pagr_Dom.nearest(e,"[data-guid]");for(var t=e.getAttribute("data-guid"),n=0,a=this.materials;n<a.length;){var r=a[n];if(++n,dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.get_guid(r)==t)return r}throw new js__$Boot_HaxeError("assert")},getView:function(e){return pagr_Dom.query('.own-material[data-guid="'+dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.get_guid(e)+'"]')[0]},refresh:function(e){var t=this.render(e);this.getView(e).innerHTML=pagr_Dom.getElement(t).innerHTML,this.store.set(e)},addView:function(e){this.bubble=pagr_Dom.nearest(this.dialogLayer,".bubble");var t=pagr_Dom.query(".content .materials",this.bubble)[0],n=pagr_Dom.getElement(this.render(e));return t.appendChild(n),n},updateBubble:function(){var e=this.materials.length,t=pagr_Dom.nearest(this.dialogLayer,".bubble").getAttribute("data-layer"),n=pagr_Dom.query('li[data-layer="'+t+'"] .amount')[0];if(!pagr_App.runtime.isStandalone())for(var a=0,r=this.materials;a<r.length;){var i=r[a];++a,"1"==dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.get_local(i)&&--e}n.innerHTML=e>0?null==e?"null":""+e:"";for(var o=0,s=pagr_Dom.query('li[data-layer="'+t+'"]');o<s.length;){var l=s[o];++o,l.classList.toggle("has-material",e>0)}},render:function(e){var t=tink_template__$Html_Html_$Impl_$.buffer(),n="\r\n";t.s+=n;var a=new RegExp("[^:/?#]+:/{2,3}","".split("u").join("")),r='\r\n  <li class="own-material" data-guid="';t.s+=r;var i=tink_template__$Html_Html_$Impl_$.escape(dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.get_guid(e));t.s+=i;var o='" data-local="';t.s+=o;var s=tink_template__$Html_Html_$Impl_$.escape(dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.get_local(e));t.s+=s;var l='">\r\n    <div class="material">\r\n      <div class="content">\r\n        <div>\r\n          <div>\r\n            <a target="_blank" href="';t.s+=l;var _=tink_template__$Html_Html_$Impl_$.escape(dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.get_url(e));t.s+=_;var u='" class="single-link">';t.s+=u;var c=tink_template__$Html_Html_$Impl_$.escape(dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.get_url(e).replace(a,""));t.s+=c;var d="</a>\r\n            ";if(t.s+=d,""!=dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.get_description(e)){var p="\r\n              <p>";t.s+=p;var h=tink_template__$Html_Html_$Impl_$.escape(dua_materials__$OwnMaterials_OwnMaterial_$Impl_$.get_description(e));t.s+=h;var g="</p>\r\n            ";t.s+=g}var m='</div>\r\n          <div class="buttons">\r\n            <a class="delete"><span>löschen</span></a>\r\n            <a class="edit"><span>bearbeiten</span></a>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </li>\r\n';t.s+=m;var v=t.s;return v},__class__:dua_materials_OwnMaterials};var dua_materials_Sidebar=function(e){var t=this;this._menuChanged=new tink_core_SignalTrigger,this._bubbleToggled=new tink_core_SignalTrigger,this.app=e,this.toggler=pagr_Dom.query("#toggle-aside-section")[0];var n=pagr_Dom.query(".pagr");this.root=n[n.length-1],this.printFrame=pagr_Dom.query(".note-layer iframe.print")[0],this.undos=new haxe_ds_StringMap,this.bubbleToggled=this._bubbleToggled,this.menuChanged=this._menuChanged,this.titelEl=pagr_Dom.query("title")[0],this.rebuildMaps(),pagr__$Dom_Query_$Impl_$.on(".cycle >li","click",null,$bind(this,this.nextMenu)),e.pages.get_navigated().handle($bind(this,this.updateView)),e.get_orientationChanged().handle(tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){"portrait"==e.get_orientation()&&(t.toggler.checked=!1)}));new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){"portrait"==e.get_orientation()&&(t.toggler.checked=!1)},1),$bind($_,$_.stop)));pagr__$Dom_Query_$Impl_$.on("aside.menu li.has-content[data-layer]:not(.has-bubble)","click",null,$bind(this,this.handleLayerClick)),pagr__$Dom_Query_$Impl_$.on("aside.menu li.has-bubble[data-layer]","click",null,$bind(this,this.handleBubbleTogglerClick)),pagr__$Dom_Query_$Impl_$.on("aside.menu.button li.layer-group","click",null,$bind(this,this.handleButtonGroupClick)),pagr__$Dom_Query_$Impl_$.on(".richtext a.print","click",null,$bind(this,this.print)),pagr__$Dom_Query_$Impl_$.on(".anchor","click",null,$bind(this,this.handleAnchorClick)),pagr__$Dom_Query_$Impl_$.on(".bubble","scroll",!0,tink_core__$Callback_Callback_$Impl_$.fromNiladic($bind(this,this.activateImages))),pagr__$Dom_Query_$Impl_$.on(".bubble input.toggler","change",null,tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){t.activateImages()},350),$bind($_,$_.stop)))})),pagr__$Dom_Query_$Impl_$.on("aside .bubbles .title .close","click",null,tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){t.closeAllAnchors(),t.closeAllBubbles()})),pagr__$Dom_Query_$Impl_$.on('aside.menu a[data-file-type^="audio"],aside.menu a[data-file-type^="video"],aside.menu a[data-file-type^="image"]',"click",null,tink_core__$Callback_Callback_$Impl_$.fromNiladic($bind(this,this.closeAllBubbles))),this.showHiddenLayers(),pagr_Dom.on(this.toggler,"change",null,tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){t.toggler.checked||(t.clickAll(".toggle-sub-layer:checked"),t.closeAllBubbles())})),pagr__$Dom_Query_$Impl_$.on(".pagr .viewport","tap",null,function(e){var n=pagr_Dom.nearest(e.event.target,".anchor");if(null==n)t.closeAllBubbles(),t.closeAllAnchors();else;}),this.own=new dua_materials_OwnMaterials(e),this.updateNews()};dua_materials_Sidebar.__name__=["dua","materials","Sidebar"],dua_materials_Sidebar.getLayer=function(e){return e.getAttribute("data-layer")},dua_materials_Sidebar.getBubbles=function(){for(var e=new haxe_ds_StringMap,t=0,n=pagr_Dom.query(".menu.active .bubbles .bubble,.anchors .bubbles .bubble");t<n.length;){var a=n[t];++t;var r=dua_materials_Sidebar.getLayer(a);null!=__map_reserved[r]?e.setReserved(r,a):e.h[r]=a}return e},dua_materials_Sidebar.getTogglers=function(){for(var e=new haxe_ds_StringMap,t=0,n=pagr_Dom.query(".menu.active li[data-layer]");t<n.length;){var a=n[t];++t;var r=dua_materials_Sidebar.getLayer(a);null!=__map_reserved[r]?e.setReserved(r,a):e.h[r]=a}return e},dua_materials_Sidebar.prototype={_menuChanged:null,_bubbleToggled:null,app:null,toggler:null,root:null,printFrame:null,bubbles:null,togglers:null,undos:null,menuChanged:null,rebuildMaps:function(){this.bubbles=dua_materials_Sidebar.getBubbles(),this.togglers=dua_materials_Sidebar.getTogglers()},nextMenu:function(e){for(var t=[],n=0,a=this.root.attributes;n<a.length;){var r=a[n];++n,StringTools.startsWith(r.name,"data-layer-")&&t.push(r.name)}for(var i=t,o=0;o<i.length;){var s=i[o];++o,this.root.removeAttribute(s)}this.closeAllBubbles();var l,_,u,c,d=pagr__$Dom_Query_$Impl_$.toArray(pagr_Dom.query("aside.menu")),p=pagr__$Dom_Query_$Impl_$.toArray(pagr_Dom.query(".cycle >li")),h=pagr_Dom.query(".materials.own .link-chooser")[0],g=Std.parseInt(e.at.getAttribute("data-index")),m=(g+1)%p.length;l=1,_=0,c=0,u=Math.ceil(d.length/1);var v,f,$,b;for(v=1,f=0,b=0,$=Math.ceil(p.length/1);b<$&&c<u;){var w=_+c++*l,k=f+b++*v;d[w].classList.toggle("active",w==g),p[k].classList.toggle("next",k==m)}this.rebuildMaps(),this.updateView(),this.updateNews(),this.showHiddenLayers();var y=pagr_Dom.query(".materials.own>li:first-child",d[g])[0];if(null!=h&&null!=y){var x=pagr_Dom.query(".dialog",y)[0];null!=x&&y.removeChild(x),y.appendChild(h.parentNode)}this.own.refreshAll(),tink_core__$Callback_CallbackList_$Impl_$.invoke(this._menuChanged.handlers,tink_core_Noise.Noise)},updateNews:function(){var e=pagr_Dom.query("aside.news")[0];null!=e&&(pagr_Dom.query("aside.menu.active")[0].hasAttribute("data-hasnews")?e.style.removeProperty("display"):e.style.display="none")},showHiddenLayers:function(){for(var e=[],t=0,n=pagr_Dom.query("aside.menu.active")[0].attributes;t<n.length;){var a=n[t];++t,StringTools.startsWith(a.name,"data-layer-")&&e.push(a.name)}for(var r=e,i=0;i<r.length;){var o=r[i];++i,this.root.setAttribute(o,"")}},own:null,activateImages:function(){var e=pagr_Dom.query(".bubble.active")[0];if(null!=e){for(var t=e.getBoundingClientRect(),n=[],a=0,r=pagr_Dom.query("img[data-src]:not([src])",e);a<r.length;){var i=r[a];++a;var o=pagr_Dom.nearest(i,".material").getBoundingClientRect();t.top<o.bottom&&t.bottom>o.top&&n.push(i)}for(var s=n,l=0;l<s.length;){var _=[s[l]];++l;var u=_[0].getAttribute("data-src");_[0].setAttribute("src",u),_[0].onload=function(e){return function(){e[0].removeAttribute("data-src")}}(_)}}},handleButtonGroupClick:function(e){for(var t=0,n=pagr_Dom.query(".sub-layers li:not(.active)",e.at);t<n.length;){var a=n[t];++t,this.toggleLayer(dua_materials_Sidebar.getLayer(a))}},closeAllAnchors:function(){for(var e=0,t=pagr_Dom.query(".anchor.active");e<t.length;){var n=t[e];++e,this.toggleAnchor(n)}},closeAllBubbles:function(){this.clickAll("li.has-bubble.active>label")},clickAll:function(e){for(var t=0,n=pagr_Dom.query(e,this.root);t<n.length;){var a=n[t];++t,a.click()}},toggleAnchorAside:function(e){pagr_Dom.query("aside.anchors")[0].classList.toggle("active",e)},toggleAnchor:function(e,t){null==t&&(t=!1);var n=pagr_Dom.query("ul.materials",e),a=pagr_Dom.query("[data-layer]",e),r=dua_materials_Sidebar.getLayer(a[a.length-1]),i=e.classList.contains("active");this.cleanupAnchors(),e.classList.toggle("highlight",!1);var o=function(t){e.classList.toggle("active",t)};if(i)return this.undo(r),void this.toggleAnchorAside(!1);var s=pagr_Dom.query("#toggle-aside-search:checked")[0];if(null!=s){var l=s;l.click()}if(!t){o(!0),this.toggler.checked&&(this.toggler.checked=!1),n.length>0&&(this.updateBubble(r,pagr__$Dom_Query_$Impl_$.toArray(n),!1),this.toggleBubble(r,!1));var _=this.undos,u=null!=__map_reserved[r]?_.getReserved(r):_.h[r],c=this.togglers,d=(null!=__map_reserved[r]?c.getReserved(r):c.h[r],!1),p=function(){d||(u(),o(!1),d=!0)},h=this.undos;null!=__map_reserved[r]?h.setReserved(r,p):h.h[r]=p}},getClickableMaterialLink:function(e){for(var t=0,n=pagr_Dom.query("a",e);t<n.length;){var a=n[t];if(++t,"none"!=window.getComputedStyle(a).display)return a}return null},handleAnchorClick:function(e){var t=!1,n=e.at,a=pagr_Dom.query("ul.materials>li",n);if(1==a.length&&0==pagr_Dom.query("table",a[0]).length){var r=this.getClickableMaterialLink(a[0]);this.toggleAnchorAside(!1),null!=r&&null==pagr_Dom.nearest(r,".richtext")&&(r.click(),t=!0)}e.at.parentElement.classList.toggle("animate",!1),this.toggleAnchor(e.at,t);new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){e.at.classList.toggle("animate-click",!0)},10),$bind($_,$_.stop))),new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){e.at.offsetHeight;e.at.classList.toggle("animate-click",!1)},515),$bind($_,$_.stop)))},handleBubbleTogglerClick:function(e){this.toggleBubble(dua_materials_Sidebar.getLayer(e.at))},toggleBubble:function(e,t){null==t&&(t=!0),this.toggleAnchorAside(!t),t&&this.cleanupAnchors(e),tink_core__$Callback_CallbackList_$Impl_$.invoke(this._bubbleToggled.handlers,e);for(var n=0,a=[this.bubbles,this.togglers];n<a.length;){var r=a[n];++n;for(var i=r,o=i.keys();o.hasNext();){var s=o.next(),l=null!=__map_reserved[s]?i.getReserved(s):i.h[s];l.classList.toggle("active",s==e&&!l.classList.contains("active")&&(t||r==this.bubbles))}}if(!t||this.toggler.checked)this.activateImages();else{this.toggler.checked=!0;new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay($bind(this,this.activateImages),750),$bind($_,$_.stop)))}},handleLayerClick:function(e){this.toggleLayer(dua_materials_Sidebar.getLayer(e.at))},toggleLayer:function(e){var t="data-layer-"+e,n=pagr_Dom.query('.annotation-layers .layer[data-layer-id="'+e+'"]')[0];if(this.root.hasAttribute(t))this.root.removeAttribute(t),n.classList.toggle("animate",!1);else{this.root.setAttribute(t,"");n.offsetHeight;n.classList.toggle("animate",!0)}},updateBubble:function(e,t,n){null==n&&(n=!0);var a=this.undos;if(null!=__map_reserved[e]?a.existsReserved(e):a.h.hasOwnProperty(e)){var r=this.undos;(null!=__map_reserved[e]?r.getReserved(e):r.h[e])()}for(var i=this.bubbles,o=null!=__map_reserved[e]?i.getReserved(e):i.h[e],s=[],l=pagr_Dom.query(".content",o)[0],_=0;_<t.length;){var u=t[_];++_;var c=[u.cloneNode(!0)],d=function(e){return function(){l.removeChild(e[0])}}(c);s.push(d),l.appendChild(c[0])}for(var p=new haxe_ds_StringMap,h=[],g=0,m=pagr__$Dom_Query_$Impl_$.toArray(pagr_Dom.query(".page-wide-materials>ul.materials>li>.material",l));g<m.length;){var v=m[g];++g;var f=v.getAttribute("data-material-id"),$=f;if(null!=__map_reserved[$]?p.getReserved($):p.h[$]){var b=v.parentElement,w=b.parentElement;w.removeChild(b),w.parentElement.classList.toggle("hidden",0==w.childNodes.length)}else{var k=f;null!=__map_reserved[k]?p.setReserved(k,!0):p.h[k]=!0,h.push(v)}}var y=pagr_Dom.query(".materials>li",l).length,x=this.togglers,C=null!=__map_reserved[e]?x.getReserved(e):x.h[e];if(null!=C){var D=y>0||o.classList.contains("Eigene-Materialien");C.classList.toggle("has-bubble",D&&n),o.classList.toggle("has-content",D);for(var S=0,I=pagr_Dom.query(".amount",C);S<I.length;){var T=I[S];++S;var M,A=y-pagr_Dom.query("ul.materials>li .richtext:first-child",l).length;if(0==A)M="";else{var L=A;M=null==L?"null":""+L}T.innerHTML=M}}var E=this.undos;null!=__map_reserved[e]?E.setReserved(e,function(){for(var e=0;e<s.length;){var t=s[e];++e,t()}}):E.h[e]=function(){for(var e=0;e<s.length;){var t=s[e];++e,t()}}},updateAllBubbles:function(e){for(var t=this.bubbles,n=t.keys();n.hasNext();){var a=n.next();null!=__map_reserved[a]?t.getReserved(a):t.h[a];this.updateBubble(a,this.getBubbleContent(e,a))}},cleanupAnchors:function(e){for(var t=0,n=pagr_Dom.query(".anchor.active");t<n.length;){var a=n[t];++t,a.classList.remove("active")}for(var r=0,i=pagr_Dom.query("aside.anchors .bubble.active");r<i.length;){var o=i[r];++r,this.undo(dua_materials_Sidebar.getLayer(o))}for(var s=0,l=pagr_Dom.query(".bubble.active");s<l.length;){var _=l[s];++s,dua_materials_Sidebar.getLayer(_)!=e&&_.classList.remove("active")}},undo:function(e){var t=this.undos.get(e);if(null!=t){var n=t;n(),this.undos.remove(e)}},allUndos:function(){for(var e=this.undos,t=new haxe_ds__$StringMap_StringMapIterator(e,e.arrayKeys());t.hasNext();){var n=t.next();n()}this.undos=new haxe_ds_StringMap},lastPages:null,updateView:function(e){null==e&&(e=this.lastPages);var t=1==this.app.get_page();if(t){var n=this.app.pages.all();if(n.length>e.length)return void this.updateView(n)}t?this.root.setAttribute("data-first-page",""):this.root.removeAttribute("data-first-page"),this.lastPages=e,this.closeAllBubbles(),this.toggleAnchorAside(!1),this.cleanupAnchors(),this.allUndos(),this.updateAllBubbles(e);for(var a=this.togglers,r=a.keys();r.hasNext();){for(var i=r.next(),o=null!=__map_reserved[i]?a.getReserved(i):a.h[i],s=[],l=0,_=e.slice(0,2);l<_.length;){var u=_[l];++l,s=s.concat(pagr__$Dom_Query_$Impl_$.toArray(pagr_Dom.query('[data-layer-id="'+i+'"] .anchor',u))),s=s.concat(pagr__$Dom_Query_$Impl_$.toArray(pagr_Dom.query('[data-layer-id="'+i+'"] .rect',u)))}o.classList.toggle("has-content",s.length>0||pagr_Dom.query('.bubbles [data-layer="'+i+'"]>.content>.materials').length>0)}for(var c=0,d=pagr_Dom.query("li.layer-group");c<d.length;){var p=d[c];++c,p.classList.toggle("has-content",pagr_Dom.query("li.has-content[data-layer]",p).length>0)}},titelEl:null,print:function(e){var t=this,n=pagr_Dom.nearest(e.at,".richtext").innerHTML,a=dua_Views.printable(n,this.app.get_settings().copyright,this.titelEl.getAttribute("data-original"),this.titelEl.getAttribute("data-build-year"));this.printFrame.contentWindow.document.body.innerHTML=a;new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){var e=t.printFrame.contentWindow.document.execCommand("print",!1,null);e||t.printFrame.contentWindow.print()},100),$bind($_,$_.stop)))},getBubbleContent:function(e,t){for(var n=[],a=0;a<e.length;){var r=e[a];++a,n=n.concat(pagr__$Dom_Query_$Impl_$.toArray(pagr_Dom.query('[data-layer-id="'+t+'"] .page-wide-materials',r)))}return n},get_menuChanged:function(){return this.menuChanged},__class__:dua_materials_Sidebar};var dua_modes_Notes=function(e){this.isEditing=!1,this.isFromStore=!1,this.noteMap=null,this.color="#90d7f1",this.app=e,this.sheet=new utils_Sheet,this.store=dua_annotations_AnnotationStore.getInstance(),this.pages=[],this.printFrame=pagr_Dom.query(".note-layer iframe.print")[0],this.noteEditor=new dua_NoteEditor,this.noteMap=new haxe_ds_StringMap,this.initEvents(),this.initMenu()};dua_modes_Notes.__name__=["dua","modes","Notes"],dua_modes_Notes.prototype={app:null,colorPicker:null,color:null,noteEditor:null,sheet:null,noteMap:null,isNewNote:null,store:null,isFromStore:null,pages:null,printFrame:null,initEvents:function(){var e=this;this.store.get_synced().handle(tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){utils_Helper.debounce("syncNotes",function(){e.updatePages()},500)})),this.app.pages.get_navigated().handle(function(t){e.pages=t,utils_Helper.debounce("syncNotes",function(){e.updatePages()},500)}),pagr__$Dom_Query_$Impl_$.on('.pagr[data-mode="notes"][data-annotation="on"] .page.active',"tap",null,$bind(this,this.onAddNoteClick)),pagr__$Dom_Query_$Impl_$.on('.pagr[data-mode="selectMove"][data-annotation="on"] .note-icon',"tap",null,function(t){var n=t.at.getAttribute("data-guid");e.toggleNote(n)}),pagr__$Dom_Query_$Impl_$.on("[data-note-action]","touchend click",null,$bind(this,this.onToolbarAction)),this.app.get_viewportChanged().handle(tink_core__$Callback_Callback_$Impl_$.fromNiladic($bind(this,this.updateNotesPosition))),pagr_Dom.on(this.app.zoomable,"transitionend",null,tink_core__$Callback_Callback_$Impl_$.fromNiladic($bind(this,this.updateNotesPosition))),pagr__$Dom_Query_$Impl_$.on('.pagr[data-mode="selectMove"][data-annotation="on"] .note-icon',"panstart",null,$bind(this,this.startDrag))},initMenu:function(){pagr__$Dom_Query_$Impl_$.on('label[data-pagr-mode="notes"]',"click",null,function(e){var t=e.at;t.nextElementSibling.classList.toggle("active")});var e=pagr_Dom.query('[data-pagr-mode="notes"] ~div .color-picker')[0],t=(pagr_Dom.query('[data-pagr-mode="notes"]')[0],this.sheet.addCssRule('.pagr[data-mode="notes"] footer nav .left li.ctrl-notes label.active',"color:"+this.color));this.colorPicker=new ColorPicker({el:e,data:{colors:["#90d7f1","#feee8e","#e194c0"]}}),this.colorPicker.set("currentColor",this.color),this.colorPicker.observe("currentColor",function(e){t.set("color",e)})},onToolbarAction:function(e){var t=this,n=e.at.getAttribute("data-note-action"),a=pagr_Dom.nearest(e.at,"[data-guid]"),r=a.getAttribute("data-guid");switch(e.event.preventDefault(),n){case"edit":this.editNote(r);break;case"print":this.print(r);break;case"remove":dua_ConfirmDialog.show("Möchten Sie diese Notiz wirklich löschen?",!0).handle(tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){t.deleteNote(r)}))}},print:function(e){var t=this,n=this.getNoteContent(e,!0);this.printFrame.contentWindow.document.body.innerHTML=n;new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){var e=t.printFrame.contentWindow.document.execCommand("print",!1,null);e||t.printFrame.contentWindow.print()},100),$bind($_,$_.stop)))},getNoteContent:function(e,t){null==t&&(t=!1);var n=this.noteMap,a=null!=__map_reserved[e]?n.getReserved(e):n.h[e],r=t?"<h3>Eigene Notizen zu Seite "+pagr_Dom.nearest(a.icon,".page").getAttribute("data-title")+" ("+DateTools.format(a.date,"%d.%m.%y")+")</h3>":"";return r+pagr_Dom.query(".content",a.note)[0].innerHTML},isEditing:null,editNote:function(e){var t=this,n=this.getNoteContent(e),a=this.noteMap,r=(null!=__map_reserved[e]?a.getReserved(e):a.h[e]).note;this.isEditing=!0,this.noteEditor.colorize(r.getAttribute("data-color")),this.noteEditor.edit(n).handle(function(n){switch(n[1]){case 0:var a=n[2];t.isEditing=!1,t.isNewNote=!1,pagr_Dom.query(".content",r)[0].innerHTML=a,t.storeNote(e),r.focus();break;case 1:0==n[2]&&(t.isEditing=!1,t.isNewNote?(t.deleteNote(e),t.isNewNote=!1):r.focus())}}),this.updateEditorPos(r)},updateEditorPos:function(e){this.isEditing&&this.noteEditor.position(parseFloat(e.style.left),parseFloat(e.style.top))},onAddNoteClick:function(e){var t=e.event,n=e.at,a="selectMove";if(this.app.set_mode(a),!t.target.classList.contains("note-icon")&&!t.target.parentNode.classList.contains("note-icon")){var r=this.app.getMousePos(t.gesture.pointers[0],!0),i=utils_GUID.create(),o=n.getAttribute("data-pos");this.addNote(i,o,r,this.colorPicker.get("currentColor")),this.isNewNote=!0,this.editNote(i)}},addNote:function(e,t,n,a,r){null==r&&(r=new Date);var i,o='.page[data-pos="'+t+'"] .content .note-icon-layer',s=pagr_Dom.query(o)[0],l=new tink_core_MPair(0|n.a,0|n.b);i=l;var _=pagr_Dom.getElement(dua_modes__$_$impl_NotesUI.icon(i,tink_template__$Html_Html_$Impl_$.escape(e),a));s.appendChild(_);var u=pagr_Dom.getElement(dua_modes__$_$impl_NotesUI.container(tink_template__$Html_Html_$Impl_$.escape(e),tink_template__$Html_Html_$Impl_$.escape(DateTools.format(r,"%d.%m.%y")),a));pagr_Dom.query(".note-layer")[0].appendChild(u);var c=this.noteMap,d={icon:_,note:u,date:r};null!=__map_reserved[e]?c.setReserved(e,d):c.h[e]=d,this.updateNotePos(e)},deleteNote:function(e){var t=this.noteMap;if(null!=__map_reserved[e]?t.existsReserved(e):t.h.hasOwnProperty(e)){var n=this.noteMap,a=null!=__map_reserved[e]?n.getReserved(e):n.h[e],r=(a.note,a.icon),i=pagr_Dom.nearest(r,"[data-pos]").getAttribute("data-pos"),o=this.store.get(i+":"+e);null!=o&&this.store.softDelete(o)}this.removeNoteElements(e)},removeNoteElements:function(e){var t=this.noteMap;if(null!=__map_reserved[e]?t.existsReserved(e):t.h.hasOwnProperty(e)){var n=this.noteMap,a=null!=__map_reserved[e]?n.getReserved(e):n.h[e],r=a.note,i=a.icon;r.parentNode.removeChild(r),i.parentNode.removeChild(i),this.noteMap.remove(e)}},toggleNote:function(e,t){var n=this.noteMap,a=(null!=__map_reserved[e]?n.getReserved(e):n.h[e]).icon,r=this.noteMap,i=(null!=__map_reserved[e]?r.getReserved(e):r.h[e]).note,o=a.classList.contains("active"),s=null!=t?t:!o;a.classList.toggle("active",s),i.classList.toggle("active",s),s&&this.updateNotePos(e),this.isEditing&&this.noteEditor.hide()},startDrag:function(e){var t=this;this.app.isCovered=!0;var n=e.event,a=e.at,r=a.getAttribute("data-guid"),i=(a.clientWidth,parseFloat(a.style.left)),o=parseFloat(a.style.top),s=1/tink_geom2__$Matrix_Matrix_$Impl_$.scale(this.app.correction,this.app.get_zoom()).a,l=n.gesture.pointers[0].screenX,_=a.parentNode,u=pagr_Dom.on(window.document,"panmove",null,function(e){var n=t.getDragTarget(e);if(null!=n){var u,c=e.gesture.pointers[0].screenX-l,d=c*s,p=new tink_core_MPair(i+d,o+e.gesture.deltaY*s);u=p;var h=u,g=_!=n;if(l=e.gesture.pointers[0].screenX,g){if(d>0){var m,v=new tink_core_MPair(i-t.app.bookWidth+d,h.b);m=v,h=m}else{var f,$=new tink_core_MPair(t.app.bookWidth+i+d,h.b);f=$,h=f}n.appendChild(a),_=n}i=h.a,a.style.left=h.a+"px",a.style.top=h.b+"px",g||t.updateNotePos(r,!0)}});pagr_Dom.once(window.document,"panend",tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){t.storeNote(r),t.app.isCovered=!1,null!=u&&u.dissolve()}))},updateNotesPosition:function(){for(var e=this.noteMap.keys();e.hasNext();){var t=e.next();this.updateNotePos(t)}},updateNotePos:function(e,t){null==t&&(t=!1),t||this.storeNote(e);var n=this.noteMap,a=null!=__map_reserved[e]?n.getReserved(e):n.h[e],r=a.icon,i=a.note,o=pagr_Dom.nearest(r,"[data-pos]");if(this.checkIconBounds(r,o),r.classList.contains("active")&&!o.classList.contains("active")&&this.toggleNote(e,!1),this.app.modes.get_annotation()&&r.classList.contains("active")){var s=r.getBoundingClientRect(),l=i.getBoundingClientRect(),_=this.app.get_root().getBoundingClientRect(),u=this.app.viewport.getBoundingClientRect(),c=u.width,d=u.height+u.top,p=s.right+l.width>c?s.left-l.width+.5:s.right-.5,h=s.top+l.height>d?s.bottom-l.height:s.top+.5;h-=_.top,p-=_.left,h+=10,p+=10,i.style.top=h+"px",i.style.left=p+"px",this.updateEditorPos(i)}},checkIconBounds:function(e,t){var n=e.getBoundingClientRect(),a=t.getBoundingClientRect(),r=parseFloat(e.style.left),i=parseFloat(e.style.top),o=1/tink_geom2__$Matrix_Matrix_$Impl_$.scale(this.app.correction,this.app.get_zoom()).a;n.left<a.left?r+=(a.left-n.left)*o:n.right>a.right&&(r+=(a.right-n.right)*o),n.top<a.top?i+=(a.top-n.top)*o:n.bottom>a.bottom&&(i+=(a.bottom-n.bottom)*o),e.style.left=r+"px",e.style.top=i+"px"},getDragTarget:function(e){var t=pagr_Dom.query(".page.active"),n=t[0].getBoundingClientRect(),a=e.gesture.pointers[0].clientX<n.left+n.width||1==t.length?t[0]:t[1];return pagr_Dom.query(".note-icon-layer",a)[0]},storeNote:function(e){if(!this.isFromStore){var t,n=this.noteMap,a=null!=__map_reserved[e]?n.getReserved(e):n.h[e],r=a.icon,i=(a.note,Std.parseInt(pagr_Dom.nearest(r,"[data-pos]").getAttribute("data-pos"))),o=this.getNoteContent(e),s=new tink_core_MPair(parseFloat(r.style.left),parseFloat(r.style.top));t=s;var l={pos:t,color:r.getAttribute("data-color"),text:o},_=this.store.find(function(t,n){var a=n.annotationPosition;return HxOverrides.substr(a,a.indexOf(":")+1,null)==e})[0],u=null!=_?_.annotationId:"",c=null!=_&&_.annotationContent!=dua_annotations__$Data_AnnotationContent_$Impl_$.ofData(l);null!=_&&Std.parseInt(_.annotationPosition)!=i&&(this.store.softDelete(_),u="");var d={annotationId:u,dirty:c,readOnly:!0,annotationVersion:""!=u?_.annotationVersion:1,annotationTypeId:dua_modes_Notes.ANNOTATION_TYPE,annotationPosition:dua_annotations__$Data_AnnotationPosition_$Impl_$.ofObject({page:i,guid:e}),annotationContent:dua_annotations__$Data_AnnotationContent_$Impl_$.ofData(l)};this.store.set(d)}},updatePages:function(){this.isFromStore=!0,this.noteEditor.hide();for(var e=this.noteMap.keys();e.hasNext();){var t=e.next();this.removeNoteElements(t)}this.noteMap=new haxe_ds_StringMap;for(var n=0,a=this.pages;n<a.length;){var r=a[n];++n;for(var i=[r.getAttribute("data-pos")],o=this.store.find(function(e){return function(t,n){var a=Std.parseInt(n.annotationPosition)==e[0]&&n.annotationTypeId==dua_modes_Notes.ANNOTATION_TYPE;return(null==n.shouldDelete||!n.shouldDelete)&&a}}(i)),s=0;s<o.length;){var l=o[s];++s;var _=l.annotationPosition,u=HxOverrides.substr(_,_.indexOf(":")+1,null),c=JSON.parse(dua_annotations__$Data_AnnotationContent_$Impl_$.toString(l.annotationContent));this.addNote(u,i[0],c.pos,c.color);var d=this.noteMap,p=null!=__map_reserved[u]?d.getReserved(u):d.h[u],h=pagr_Dom.query(".content",p.note)[0];h.innerHTML=c.text,this.toggleNote(u,!1)}}this.isFromStore=!1},__class__:dua_modes_Notes};var dua_modes_SelectBase=function(e,t){this.app=e,this.type=t};dua_modes_SelectBase.__name__=["dua","modes","SelectBase"],dua_modes_SelectBase.prototype={app:null,type:null,mark:function(e){for(var t=(e.event,e.at),n=t.getAttribute("data-guid"),a='.pagr[data-mode="'+this.type+'"] .draw-layer [data-guid="'+n+'"]',r=0,i=pagr_Dom.query(a);r<i.length;){var o=i[r];++r,o.classList.add("hover")}},deMark:function(e){for(var t=(e.event,e.at),n=t.getAttribute("data-guid"),a='.pagr[data-mode="'+this.type+'"] .draw-layer [data-guid="'+n+'"]',r=0,i=pagr_Dom.query(a);r<i.length;){var o=i[r];++r,o.classList.remove("hover")}},__class__:dua_modes_SelectBase};var dua_modes_SelectAll=function(e){this.lastMode="selectMove";var t=this;dua_modes_SelectBase.call(this,e,"selectAll"),this.store=dua_annotations_AnnotationStore.getInstance(),this.pages=[],e.pages.get_navigated().handle(function(e){t.pages=e}),pagr__$Dom_Query_$Impl_$.on('[data-pagr-mode="selectAll"]',"click",null,function(n){for(var a=!1,r=n.at,i=".draw-layer [data-guid]",o=!r.classList.contains("active"),s=0,l=pagr_Dom.query(i);s<l.length;){var _=l[s];++s,_.classList.toggle("active",o),a=!0}if(!o||!a){new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){e.set_mode(t.lastMode)},10),$bind($_,$_.stop)))}}),pagr__$Dom_Query_$Impl_$.on('[data-pagr-mode="delete"]',"click",null,function(n){for(var a=0,r=t.pages;a<r.length;){var i=r[a];++a;for(var o=(i.getAttribute("data-pos"),".draw-layer [data-guid].active"),s=0,l=pagr_Dom.query(o,i);s<l.length;){var _=l[s];++s;for(var u=0,c=t.store.findByGuid(_.getAttribute("data-guid"));u<c.length;){var d=c[u];++u,t.store.softDelete(d)}_.parentNode.removeChild(_)}}new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){e.set_mode(t.lastMode)},10),$bind($_,$_.stop)))});new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){e.modes.get_changed().handle(tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){var n=e.get_mode();if("delete"==n){var a="selectMove";t.lastMode=a}else null!=n&&"selectAll"!=n&&(t.lastMode=n)}))},10),$bind($_,$_.stop)))};dua_modes_SelectAll.__name__=["dua","modes","SelectAll"],dua_modes_SelectAll.__super__=dua_modes_SelectBase,dua_modes_SelectAll.prototype=$extend(dua_modes_SelectBase.prototype,{store:null,lastMode:null,pages:null,__class__:dua_modes_SelectAll});var dua_modes_SelectMove=function(e){var t=this;dua_modes_SelectBase.call(this,e,"selectMove"),pagr__$Dom_Query_$Impl_$.on('.pagr[data-mode="selectMove"] .book',"panstart",null,$bind(this,this.startDrag)),pagr__$Dom_Query_$Impl_$.on('.pagr[data-mode="selectMove"] .draw-layer [data-guid]',"tap",null,function(e){for(var n=(e.event,e.at),a=n.getAttribute("data-guid"),r='.pagr[data-mode="'+t.type+'"] .draw-layer [data-guid="'+a+'"]',i=0,o=pagr_Dom.query(r);i<o.length;){var s=o[i];++i,s.classList.toggle("active")}}),pagr__$Dom_Query_$Impl_$.on('.pagr[data-mode="selectMove"] .draw-layer [data-guid]',"mouseover",null,$bind(this,this.mark)),pagr__$Dom_Query_$Impl_$.on('.pagr[data-mode="selectMove"] .draw-layer [data-guid]',"mouseout",null,$bind(this,this.deMark))};dua_modes_SelectMove.__name__=["dua","modes","SelectMove"],dua_modes_SelectMove.__super__=dua_modes_SelectBase,dua_modes_SelectMove.prototype=$extend(dua_modes_SelectBase.prototype,{startDrag:function(e){var t=this;this.app.isPaning=!0;var n=e.event,a=n.gesture.target;if(!a.classList.contains("note-icon")&&!a.parentElement.classList.contains("note-icon")){var r,i=new tink_core_MPair(n.gesture.deltaX,n.gesture.deltaY);r=i;var o=r,s=pagr_Dom.on(window.document,"panmove",null,function(e){var n,a=new tink_core_MPair(e.gesture.deltaX,e.gesture.deltaY);n=a;var r,i=n,s=t.app,l=t.app.transform,_=new tink_core_MPair(i.a-o.a,i.b-o.b);r=_,s.applyTransform(tink_geom2__$Matrix_Matrix_$Impl_$.move(l,r)),o=i});pagr_Dom.once(window.document,"panend",tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){
t.app.isPaning=!1,null!=s&&s.dissolve()}))}},__class__:dua_modes_SelectMove});var dua_modes__$_$impl_NotesUI=function(){};dua_modes__$_$impl_NotesUI.__name__=["dua","modes","__impl","NotesUI"],dua_modes__$_$impl_NotesUI.getColor=function(e){var t=dua_modes__$_$impl_NotesUI.COLORS,n=null!=__map_reserved[e]?t.getReserved(e):t.h[e];return null==n?e:n},dua_modes__$_$impl_NotesUI.colorize=function(e){var t=tink_template__$Html_Html_$Impl_$.buffer(),n='\n  data-color="';t.s+=n;var a=tink_template__$Html_Html_$Impl_$.escape(dua_modes__$_$impl_NotesUI.getColor(e));t.s+=a;var r='"\n';t.s+=r;var i=t.s;return i},dua_modes__$_$impl_NotesUI.icon=function(e,t,n){var a=tink_template__$Html_Html_$Impl_$.buffer(),r="\n ";a.s+=r;var i='<div class="note-icon active noscale" ';a.s+=i;var o=dua_modes__$_$impl_NotesUI.colorize(n);a.s+=o;var s=' style="';a.s+=s;var l=tink_template__$Html_Html_$Impl_$.escape(dua_Views.pos(e));a.s+=l;var _='" data-guid="';a.s+=_,a.s+=t;var u='">\n    <i class="fa dua-notes"></i>\n  </div>\n';a.s+=u;var c=a.s;return c},dua_modes__$_$impl_NotesUI.container=function(e,t,n){var a=tink_template__$Html_Html_$Impl_$.buffer(),r="\n ";a.s+=r;var i='<div class="note-container active"  data-guid="';a.s+=i,a.s+=e;var o='" ';a.s+=o;var s=dua_modes__$_$impl_NotesUI.colorize(n);a.s+=s;var l='>\n    <div class="header" ';a.s+=l;var _=dua_modes__$_$impl_NotesUI.colorize(n);a.s+=_;var u='>\n      <div class="title">';a.s+=u,a.s+=t;var c='</div>\n      <div class="toolbar">\n        ';a.s+=c;var d=dua_Views.tooltip(tink_template__$Html_Html_$Impl_$.escape("Bearbeiten"));a.s+=d;var p='\n        <div class="item" data-note-action="edit">\n          <i class="fa dua-pencil"></i></label>\n        </div>\n        ';a.s+=p;var h=dua_Views.tooltip(tink_template__$Html_Html_$Impl_$.escape("Drucken"));a.s+=h;var g='\n        <div class="item" data-note-action="print">\n          <i class="fa dua-print"></i>\n        </div>\n        ';a.s+=g;var m=dua_Views.tooltip(tink_template__$Html_Html_$Impl_$.escape("Löschen"));a.s+=m;var v='\n        <div class="item" data-note-action="remove">\n          <i class="fa fa-trash"></i>\n        </div>\n      </div>\n    </div>\n    <div class="content"></div>\n  </div>\n';a.s+=v;var f=a.s;return f};var dua_modes_drawing_DrawMode=function(e,t,n,a){this.isDrawing=!1;var r=this;this.app=e,this.type=t,this.strokeOpacity=n,this.availableColors=a,this.sheet=new utils_Sheet,this.pages=[],this.store=dua_annotations_AnnotationStore.getInstance(),this.store.get_synced().handle(tink_core__$Callback_Callback_$Impl_$.fromNiladic($bind(this,this.updatePages))),e.pages.get_navigated().handle(function(e){r.pages=e,r.updatePages()}),pagr__$Dom_Query_$Impl_$.on('label[data-pagr-mode="'+t+'"]',"click",null,function(e){var t=e.at;new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){t.nextElementSibling.classList.toggle("active")},10),$bind($_,$_.stop)))}),pagr__$Dom_Query_$Impl_$.on('.pagr[data-mode="'+t+'"] .draw-layer',"panstart",null,$bind(this,this.startDraw)),pagr__$Dom_Query_$Impl_$.on('.pagr[data-mode="'+t+'"] .draw-layer',"panend",null,tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){r.isDrawing=!1})),this.initPicker(a[0])};dua_modes_drawing_DrawMode.__name__=["dua","modes","drawing","DrawMode"],dua_modes_drawing_DrawMode.prototype={isDrawing:null,app:null,type:null,colorPicker:null,strokeOpacity:null,availableColors:null,sheet:null,pages:null,store:null,initPicker:function(e){var t=this.sheet.addCssRule('.pagr[data-mode="'+this.type+'"] footer nav .left li label.active i:nth-child(2)',"color: "+e),n=pagr_Dom.query('[data-pagr-mode="'+this.type+'"] ~div .color-picker')[0];this.colorPicker=new ColorPicker({el:n,data:{colors:this.availableColors}}),this.colorPicker.set("currentColor",e),this.colorPicker.observe("currentColor",function(e){t.set("color",e)})},getStyle:function(){var e=pagr_Dom.query('[data-pagr-mode="'+this.type+'"].active ~div input[name="linewidth"]')[0],t=Std.parseInt(e.value),n=this.colorPicker.get("currentColor");return{thickness:t,color:n,opacity:this.strokeOpacity}},startDraw:function(e){var t=this;this.isDrawing=!0;var n=function(e){var n,a=t.app.getMousePos(e,!0),r=new tink_core_MPair(Math.round(100*a.a)/100,Math.round(100*a.b)/100);return n=r},a=this.app.bookWidth,r=e.event.gesture.pointers[0],i=r.clientX,o=null,s=e.at,l=dua_modes_drawing_Drawing.create(this.getStyle()),_=pagr_Dom.nearest(s,".page"),u=l.getCanvas(_),c=n(r);u.addPoint(c);var d=pagr_Dom.on(window.document,"panmove",null,function(e){var r=n(e.gesture.pointers[0]),_=u.get_lastPoint(),c=t.getDragTarget(e);if(null!=c&&c!=s){var d=i>e.gesture.pointers[0].clientX,p=d?a-r.a+_.a:a-_.a+r.a,h=d?_.a:r.a,g=Math.abs(_.b-r.b),m=Math.atan(g/p),v=g>0?Math.tan(m)*h:0;_.b-r.b<0&&(v*=-1);var f,$=d?_.b-v:r.b+v,b=new tink_core_MPair(a,$);f=b;var w,k=f,y=new tink_core_MPair(0,$);w=y;var x=w;u.addPoint(d?x:k);var C=20*Math.tan(m);_.b-r.b>0&&(C*=-1);var D;if(d){var S,I=new tink_core_MPair((-20),$+C);S=I,D=S}else{var T,M=new tink_core_MPair(a+20,$+C);T=M,D=T}u.addPoint(D),s=c;var A=pagr_Dom.nearest(s,".page");u=l.getCanvas(A);var L;if(d){var E,H=new tink_core_MPair(a+20,$-C);E=H,L=E}else{var P,N=new tink_core_MPair((-20),$-C);P=N,L=P}u.addPoints([L,d?k:x,r]),o=null}else{if(null==c){var O,B=pagr_Dom.query(".page.active")[0].getBoundingClientRect(),R=new tink_core_MPair(a,0);O=R;var F,q=O;if(e.gesture.pointers[0].clientX<B.right){var z,j=new tink_core_MPair((-q.a),(-q.b));z=j,F=z}else F=q;var X,V=new tink_core_MPair(r.a+F.a,r.b+F.b);X=V,r=X}null==o&&(o=_);var W,U=new tink_core_MPair(_.a-r.a,_.b-r.b);W=U;var Q,Y=W,G=Math.sqrt(Y.a*Y.a+Y.b*Y.b),J=new tink_core_MPair(r.a-o.a,r.b-o.b);Q=J;var K=Q;Math.max(G,Math.sqrt(K.a*K.a+K.b*K.b))<5?u.set_lastPoint(r):(o=null,u.addPoint(r))}i=e.gesture.pointers[0].clientX});pagr_Dom.once(window.document,"panend",function(e){l.persist(),null!=d&&d.dissolve()})},getDragTarget:function(e){var t=pagr_Dom.query(".page.active"),n=t[0].getBoundingClientRect();t[0].querySelector(".draw-layer");return e.gesture.pointers[0].clientX<n.left+n.width?t[0].querySelector(".draw-layer"):null!=t[1]?t[1].querySelector(".draw-layer"):null},updatePages:function(){for(var e=0,t=this.pages;e<t.length;){var n=t[e];if(++e,0!=pagr_Dom.query(".draw-layer svg",n).length){for(var a=[Std.parseInt(n.getAttribute("data-pos"))],r=0,i=pagr_Dom.query(".draw-layer [data-guid]",n);r<i.length;){var o=i[r];++r;var s=o.getAttribute("data-guid");if(dua_modes_drawing_Drawing.exists(s)){var l=dua_modes_drawing_Drawing.get(s);l["delete"]()}o.parentNode.removeChild(o)}for(var _=this.store.find(function(e){return function(t,n){var a=Std.parseInt(n.annotationPosition)==e[0]&&"dua_drawn_sequence"==n.annotationTypeId;return(null==n.shouldDelete||!n.shouldDelete)&&a}}(a)),u=0;u<_.length;){var c=_[u];++u;var d=c.annotationPosition,p=HxOverrides.substr(d,d.indexOf(":")+1,null),h=dua_annotations__$Data_AnnotationContent_$Impl_$.getData(c.annotationContent),g=dua_modes_drawing_Drawing.exists(p)?dua_modes_drawing_Drawing.get(p):dua_modes_drawing_Drawing.create(h.style,p);g.getCanvas(n).setPoints(h.points)}}}},__class__:dua_modes_drawing_DrawMode};var dua_modes_drawing_Drawing=function(e,t){this.id=e,this.style=t,this.canvases=new haxe_ds_IntMap;var n=dua_modes_drawing_Drawing.map;if(null!=__map_reserved[e]?n.existsReserved(e):n.h.hasOwnProperty(e)){window.alert("Dupe for "+e);var a=dua_modes_drawing_Drawing.map;(null!=__map_reserved[e]?a.getReserved(e):a.h[e])["delete"]()}var r=dua_modes_drawing_Drawing.map;null!=__map_reserved[e]?r.setReserved(e,this):r.h[e]=this};dua_modes_drawing_Drawing.__name__=["dua","modes","drawing","Drawing"],dua_modes_drawing_Drawing.exists=function(e){var t=dua_modes_drawing_Drawing.map;return null!=__map_reserved[e]?t.existsReserved(e):t.h.hasOwnProperty(e)},dua_modes_drawing_Drawing.get=function(e){var t=dua_modes_drawing_Drawing.map;return null!=__map_reserved[e]?t.getReserved(e):t.h[e]},dua_modes_drawing_Drawing.create=function(e,t){return null==t&&(t=utils_GUID.create()),new dua_modes_drawing_Drawing(t,e)},dua_modes_drawing_Drawing.prototype={id:null,style:null,canvases:null,"delete":function(){return!!dua_modes_drawing_Drawing.map.remove(this.id)},persist:function(){for(var e=this.canvases.iterator();e.hasNext();){var t=e.next();t.persist()}},getCanvas:function(e){var t=Std.parseInt(e.getAttribute("data-pos"));if(!this.canvases.h.hasOwnProperty(t)){var n=this.canvases,a=new dua_modes_drawing_DrawingCanvas(this,e);n.h[t]=a}return this.canvases.h[t]},__class__:dua_modes_drawing_Drawing};var tink_core_SignalObject=function(){};tink_core_SignalObject.__name__=["tink","core","SignalObject"],tink_core_SignalObject.prototype={handle:null,__class__:tink_core_SignalObject};var tink_core_SignalTrigger=function(){var e=[];this.handlers=e};tink_core_SignalTrigger.__name__=["tink","core","SignalTrigger"],tink_core_SignalTrigger.__interfaces__=[tink_core_SignalObject],tink_core_SignalTrigger.prototype={handlers:null,handle:function(e){return tink_core__$Callback_CallbackList_$Impl_$.add(this.handlers,e)},__class__:tink_core_SignalTrigger};var haxe_Timer=function(e){var t=this;this.id=setInterval(function(){t.run()},e)};haxe_Timer.__name__=["haxe","Timer"],haxe_Timer.delay=function(e,t){var n=new haxe_Timer(t);return n.run=function(){n.stop(),e()},n},haxe_Timer.prototype={id:null,stop:function(){null!=this.id&&(clearInterval(this.id),this.id=null)},run:function(){},__class__:haxe_Timer};var tink_core__$Callback_LinkObject=function(){};tink_core__$Callback_LinkObject.__name__=["tink","core","_Callback","LinkObject"],tink_core__$Callback_LinkObject.prototype={dissolve:null,__class__:tink_core__$Callback_LinkObject};var tink_core__$Callback_SimpleLink=function(e){this.f=e};tink_core__$Callback_SimpleLink.__name__=["tink","core","_Callback","SimpleLink"],tink_core__$Callback_SimpleLink.__interfaces__=[tink_core__$Callback_LinkObject],tink_core__$Callback_SimpleLink.prototype={f:null,dissolve:function(){null!=this.f&&this.f()},__class__:tink_core__$Callback_SimpleLink};var dua_modes_drawing_DrawingCanvas=function(e,t){this.owner=e,this.page=t,this.points=[],this.group=window.document.createElementNS("http://www.w3.org/2000/svg","g"),this.selection=window.document.createElementNS("http://www.w3.org/2000/svg","polyline"),this.hitzone=window.document.createElementNS("http://www.w3.org/2000/svg","polyline"),this.visible=window.document.createElementNS("http://www.w3.org/2000/svg","polyline");var n=pagr_Dom.query(".draw-layer svg",t)[0];n.appendChild(this.group),this.width=Std.parseInt(n.getAttribute("width")),this.group.setAttribute("data-guid",e.id),this.group.setAttribute("data-anno-type","dua_drawn_sequence"),this.group.appendChild(this.selection),this.group.appendChild(this.hitzone),this.group.appendChild(this.visible),this.selection.setAttribute("class","selection"),this.hitzone.setAttribute("class","hitzone"),this.visible.setAttribute("style",this.styleString(e.style)),this.redraw()};dua_modes_drawing_DrawingCanvas.__name__=["dua","modes","drawing","DrawingCanvas"],dua_modes_drawing_DrawingCanvas.prototype={owner:null,page:null,points:null,width:null,group:null,selection:null,hitzone:null,visible:null,styleString:function(e){return"stroke-opacity: "+e.opacity+"; stroke: "+e.color+"; stroke-width: "+e.thickness+";"},persist:function(){var e={annotationId:"",dirty:!0,readOnly:!0,annotationTypeId:"dua_drawn_sequence",annotationPosition:dua_annotations__$Data_AnnotationPosition_$Impl_$.ofObject({page:Std.parseInt(this.page.getAttribute("data-pos")),guid:this.owner.id}),annotationContent:dua_annotations__$Data_AnnotationContent_$Impl_$.ofData({style:this.owner.style,points:this.points})};dua_modes_drawing_DrawingCanvas.store.add(e),this.redrawHull()},allPoints:function(){for(var e=Std.parseInt(this.page.getAttribute("data-pos")),t=this.owner.canvases,n=t.keys();n.hasNext();){var a=n.next(),r=t.h[a];if(a!=e){var i,o=new tink_core_MPair(this.width*(a-e),0);i=o;for(var s=i,l=[],_=0,u=r.points;_<u.length;){var c=u[_];++_;var d,p=new tink_core_MPair(c.a+s.a,c.b+s.b);d=p,l.push(d)}var h=l;return a>e?this.points.concat(h):h.concat(this.points)}}return this.points},redrawHull:function(){for(var e=this.selection,t=Outline.of(this.allPoints()),n=[],a=0;a<t.length;){var r=t[a];++a,n.push(r.a+","+r.b)}e.setAttribute("points",n.join(" "))},addPoints:function(e){for(var t=0;t<e.length;){var n=e[t];++t,this.points.push(n)}this.redraw()},setPoints:function(e){this.points=e.slice(),this.redraw(),this.redrawHull()},addPoint:function(e){return this.addPoints([e]),e},redraw:function(){for(var e=0,t=[this.hitzone,this.visible];e<t.length;){var n=t[e];++e;for(var a=this.points,r=[],i=0;i<a.length;){var o=a[i];++i,r.push(o.a+","+o.b)}n.setAttribute("points",r.join(" "))}},get_lastPoint:function(){return this.points[this.points.length-1]},set_lastPoint:function(e){return this.points.pop(),this.addPoint(e),e},__class__:dua_modes_drawing_DrawingCanvas};var dua_search_Form=function(e){this.idCounter=1e6;var t=this;this.app=e,this.form=pagr_Dom.query("#search")[0],this.thumbs=pagr_Dom.query("footer .overview .nav"),this.resultLayer=pagr_Dom.query("#search~.results")[0],this.bookResultLayer=pagr_Dom.query("#search~.results .book-results>div")[0],this.countEl=pagr_Dom.query("#search~.results .book-results .amount")[0],this.input=pagr_Dom.query('input[name="query"]')[0],this.hits=[],this.query=[];for(var n=new haxe_ds_StringMap,a=0,r=pagr_Dom.query("#search .media-types input");a<r.length;){var i=r[a];++a;var o=i,s=o.value;null!=__map_reserved[s]?n.setReserved(s,o):n.h[s]=o}this.typeTogglers=n;for(var l=new haxe_ds_StringMap,_=this.typeTogglers.keys();_.hasNext();){var u=_.next();null!=__map_reserved[u]?l.setReserved(u,!1):l.h[u]=!1}this.materialTypes=l;for(var c=[],d=0,p=e.pages.all();d<p.length;){var h=p[d];++d,c.push({page:h,text:dua_search_Highlighter.getSearchableText(h)})}this.index=c;for(var g=new haxe_ds_IntMap,m=0,v=e.pages.all();m<v.length;){var f=v[m];++m;var $=Std.parseInt(f.getAttribute("data-pos")),b=new tink_core__$Lazy_LazyFunc(function(e,t){return function(){return t[0](e[0])}}([f],[function(){return function(e){return new dua_search_Highlighter(e)}}()]));g.h[$]=b}this.highlighters=g,this.materialIndex=new haxe_ds_StringMap,this.interactiveMaterialIndex=new haxe_ds_StringMap,this.lastHighlights=[],this.lastQuery=[],null!=this.form&&(this.form.onsubmit=$bind(this,this.startSearch)),this.buildMaterialIndex(),this.drawMaterialResults(),e.get_orientationChanged().handle(tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){t.hits.length>0&&(t.lastQuery=[],t.redraw())})),e.pages.get_navigated().handle(tink_core__$Callback_Callback_$Impl_$.fromNiladic($bind(this,this.redraw))),pagr__$Dom_Query_$Impl_$.on(".search .top-overlay-toggler","click",null,function(e){new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){e.at.checked?t.input.focus():(t.query=[],t.hits=[],t.redraw())},1),$bind($_,$_.stop)))}),pagr__$Dom_Query_$Impl_$.on("#search~.results","scroll",!0,tink_core__$Callback_Callback_$Impl_$.fromNiladic($bind(this,this.activateImages))),pagr__$Dom_Query_$Impl_$.on("#search .media-types input","change",null,tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){t.drawMaterialResults(),t.activateImages()})),pagr__$Dom_Query_$Impl_$.on("#search~.results .has-results label","click",null,function(e){var n=e.at.parentElement,a=n.classList.contains("active");if(n.classList.toggle("active"),!a){new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){t.activateImages()},50),$bind($_,$_.stop)))}}),pagr__$Dom_Query_$Impl_$.on("#search~.results .has-results .material[data-pos]","click",null,function(n){var a=n.at,r=a.getAttribute("data-material-id"),i=pagr_Dom.nearest(a,"[data-layer]"),o="A"==n.event.target.nodeName,s=Std.parseInt(a.getAttribute("data-pos")),l=(s+1)%e.get_step(),_=s+l,u=e.get_page()==_?0:.5;null!=i&&"interactive"==i.getAttribute("data-layer")&&o&&(n.event.stopImmediatePropagation(),n.event.preventDefault()),t.resetHighlights(),e.get_page()!=_&&e.set_page(_);new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){t.resetHighlights();var n=pagr_Dom.query('.page[data-pos="'+s+'"] .annotation-layers .material[data-material-id="'+r+'"]')[0];if(null!=n){var a=pagr_Dom.nearest(n,".anchor");if(null!=a&&(a.classList.toggle("highlight",!0),o)){new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){a.classList.toggle("animate-click",!0)},500),$bind($_,$_.stop))),new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){a.offsetHeight;a.classList.toggle("animate-click",!1)},1014),$bind($_,$_.stop)))}}var l;if(null!=i){l=i.getAttribute("data-layer");var _=l;if("interactive"!=_){var u=e.get_root().querySelector('aside.menu.active>.layers>li[data-layer="'+_+'"]>label');if(null!=u){var c=u;e.get_root().hasAttribute("data-layer-"+_)&&null==pagr_Dom.nearest(c,".has-bubble:not(.active")||c.click()}}}},1e3*u|0),$bind($_,$_.stop)))}),pagr__$Dom_Query_$Impl_$.on("#search~.results .has-results .material .more, #search~.results .has-results .material .richtext.open","click",null,function(e){var t=pagr_Dom.query(".richtext",e.at.parentElement)[0];null!=t&&t.classList.toggle("open")})};dua_search_Form.__name__=["dua","search","Form"],dua_search_Form.prototype={app:null,form:null,thumbs:null,resultLayer:null,bookResultLayer:null,countEl:null,input:null,hits:null,query:null,togglers:null,typeTogglers:null,materialTypes:null,index:null,highlighters:null,materialIndex:null,interactiveMaterialIndex:null,parseQuery:function(e){for(var t=new haxe_ds_StringMap,n=[],a=0,r=e.split(" ");a<r.length;){var i=r[a];if(++a,""!=i&&null==(null!=__map_reserved[i]?t.getReserved(i):t.h[i])){var o=dua_search_Highlighter.normalize(i);null!=__map_reserved[i]?t.setReserved(i,o):t.h[i]=o,n.push(o)}}return n},match:function(e){for(var t=0,n=this.query;t<n.length;){var a=n[t];if(++t,e.indexOf(a)==-1)return!1}return!0},seek:function(e){if(this.query=this.parseQuery(e),0==this.query.length)return[];var t,n,a,r,i=[],o=HxOverrides.iter(this.index);for(t=1,n=0,r=0,a=Math.ceil(this.index.length/1);r<a&&o.hasNext();){var s=o.next(),l=n+r++*t;this.match(s.text)&&i.push(l)}return i},startSearch:function(e){e.preventDefault(),this.hits=this.seek(this.input.value),this.redraw(),this.resetMaterialSearch(),this.drawMaterialResults(),this.activateImages()},lastHighlights:null,lastQuery:null,redraw:function(){var e=this;this.countEl.innerHTML=this.hits.length+"";for(var t=0,n=this.lastHighlights;t<n.length;){var a=n[t];++t,a.clear()}var r;if(0==this.query.length)r=[];else{for(var i=[],o=0,s=this.app.pages.activePages();o<s.length;){var l=s[o];++o;var _=this.highlighters.h[l].get();_.highlight(this.query),i.push(_)}r=i}if(this.lastHighlights=r,this.lastQuery.join(" ")!=this.query.join(" ")){this.lastQuery=this.query,this.bookResultLayer.parentElement.classList.toggle("has-results",this.hits.length>0),this.bookResultLayer.innerHTML="";var u=function(t){null!=e.thumbs[t]&&e.bookResultLayer.appendChild(e.thumbs[t].cloneNode(!0))},c=this.app.get_orientation();if("portrait"==c)for(var d=0,p=this.hits;d<p.length;){var h=p[d];++d,u(h)}else{for(var g=new haxe_ds_IntMap,m=[],v=0,f=this.hits;v<f.length;){var $=f[v];++v;var b=1|$;g.h[b]||(g.h[b]=!0,m.push(b))}for(var w=m,k=0;k<w.length;){var y=w[k];++k,u(y-1),u(y)}}}},activateImages:function(){var e=pagr_Dom.query(".results li.active")[0];if(null!=e){for(var t=e.parentElement.getBoundingClientRect(),n=[],a=0,r=pagr_Dom.query("li.active img[data-src]:not([src])",e.parentElement);a<r.length;){var i=r[a];++a;var o=pagr_Dom.nearest(i,".material").getBoundingClientRect();t.top<o.bottom&&t.bottom>o.top&&n.push(i)}for(var s=n,l=0;l<s.length;){var _=[s[l]];++l;var u=_[0].getAttribute("data-src");_[0].setAttribute("src",u),_[0].onload=function(e){return function(){e[0].removeAttribute("data-src")}}(_)}}},resetHighlights:function(){for(var e=0,t=pagr_Dom.query(".anchor.highlight");e<t.length;){var n=t[e];++e,n.classList.remove("highlight")}},resetMaterialSearch:function(){for(var e=0,t=pagr_Dom.query("#search ~.results li.active");e<t.length;){var n=t[e];++e,n.classList.remove("active")}this.resetHighlights()},drawMaterialResults:function(e){null==e&&(e=!1);var t=this;if(this.query=this.parseQuery(this.input.value),this.togglers=dua_materials_Sidebar.getTogglers(),e){for(var n=0,a=pagr_Dom.query(".results li:not(.book-results)");n<a.length;){var r=a[n];++n,r.parentElement.removeChild(r)}for(var i=this.materialTypes.keys();i.hasNext();){var o=i.next(),s=this.materialTypes;null!=__map_reserved[o]?s.setReserved(o,!1):s.h[o]=!1}}var l=function(e,n){for(var a=t.getLayerMaterials(e),r=window.document.createElement("ul"),i=pagr_Dom.query('.results [data-layer="'+e+'"]')[0],o=0;o<a.length;){var s=a[o];++o;for(var l=0,_=t.renderMaterial(s,e);l<_.length;){var u=_[l];++l;var c=pagr_Dom.query(".thumb",u)[0];null==c&&(c=window.document.createElement("div"),c.innerHTML="<i></i>",c.classList.add("thumb")),u.firstChild.insertBefore(c,u.firstChild.firstChild),r.appendChild(u)}}r.classList.add("search-materials","materials"),null!=i?i.removeChild(pagr_Dom.query(" .search-materials",i)[0]):(i=n.cloneNode(!0),t.resultLayer.appendChild(i));var d=pagr_Dom.query(".amount",i)[0];d.innerHTML=""+a.length,i.classList.toggle("has-results",a.length>0),i.appendChild(r)};l("interactive",this.createTogglerNode("interactive","Schulbuch interaktiv"));for(var _=this.togglers,u=_.keys();u.hasNext();){var c=u.next(),d=null!=__map_reserved[c]?_.getReserved(c):_.h[c];d.classList.contains("Eigene-Materialien")||l(c,d)}for(var p=this.materialTypes.keys();p.hasNext();){var h=p.next(),g=this.materialTypes.get(h);null==g?this.app.get_root().removeAttribute("data-"+h):1==g?this.app.get_root().setAttribute("data-"+h,""):this.app.get_root().removeAttribute("data-"+h)}},idCounter:null,renderMaterial:function(e,t){for(var n=[],a=0,r=e.pageInfos;a<r.length;){var i=r[a];if(++a,t==i.layerId||i.global){for(var o=window.document.createElement("li"),s=e.el.cloneNode(!0),l=0,_=pagr_Dom.query("input.toggler",s);l<_.length;){var u=_[l];++l;for(var c="result_"+this.idCounter++,d=0,p=pagr_Dom.query('label[for="'+u.id+'"]',s);d<p.length;){var h=p[d];++d,h.setAttribute("for",c)}u.id=c}var g=pagr_Dom.query(".content",s)[0],m=window.document.createElement("div");m.innerHTML=i.pos!=-1?"Seite "+i.title:"Global",m.classList.add("title"),i.global||s.setAttribute("data-pos",""+i.pos),null!=g?g.appendChild(m):s.appendChild(m),o.appendChild(s),n.push(o)}}return n},getLayerMaterials:function(e){for(var t=this,n=[],a=0,r=pagr_Dom.query(".menu.active")[0].attributes;a<r.length;){var i=r[a];++a,StringTools.startsWith(i.name,"data-layer-")&&n.push(StringTools.replace(i.name,"data-layer-",""))}for(var o=n,s=this.query.length>0,l=[],_=this.typeTogglers,u=_.keys();u.hasNext();){var c=u.next(),d=null!=__map_reserved[c]?_.getReserved(c):_.h[c];d.checked&&l.push(c)}var p,h=l,g=(this.get_showAllTypes(),function(e){if(o.indexOf(e)<=-1){var n=t.togglers;return null!=__map_reserved[e]?n.existsReserved(e):n.h.hasOwnProperty(e)}return!0});if("interactive"==e){for(var m=[],v=this.interactiveMaterialIndex,f=new haxe_ds__$StringMap_StringMapIterator(v,v.arrayKeys());f.hasNext();){var $=f.next();if(Lambda.exists($.layerIds,g)){var b=$.type,w=this.materialTypes;null!=__map_reserved[b]?w.setReserved(b,!0):w.h[b]=!0,(this.get_showAllTypes()||"other"!=$.type)&&(s&&!this.match($.text)||!(this.get_showAllTypes()||h.indexOf($.type)>-1)||m.push($))}}p=m}else{for(var k=[],y=this.materialIndex,x=new haxe_ds__$StringMap_StringMapIterator(y,y.arrayKeys());x.hasNext();){var C=x.next();if(C.layerIds.indexOf(e)>-1){var D=C.type,S=this.materialTypes;null!=__map_reserved[D]?S.setReserved(D,!0):S.h[D]=!0,(this.get_showAllTypes()||"other"!=C.type)&&(s&&!this.match(C.text)||!(this.get_showAllTypes()||h.indexOf(C.type)>-1)||k.push(C))}}p=k}return p.sort(function(e,t){return e.idx-t.idx}),p},createTogglerNode:function(e,t){var n=window.document.createElement("li");return n.setAttribute("data-layer","interactive"),n.innerHTML='<label><div class="description">'+t+'</div><div class="amount"></div></label>',n},buildMaterialIndex:function(){var e,t=this,n=pagr_Dom.query(".menu:not(.button).active")[0];if(null==n)e=[];else{for(var a=n,r=[],i=0,o=a.attributes;i<o.length;){var s=o[i];++i,StringTools.startsWith(s.name,"data-layer-")&&r.push(StringTools.replace(s.name,"data-layer-",""))}e=r}this.materialIndex=new haxe_ds_StringMap,this.interactiveMaterialIndex=new haxe_ds_StringMap;for(var l,_={global:!0,pos:-1,title:""},u=function(e,n,a,r,i){null==i&&(i=""),null==r&&(r=!1);var o=e.getAttribute("data-material-id");if(null!=o){var s=r?t.interactiveMaterialIndex:t.materialIndex;if(null==(null!=__map_reserved[o]?s.getReserved(o):s.h[o])){var u=e.cloneNode(!0);u.className+=" "+i;for(var c=0,d=pagr_Dom.query(">.richtext",u);c<d.length;){var p=d[c];++c;var h=window.document.createElement("div");h.className="more",h.innerHTML="...mehr",p.parentElement.appendChild(h)}l={idx:Lambda.count(t.materialIndex)+Lambda.count(t.interactiveMaterialIndex),el:u,text:t.getSearchText(u),type:t.getMaterialType(u),layerIds:[a],pageInfos:[n]}}else l=null!=__map_reserved[o]?s.getReserved(o):s.h[o],l.pageInfos.indexOf(n)==-1&&l.pageInfos.indexOf(_)==-1&&l.pageInfos.push(n),l.layerIds.indexOf(a)==-1&&l.layerIds.push(a);null!=__map_reserved[o]?s.setReserved(o,l):s.h[o]=l}},c=0,d=pagr_Dom.query(".menu.active .bubbles .bubble");c<d.length;){var p=d[c];++c;for(var h=p.getAttribute("data-layer"),g=0,m=pagr_Dom.query(".material",p);g<m.length;){var v=m[g];++g,u(v,_,h)}}for(var f=0,$=this.app.pages.all();f<$.length;){var b=$[f];++f;for(var w=0,k=pagr_Dom.query(".annotation-layers .layer",b);w<k.length;){var y=k[w];++w;for(var x=y.getAttribute("data-layer-id"),C=StringTools.replace(y.className,"anchor",""),D={pos:Std.parseInt(b.getAttribute("data-pos")),title:b.getAttribute("data-title"),layerId:x},S=0,I=pagr_Dom.query(".page-wide-materials .materials li>.material",y);S<I.length;){var T=I[S];++S,u(T,D,x)}for(var M=0,A=pagr_Dom.query(".anchor",y);M<A.length;){var L=A[M];++M;var E=pagr_Dom.query(".anchor-materials .material",L),H=C+" "+StringTools.replace(L.className,"anchor",""),P=e.indexOf(x)>-1,N=P?H:x;P&&(D.layerId="interactive");for(var O=0;O<E.length;){var B=E[O];++O,u(B,D,x,P,N)}}}}},getSearchText:function(e){for(var t=[],n=0,a=pagr_Dom.query(".content>h3,.content>h4,.richtext,.content>a",e);n<a.length;){var r=a[n];++n,t.push(StringTools.trim(r.innerText))}return t.join(" ").toLowerCase()},getMaterialType:function(e){var t=new haxe_ds_StringMap;null!=__map_reserved.doc?t.setReserved("doc",'a[href$=".doc"],a[href$=".pdf"],a[href$=".ppt"],a[href$=".xls"]'):t.h.doc='a[href$=".doc"],a[href$=".pdf"],a[href$=".ppt"],a[href$=".xls"]',null!=__map_reserved.app?t.setReserved("app",'a[data-file-type="online-link"],a[data-file-type="desktop-link"]'):t.h.app='a[data-file-type="online-link"],a[data-file-type="desktop-link"]',null!=__map_reserved.audio?t.setReserved("audio",'a[href$=".mp3"]'):t.h.audio='a[href$=".mp3"]',null!=__map_reserved.video?t.setReserved("video",'a[href$=".mp4"]'):t.h.video='a[href$=".mp4"]';for(var n=t,a=n,r=a.keys();r.hasNext();){var i=r.next(),o=null!=__map_reserved[i]?a.getReserved(i):a.h[i];if(pagr_Dom.query(o,e).length>0)return i}return"other"},get_showAllTypes:function(){return!Lambda.exists(this.typeTogglers,function(e){return 0==e.checked})},__class__:dua_search_Form};var dua_search_Highlighter=function(e){this.page=e,this.searchable=pagr_Dom.query(".searchable",e)[0],this.styleSheet=window.document.createElement("style"),this.object=window.document.createElement("object"),this.positions=new haxe_ds_StringMap;var t,n,a,r,i=HxOverrides.iter(dua_search_Highlighter.getSearchableText(e).split(" "));for(t=1,n=0,r=0,a=1e5;r<a&&i.hasNext();){var o=i.next(),s=n+r++*t,l=this.positions;if(!(null!=__map_reserved[o]?l.existsReserved(o):l.h.hasOwnProperty(o))){var _=[],u=this.positions;null!=__map_reserved[o]?u.setReserved(o,_):u.h[o]=_}var c=this.positions;(null!=__map_reserved[o]?c.getReserved(o):c.h[o]).push(s)}this.initSVG()};dua_search_Highlighter.__name__=["dua","search","Highlighter"],dua_search_Highlighter.normalize=function(e){return(e+"").toLowerCase()},dua_search_Highlighter.getSearchableText=function(e){var t=pagr_Dom.query(".searchable .text",e)[0];if(null==t)return"";var n=t;return dua_search_Highlighter.normalize(n.textContent)},dua_search_Highlighter.prototype={page:null,searchable:null,positions:null,styleSheet:null,object:null,initSVG:function(){var e=this;if(null!=this.searchable){var t=pagr_Dom.query("link",this.searchable)[0];if(null==t)return;this.object.data=t.href,this.object.type=t.type,pagr_Dom.on(this.object,"load",null,tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){e.object.contentDocument.documentElement.appendChild(e.styleSheet)})),this.searchable.replaceChild(this.object,t)}},clear:function(){this.styleSheet.innerHTML="",this.object.style.display="none"},highlight:function(e){for(var t=Std.parseInt(this.page.getAttribute("data-pos")),n=this.positions.keys(),a=[],r=n;r.hasNext();)for(var i=r.next(),o=0;o<e.length;){var s=e[o];if(++o,i.indexOf(s)>-1)for(var l=0,_=this.positions,u=null!=__map_reserved[i]?_.getReserved(i):_.h[i];l<u.length;){var c=u[l];++l,a.push("#p"+t+"w"+(c+1))}}var d=a.join(", ");this.object.style.removeProperty("display"),this.styleSheet.innerHTML=""==d?"":d+"{ visibility: visible; }"},__class__:dua_search_Highlighter};var dua_windows_WindowBase=function(e){var t=this;this.className=e,this.viewport=pagr_Dom.query(".pagr .viewport")[0],this.titleEl=pagr_Dom.query(".window."+e+" .title p")[0],this.contentEl=pagr_Dom.query(".window."+e+" .content")[0],this.viewEl=this.contentEl.parentNode,this.toggler=pagr_Dom.query(".window."+e)[0].previousElementSibling,this.defaultTitle=this.get_title(),pagr_Dom.on(this.toggler,"change",null,tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){t.get_isOpen()?t.wakeup():t.sleep()})),pagr_Dom.on(window,"resize",null,tink_core__$Callback_Callback_$Impl_$.fromNiladic($bind(this,this.handleResize)))};dua_windows_WindowBase.__name__=["dua","windows","WindowBase"],dua_windows_WindowBase.prototype={className:null,viewport:null,titleEl:null,contentEl:null,viewEl:null,toggler:null,defaultTitle:null,initialization:null,boot:function(){return new tink_core__$Future_SyncFuture(new tink_core__$Lazy_LazyConst(tink_core_Noise.Noise))},handleResize:function(){this.doResize(this.neededSize(),{width:this.viewport.getBoundingClientRect().width-10,height:this.viewport.getBoundingClientRect().height-48})},neededSize:function(){return{width:this.viewEl.getBoundingClientRect().width,height:this.viewEl.getBoundingClientRect().height}},open:function(e){this.get_isOpen()||this.toggler.click(),null!=e&&this.showContent(e)},showContent:function(e){throw new js__$Boot_HaxeError("showContent not implemented")},doResize:function(e,t){},wakeup:function(){},sleep:function(){},get_isOpen:function(){return this.toggler.checked},get_title:function(){return this.titleEl.innerHTML},set_title:function(e){var t;if(null==e)t=this.defaultTitle;else if(""==e)t=this.defaultTitle;else{var n=e;t=n}return this.titleEl.innerHTML=t,e},__class__:dua_windows_WindowBase};var dua_windows_MediaWindow=function(e,t){this.done=null,null==t&&(t='a[data-file-type^="'+e+'"]'),dua_windows_WindowBase.call(this,e),this.transform=tink_geom2__$Matrix_Matrix_$Impl_$.IDENTITY,pagr_Dom.on(window,"resize",null,tink_core__$Callback_Callback_$Impl_$.fromNiladic($bind(this,this.constrainWindow))),pagr__$Dom_Query_$Impl_$.on(t,"click",null,$bind(this,this.handleClick));externs_HammerMaker.make(this.viewEl.parentElement,{domEvents:!0,recognizers:[externs__$Hammer_HammerRecognizerConfig_$Impl_$._new(Hammer.Pan,{threshold:0,direction:Hammer.DIRECTION_ALL})]});pagr_Dom.on(this.viewEl.parentElement,"panstart",null,$bind(this,this.startDrag)),pagr_Dom.on(window,"touchend mouseup blur",null,tink_core__$Callback_Callback_$Impl_$.fromNiladic($bind(this,this.endDrag)));
};dua_windows_MediaWindow.__name__=["dua","windows","MediaWindow"],dua_windows_MediaWindow.__super__=dua_windows_WindowBase,dua_windows_MediaWindow.prototype=$extend(dua_windows_WindowBase.prototype,{transform:null,get_leftConstrain:function(){return pagr_Dom.query("aside.menu")[0].getBoundingClientRect().right},handleClick:function(e){var t=this;e.event.preventDefault(),e.event.stopPropagation(),e.event.stopImmediatePropagation(),null==this.initialization&&(this.initialization=this.boot()),this.initialization.handle(tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){var n=pagr_Dom.query(">h3",pagr_Dom.nearest(e.at,".content"))[0];t.set_title(null!=n?n.textContent:null),t.transform=tink_geom2__$Matrix_Matrix_$Impl_$.IDENTITY,pagr_Dom.transform(t.viewEl,tink_geom2__$Matrix_Matrix_$Impl_$.toString(t.transform));var a=t.grabContent(e.at);t.open(a)}))},done:null,startDrag:function(e){var t=this,n=e.target,a=pagr_Dom.nearest(n,".title");if(null!=a){var r,i=new tink_core_MPair(e.gesture.deltaX,e.gesture.deltaY);r=i;var o=r;this.done=pagr_Dom.on(this.viewEl.parentElement,"panmove",null,function(e){var n,a=new tink_core_MPair(e.gesture.deltaX,e.gesture.deltaY);n=a;var r,i=n,s=t.transform,l=new tink_core_MPair(i.a-o.a,i.b-o.b);r=l;var _=t.toBounds(r);t.transform=tink_geom2__$Matrix_Matrix_$Impl_$.move(s,_),pagr_Dom.transform(t.viewEl,tink_geom2__$Matrix_Matrix_$Impl_$.toString(t.transform)),o=i}),pagr_Dom.on(this.viewEl.parentElement,"panend",null,tink_core__$Callback_Callback_$Impl_$.fromNiladic($bind(this,this.endDrag)))}},endDrag:function(){if(null!=this.done){var e=this.done;null!=e&&e.dissolve(),this.done=null}},toBounds:function(e){var t=this.viewport.getBoundingClientRect(),n=this.viewEl.getBoundingClientRect(),a=e.a,r=e.b;n.left+e.a<this.get_leftConstrain()?a=this.get_leftConstrain()-n.left:n.right+e.a>t.right+10&&(a=t.right+10-n.right,a=Math.max(a,this.get_leftConstrain()-n.left)),n.top+e.b<t.top-10?r=t.top-n.top-10:n.bottom+e.b>t.bottom+10&&(r=t.bottom+10-n.bottom,r=Math.max(r,t.top-10-n.top));var i,o=new tink_core_MPair(a,r);return i=o},handleResize:function(){this.get_isOpen()&&this.doResize(this.neededSize(),{width:this.viewport.getBoundingClientRect().right+10-this.get_leftConstrain(),height:this.viewport.getBoundingClientRect().height-48})},doResize:function(e,t){var n=this;if(null!=e){var a=e.width/e.height;t.width<e.width&&(e.width=t.width,e.height=t.width/a),t.height<e.height?(this.viewEl.style.marginTop="0",e.height=t.height,e.width=a*t.height):this.viewEl.style.marginTop=(t.height-e.height)/4+"px",this.viewEl.style.width=e.width+"px",this.contentEl.style.height=e.height+10+"px";new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){n.contentEl.style.removeProperty("max-height")},10),$bind($_,$_.stop)))}},constrainWindow:function(){var e=this;if(0!=this.viewEl.parentElement.classList.contains("active")){new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){var t,n=e.transform,a=new tink_core_MPair(0,0);t=a;var r=e.toBounds(t);e.transform=tink_geom2__$Matrix_Matrix_$Impl_$.move(n,r),pagr_Dom.transform(e.viewEl,tink_geom2__$Matrix_Matrix_$Impl_$.toString(e.transform))},200),$bind($_,$_.stop)))}},grabContent:function(e){throw new js__$Boot_HaxeError("grabContent not implemented")},__class__:dua_windows_MediaWindow});var dua_windows_PlayerWindow=function(e){this.isAndroid=window.navigator.userAgent.toLowerCase().indexOf("android")>-1,this.tracks=[],dua_windows_MediaWindow.call(this,e),this.tpl=dua_Views.playerContent(e)};dua_windows_PlayerWindow.__name__=["dua","windows","PlayerWindow"],dua_windows_PlayerWindow.__super__=dua_windows_MediaWindow,dua_windows_PlayerWindow.prototype=$extend(dua_windows_MediaWindow.prototype,{player:null,tpl:null,tracks:null,isAndroid:null,sleep:function(){null!=this.player&&(this.player.dispose(),this.initialization=null)},boot:function(){var e=this,t=(videojs,"#annotation-"+this.className);this.contentEl.innerHTML=this.tpl;var n=pagr_Dom.query(t)[0],a=null;null==a&&(a={});var r=tink_core__$Future_Future_$Impl_$.async(function(e){videojs(n,a,function(){e(this)})}).map(function(t){return e.player=t,e.player.on("loadedmetadata",$bind(e,e.onMetaDataLoad)),tink_core_Noise.Noise});return r.gather()},onMetaDataLoad:function(e){this.handleResize()},grabTracks:function(e){for(var t=[],n=0,a=pagr_Dom.query("track",e.parentElement);n<a.length;){var r=a[n];++n,t.push({src:r.getAttribute("src"),kind:r.getAttribute("kind"),srcLang:r.getAttribute("srcLang"),label:r.getAttribute("label"),def:r.getAttribute("default")})}return t},grabContent:function(e){return{src:e.getAttribute("href"),type:StringTools.replace(e.getAttribute("data-file-type"),"video-mpeg","video-mp4").split("-").join("/"),tracks:this.grabTracks(e),autoplay:!0}},showContent:function(e){this.player.src(e);for(var t=0,n=this.tracks;t<n.length;){var a=n[t];++t,this.player.removeRemoteTextTrack(a)}for(var r=0,i=e.tracks;r<i.length;){var o=i[r];++r;var s=this.player.addRemoteTextTrack({src:o.src,kind:o.kind,language:o.srcLang,label:o.label,"default":null!=o.def&&"false"!=o.def});this.tracks.push(s)}e.autoplay&&this.player.play()},__class__:dua_windows_PlayerWindow});var dua_windows_AudioWindow=function(){dua_windows_PlayerWindow.call(this,"audio")};dua_windows_AudioWindow.__name__=["dua","windows","AudioWindow"],dua_windows_AudioWindow.__super__=dua_windows_PlayerWindow,dua_windows_AudioWindow.prototype=$extend(dua_windows_PlayerWindow.prototype,{handleClick:function(e){dua_windows_PlayerWindow.prototype.handleClick.call(this,e),this.handleResize()},neededSize:function(){return{width:450,height:50}},__class__:dua_windows_AudioWindow});var dua_windows_ImageWindow=function(){var e=this;dua_windows_MediaWindow.call(this,"image"),this.image=pagr_Dom.query("#annotation-image")[0],this.maxToggler=this.toggler.previousElementSibling,pagr_Dom.on(this.image,"load",null,tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){e.imageSize={width:e.image.naturalWidth,height:e.image.naturalHeight},e.handleResize()})),pagr_Dom.on(this.maxToggler,"change",null,function(t){e.maxToggler.checked||e.constrainWindow()})};dua_windows_ImageWindow.__name__=["dua","windows","ImageWindow"],dua_windows_ImageWindow.__super__=dua_windows_MediaWindow,dua_windows_ImageWindow.prototype=$extend(dua_windows_MediaWindow.prototype,{image:null,maxToggler:null,imageSize:null,handleClick:function(e){dua_windows_MediaWindow.prototype.handleClick.call(this,e),this.handleResize()},grabContent:function(e){return e.getAttribute("href")},showContent:function(e){this.image.src=e},neededSize:function(){return utils_Helper.merge(this.imageSize,{width:200,height:200})},sleep:function(){this.image.removeAttribute("src"),this.imageSize={width:200,height:200},this.doResize(this.imageSize,this.imageSize)},__class__:dua_windows_ImageWindow});var dua_windows_Settings=function(e,t){this.lastPage=1;var n=this;this._changed=new tink_core_SignalTrigger,this.changed=this._changed,this.store=dua_annotations_AnnotationStore.getInstance(),this.toggler=pagr_Dom.query(".window.settings")[0].previousElementSibling,this.settings=e,this.app=t;var a=e.productInfo;pagr_App.storage=pagr_App.runtime.storage().forProduct(Std.string(a.productForm)+"_"+Std.string(a.productNumber)),pagr_App.storage.dataStore("settings").get("settings",function(a){if(null!=a){var r=new RegExp("/*\\d+$","".split("u").join("")),i=a.lastPage,o=a.rememberLastPage;new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){if(1==t.get_page()&&null!=o&&o.enabled&&null!=i){var e=window.history,n=window.location.pathname.replace(r,"")+"?page="+i;e.replaceState(i,null,n),t.set_page(i)}},1e3),$bind($_,$_.stop)));n.mergeInto(e,a),n.toggleRememberInfo()}n.set_settings(e)}),t.pages.get_navigated().handle(tink_core__$Callback_Callback_$Impl_$.fromNiladic($bind(this,this.handleAppChange))),pagr__$Dom_Query_$Impl_$.on(".settings input","change",null,$bind(this,this.handleSettingClick)),pagr__$Dom_Query_$Impl_$.on(".del-annos","click",null,tink_core__$Callback_Callback_$Impl_$.fromNiladic($bind(this,this.deleteAnnotations))),pagr__$Dom_Query_$Impl_$.on(".is-remembered","click",null,tink_core__$Callback_Callback_$Impl_$.fromNiladic($bind(this,this.deleteRememberData))),this.get_changed().handle(function(e){"rememberLogin"==e.name&&n.toggleRememberInfo()}),this.toggleRememberInfo()};dua_windows_Settings.__name__=["dua","windows","Settings"],dua_windows_Settings.prototype={_changed:null,changed:null,store:null,toggler:null,lastPage:null,settings:null,app:null,mergeInto:function(e,t){for(var n=0,a=Reflect.fields(t);n<a.length;){var r=a[n];++n;var i=Reflect.field(t,r);if(null!=Reflect.field(e,r)){if(0!=Reflect.field(e,r).overwritable){if(i instanceof Array&&null==i.__enum__)throw new js__$Boot_HaxeError("Not Implemented!");Reflect.isObject(i)&&"string"!=typeof i&&null!=Reflect.field(e,r)?this.mergeInto(Reflect.field(e,r),i):e[r]=i}}else e[r]=i}},handleAppChange:function(){var e=this.app.get_page(),t=this.settings.rememberLastPage;null!=t&&t.enabled&&(this.setSetting("lastPage",e),this.lastPage=e)},deleteAnnotations:function(){var e=this;dua_ConfirmDialog.show("ACHTUNG: Sollen wirklich alle Annotationen gelöscht werden?",!0).handle(tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){e.store.deleteAll(function(e){return"dua_own_material"==e.annotationTypeId}),e.toggler.click()}))},deleteRememberData:function(){var e=this;dua_ConfirmDialog.show("Sollen Ihre hinterlegten Logindaten wirklich gelöscht werden?",!0).handle(tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){pagr_App.storage.dataStore("settings").set("loginData",null,function(){e.toggler.click(),e.toggleRememberInfo()})}))},toggleRememberInfo:function(){var e=this;pagr_App.storage.dataStore("settings").get("loginData",function(t){for(var n=e.getSetting("rememberLogin.enabled"),a=n&&null!=t&&null!=t&&null!=t.userLoginName&&null!=t.userPassword,r=".field."+(a?"not-remembered":"is-remembered"),i=0,o=pagr_Dom.query(".field.info.hidden");i<o.length;){var s=o[i];++i,s.classList.remove("hidden")}pagr_Dom.query(r)[0].classList.add("hidden")})},handleSettingClick:function(e){var t=e.at,n=t.getAttribute("name"),a=this.getSetting(n),r=t.getAttribute("type"),i=null!=a;1==i&&"checkbox"==r&&(a.enabled=t.checked,this.setSetting(n,a),"rememberLastPage"==n&&a.enabled&&this.handleAppChange())},set_settings:function(e){for(var t=e,n=HxOverrides.iter(Reflect.fields(t));n.hasNext();){var a=n.next(),r=t[a];this.setSetting(a,r)}return this.settings},setSetting:function(e,t){var n=e.split(".");n.reduce(function(e,a,r){return r+1==n.length?e[a]=t:e[a]=e[a]||{}},this.settings),tink_core__$Callback_CallbackList_$Impl_$.invoke(this._changed.handlers,{name:e,value:t}),this.toStorage()},getSetting:function(e){if(null==e)return this.settings;var t=e.split(".");return t.reduce(function(e,t){return e?e[t]:null},this.settings)},toStorage:function(){for(var e={},t=this.settings,n=HxOverrides.iter(Reflect.fields(t));n.hasNext();){var a=n.next(),r=t[a];("lastPage"==a||null!=r&&1==r.overwritable)&&(e[a]=r)}pagr_App.storage.dataStore("settings").set("settings",e)},get_changed:function(){return this.changed},__class__:dua_windows_Settings};var dua_windows_VideoWindow=function(){dua_windows_PlayerWindow.call(this,"video"),this.videoSize={}};dua_windows_VideoWindow.__name__=["dua","windows","VideoWindow"],dua_windows_VideoWindow.__super__=dua_windows_PlayerWindow,dua_windows_VideoWindow.prototype=$extend(dua_windows_PlayerWindow.prototype,{videoSize:null,onMetaDataLoad:function(e){var t=this;this.player.play();var n=this.isAndroid?2:0;new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){var e=Math.max(t.player.videoWidth(),600),n=Math.max(t.player.videoHeight(),450);t.videoSize={width:e,height:n},window.vPlayer=t.player,t.handleResize()},1e3*n|0),$bind($_,$_.stop)))},neededSize:function(){return utils_Helper.merge(this.videoSize,{width:600,height:450})},doResize:function(e,t){dua_windows_PlayerWindow.prototype.doResize.call(this,e,t),null!=this.player&&this.player.dimensions(e.width,e.height)},__class__:dua_windows_VideoWindow});var dua_windows__$_$impl_Setting=function(){};dua_windows__$_$impl_Setting.__name__=["dua","windows","__impl","Setting"],dua_windows__$_$impl_Setting.inverseCheckbox=function(e,t){var n=tink_template__$Html_Html_$Impl_$.buffer(),a="\n";n.s+=a;var r='<div class="checkbox field" data-pagr-bind="this.classList.toggle(\'hidden\', pagr.settings.';n.s+=r,n.s+=e;var i=" && pagr.settings.";n.s+=i,n.s+=e;var o='.overwritable == false)">\n      <input id="';n.s+=o,n.s+=e;var s='" name="';n.s+=s,n.s+=e;var l='" type="checkbox" data-pagr-bind="this.checked = pagr.settings.';n.s+=l,n.s+=e;var _=" && !pagr.settings.";n.s+=_,n.s+=e;var u='.enabled">\n      <label for="';n.s+=u,n.s+=e;var c='">';n.s+=c,n.s+=t;var d="</label>\n    </div>\n";n.s+=d;var p=n.s;return p};var externs__$Hammer_HammerRecognizerConfig_$Impl_$={};externs__$Hammer_HammerRecognizerConfig_$Impl_$.__name__=["externs","_Hammer","HammerRecognizerConfig_Impl_"],externs__$Hammer_HammerRecognizerConfig_$Impl_$._new=function(e,t,n,a){var r=[e,t,n,a];return r};var externs_HammerMaker=function(){};externs_HammerMaker.__name__=["externs","HammerMaker"],externs_HammerMaker.make=function(e,t){return new Hammer(e,t)};var haxe_StackItem={__ename__:!0,__constructs__:["CFunction","Module","FilePos","Method","LocalFunction"]};haxe_StackItem.CFunction=["CFunction",0],haxe_StackItem.CFunction.toString=$estr,haxe_StackItem.CFunction.__enum__=haxe_StackItem,haxe_StackItem.Module=function(e){var t=["Module",1,e];return t.__enum__=haxe_StackItem,t.toString=$estr,t},haxe_StackItem.FilePos=function(e,t,n){var a=["FilePos",2,e,t,n];return a.__enum__=haxe_StackItem,a.toString=$estr,a},haxe_StackItem.Method=function(e,t){var n=["Method",3,e,t];return n.__enum__=haxe_StackItem,n.toString=$estr,n},haxe_StackItem.LocalFunction=function(e){var t=["LocalFunction",4,e];return t.__enum__=haxe_StackItem,t.toString=$estr,t};var haxe_IMap=function(){};haxe_IMap.__name__=["haxe","IMap"],haxe_IMap.prototype={get:null,remove:null,__class__:haxe_IMap};var haxe_Http=function(e){this.url=e,this.headers=new List,this.params=new List,this.async=!0,this.withCredentials=!1};haxe_Http.__name__=["haxe","Http"],haxe_Http.requestUrl=function(e){var t=new haxe_Http(e);t.async=!1;var n=null;return t.onData=function(e){n=e},t.onError=function(e){throw new js__$Boot_HaxeError(e)},t.request(!1),n},haxe_Http.prototype={url:null,responseData:null,async:null,withCredentials:null,postData:null,headers:null,params:null,req:null,request:function(e){var t=this;t.responseData=null;var n=this.req=js_Browser.createXMLHttpRequest(),a=function(e){if(4==n.readyState){var a;try{a=n.status}catch(r){a=null}if(null!=a&&"undefined"!=typeof window){var i=window.location.protocol.toLowerCase(),o=new EReg("^(?:about|app|app-storage|.+-extension|file|res|widget):$",""),s=o.match(i);s&&(a=null!=n.responseText?200:404)}if(void 0==a&&(a=null),null!=a&&t.onStatus(a),null!=a&&a>=200&&a<400)t.req=null,t.onData(t.responseData=n.responseText);else if(null==a)t.req=null,t.onError("Failed to connect or resolve host");else switch(a){case 12007:t.req=null,t.onError("Unknown host");break;case 12029:t.req=null,t.onError("Failed to connect to host");break;default:t.req=null,t.responseData=n.responseText,t.onError("Http Error #"+n.status)}}};this.async&&(n.onreadystatechange=a);var r=this.postData;if(null!=r)e=!0;else for(var i=this.params.h;null!=i;){var o=i.item;i=i.next;var s=o;null==r?r="":r+="&";var l=s.param,_=encodeURIComponent(l)+"=",u=s.value;r+=_+encodeURIComponent(u)}try{if(e)n.open("POST",this.url,this.async);else if(null!=r){var c=this.url.split("?").length<=1;n.open("GET",this.url+(c?"?":"&")+r,this.async),r=null}else n.open("GET",this.url,this.async)}catch(d){return d instanceof js__$Boot_HaxeError&&(d=d.val),t.req=null,void this.onError(d.toString())}n.withCredentials=this.withCredentials,!Lambda.exists(this.headers,function(e){return"Content-Type"==e.header})&&e&&null==this.postData&&n.setRequestHeader("Content-Type","application/x-www-form-urlencoded");for(var p=this.headers.h;null!=p;){var h=p.item;p=p.next;var g=h;n.setRequestHeader(g.header,g.value)}n.send(r),this.async||a(null)},onData:function(e){},onError:function(e){},onStatus:function(e){},__class__:haxe_Http};var haxe_crypto_BaseCode=function(e){for(var t=e.length,n=1;t>1<<n;)++n;if(n>8||t!=1<<n)throw new js__$Boot_HaxeError("BaseCode : base length must be a power of two.");this.base=e,this.nbits=n};haxe_crypto_BaseCode.__name__=["haxe","crypto","BaseCode"],haxe_crypto_BaseCode.prototype={base:null,nbits:null,tbl:null,initTable:function(){for(var e=[],t=0;t<256;){var n=t++;e[n]=-1}for(var a=0,r=this.base.length;a<r;){var i=a++;e[this.base.b[i]]=i}this.tbl=e},decodeBytes:function(e){var t=this.nbits;this.base;null==this.tbl&&this.initTable();for(var n=this.tbl,a=e.length*t>>3,r=new haxe_io_Bytes(new ArrayBuffer(a)),i=0,o=0,s=0,l=0;l<a;){for(;o<8;){o+=t,i<<=t;var _=n[e.b[s++]];if(_==-1)throw new js__$Boot_HaxeError("BaseCode : invalid encoded char");i|=_}o-=8,r.b[l++]=i>>o&255&255}return r},decodeString:function(e){return this.decodeBytes(haxe_io_Bytes.ofString(e)).toString()},__class__:haxe_crypto_BaseCode};var haxe_ds_IntMap=function(){this.h={}};haxe_ds_IntMap.__name__=["haxe","ds","IntMap"],haxe_ds_IntMap.__interfaces__=[haxe_IMap],haxe_ds_IntMap.prototype={h:null,get:function(e){return this.h[e]},remove:function(e){return!!this.h.hasOwnProperty(e)&&(delete this.h[e],!0)},keys:function(){var e=[];for(var t in this.h)this.h.hasOwnProperty(t)&&e.push(0|t);return HxOverrides.iter(e)},iterator:function(){return{ref:this.h,it:this.keys(),hasNext:function(){return this.it.hasNext()},next:function(){var e=this.it.next();return this.ref[e]}}},__class__:haxe_ds_IntMap};var haxe_ds__$StringMap_StringMapIterator=function(e,t){this.map=e,this.keys=t,this.index=0,this.count=t.length};haxe_ds__$StringMap_StringMapIterator.__name__=["haxe","ds","_StringMap","StringMapIterator"],haxe_ds__$StringMap_StringMapIterator.prototype={map:null,keys:null,index:null,count:null,hasNext:function(){return this.index<this.count},next:function(){var e=this.map,t=this.keys[this.index++];return null!=__map_reserved[t]?e.getReserved(t):e.h[t]},__class__:haxe_ds__$StringMap_StringMapIterator};var haxe_ds_StringMap=function(){this.h={}};haxe_ds_StringMap.__name__=["haxe","ds","StringMap"],haxe_ds_StringMap.__interfaces__=[haxe_IMap],haxe_ds_StringMap.prototype={h:null,rh:null,get:function(e){return null!=__map_reserved[e]?this.getReserved(e):this.h[e]},setReserved:function(e,t){null==this.rh&&(this.rh={}),this.rh["$"+e]=t},getReserved:function(e){return null==this.rh?null:this.rh["$"+e]},existsReserved:function(e){return null!=this.rh&&this.rh.hasOwnProperty("$"+e)},remove:function(e){return null!=__map_reserved[e]?(e="$"+e,!(null==this.rh||!this.rh.hasOwnProperty(e))&&(delete this.rh[e],!0)):!!this.h.hasOwnProperty(e)&&(delete this.h[e],!0)},keys:function(){return HxOverrides.iter(this.arrayKeys())},arrayKeys:function(){var e=[];for(var t in this.h)this.h.hasOwnProperty(t)&&e.push(t);if(null!=this.rh)for(var t in this.rh)36==t.charCodeAt(0)&&e.push(t.substr(1));return e},iterator:function(){return new haxe_ds__$StringMap_StringMapIterator(this,this.arrayKeys())},__class__:haxe_ds_StringMap};var haxe_io_Bytes=function(e){this.length=e.byteLength,this.b=new Uint8Array(e),this.b.bufferValue=e,e.hxBytes=this,e.bytes=this.b};haxe_io_Bytes.__name__=["haxe","io","Bytes"],haxe_io_Bytes.ofString=function(e){for(var t=[],n=0;n<e.length;){var a=e.charCodeAt(n++);55296<=a&&a<=56319&&(a=a-55232<<10|1023&e.charCodeAt(n++)),a<=127?t.push(a):a<=2047?(t.push(192|a>>6),t.push(128|63&a)):a<=65535?(t.push(224|a>>12),t.push(128|a>>6&63),t.push(128|63&a)):(t.push(240|a>>18),t.push(128|a>>12&63),t.push(128|a>>6&63),t.push(128|63&a))}return new haxe_io_Bytes(new Uint8Array(t).buffer)},haxe_io_Bytes.prototype={length:null,b:null,getString:function(e,t){if(e<0||t<0||e+t>this.length)throw new js__$Boot_HaxeError(haxe_io_Error.OutsideBounds);for(var n="",a=this.b,r=String.fromCharCode,i=e,o=e+t;i<o;){var s=a[i++];if(s<128){if(0==s)break;n+=r(s)}else if(s<224)n+=r((63&s)<<6|127&a[i++]);else if(s<240){var l=a[i++];n+=r((31&s)<<12|(127&l)<<6|127&a[i++])}else{var _=a[i++],u=a[i++],c=(15&s)<<18|(127&_)<<12|(127&u)<<6|127&a[i++];n+=r((c>>10)+55232),n+=r(1023&c|56320)}}return n},toString:function(){return this.getString(0,this.length)},__class__:haxe_io_Bytes};var haxe_io_Error={__ename__:!0,__constructs__:["Blocked","Overflow","OutsideBounds","Custom"]};haxe_io_Error.Blocked=["Blocked",0],haxe_io_Error.Blocked.toString=$estr,haxe_io_Error.Blocked.__enum__=haxe_io_Error,haxe_io_Error.Overflow=["Overflow",1],haxe_io_Error.Overflow.toString=$estr,haxe_io_Error.Overflow.__enum__=haxe_io_Error,haxe_io_Error.OutsideBounds=["OutsideBounds",2],haxe_io_Error.OutsideBounds.toString=$estr,haxe_io_Error.OutsideBounds.__enum__=haxe_io_Error,haxe_io_Error.Custom=function(e){var t=["Custom",3,e];return t.__enum__=haxe_io_Error,t.toString=$estr,t};var haxe_io_Path=function(e){switch(e){case".":case"..":return this.dir=e,void(this.file="")}var t=e.lastIndexOf("/"),n=e.lastIndexOf("\\");t<n?(this.dir=HxOverrides.substr(e,0,n),e=HxOverrides.substr(e,n+1,null),this.backslash=!0):n<t?(this.dir=HxOverrides.substr(e,0,t),e=HxOverrides.substr(e,t+1,null)):this.dir=null;var a=e.lastIndexOf(".");a!=-1?(this.ext=HxOverrides.substr(e,a+1,null),this.file=HxOverrides.substr(e,0,a)):(this.ext=null,this.file=e)};haxe_io_Path.__name__=["haxe","io","Path"],haxe_io_Path.directory=function(e){var t=new haxe_io_Path(e);return null==t.dir?"":t.dir},haxe_io_Path.join=function(e){var t=e.filter(function(e){return null!=e&&""!=e});if(0==t.length)return"";for(var n=t[0],a=1,r=t.length;a<r;){var i=a++;n=haxe_io_Path.addTrailingSlash(n),n+=t[i]}return haxe_io_Path.normalize(n)},haxe_io_Path.normalize=function(e){var t="/";if(e=e.split("\\").join(t),e==t)return t;for(var n=[],a=0,r=e.split(t);a<r.length;){var i=r[a];++a,".."==i&&n.length>0&&".."!=n[n.length-1]?n.pop():"."!=i&&n.push(i)}for(var o=n.join(t),s=new RegExp("([^:])/+","g".split("u").join("")),l=(o.replace(s,"$1"+t),""),_=!1,u=!1,c=0,d=o.length;c<d;){var p=c++,h=o.charCodeAt(p);switch(h){case 47:if(_){var g=h;_=!1,u&&(l+="/",u=!1),l+=String.fromCharCode(g)}else u=!0;break;case 58:l+=":",_=!0;break;default:var m=h;_=!1,u&&(l+="/",u=!1),l+=String.fromCharCode(m)}}return l},haxe_io_Path.addTrailingSlash=function(e){if(0==e.length)return"/";var t=e.lastIndexOf("/"),n=e.lastIndexOf("\\");return t<n?n!=e.length-1?e+"\\":e:t!=e.length-1?e+"/":e},haxe_io_Path.prototype={dir:null,file:null,ext:null,backslash:null,__class__:haxe_io_Path};var haxe_xml__$Fast_NodeAccess=function(e){this.__x=e};haxe_xml__$Fast_NodeAccess.__name__=["haxe","xml","_Fast","NodeAccess"],haxe_xml__$Fast_NodeAccess.prototype={__x:null,resolve:function(e){var t=this.__x.elementsNamed(e).next();if(null==t){var n;if(this.__x.nodeType==Xml.Document)n="Document";else{var a=this.__x;if(a.nodeType!=Xml.Element)throw new js__$Boot_HaxeError("Bad node type, expected Element but found "+a.nodeType);n=a.nodeName}throw new js__$Boot_HaxeError(n+" is missing element "+e)}return new haxe_xml_Fast(t)},__class__:haxe_xml__$Fast_NodeAccess};var haxe_xml__$Fast_AttribAccess=function(e){this.__x=e};haxe_xml__$Fast_AttribAccess.__name__=["haxe","xml","_Fast","AttribAccess"],haxe_xml__$Fast_AttribAccess.prototype={__x:null,resolve:function(e){if(this.__x.nodeType==Xml.Document)throw new js__$Boot_HaxeError("Cannot access document attribute "+e);var t=this.__x.get(e);if(null==t){var n=this.__x;if(n.nodeType!=Xml.Element)throw new js__$Boot_HaxeError("Bad node type, expected Element but found "+n.nodeType);throw new js__$Boot_HaxeError(n.nodeName+" is missing attribute "+e)}return t},__class__:haxe_xml__$Fast_AttribAccess};var haxe_xml__$Fast_HasAttribAccess=function(e){this.__x=e};haxe_xml__$Fast_HasAttribAccess.__name__=["haxe","xml","_Fast","HasAttribAccess"],haxe_xml__$Fast_HasAttribAccess.prototype={__x:null,__class__:haxe_xml__$Fast_HasAttribAccess};var haxe_xml__$Fast_HasNodeAccess=function(e){this.__x=e};haxe_xml__$Fast_HasNodeAccess.__name__=["haxe","xml","_Fast","HasNodeAccess"],haxe_xml__$Fast_HasNodeAccess.prototype={__x:null,resolve:function(e){return this.__x.elementsNamed(e).hasNext()},__class__:haxe_xml__$Fast_HasNodeAccess};var haxe_xml__$Fast_NodeListAccess=function(e){this.__x=e};haxe_xml__$Fast_NodeListAccess.__name__=["haxe","xml","_Fast","NodeListAccess"],haxe_xml__$Fast_NodeListAccess.prototype={__x:null,resolve:function(e){for(var t=new List,n=this.__x.elementsNamed(e);n.hasNext();){var a=n.next();t.add(new haxe_xml_Fast(a))}return t},__class__:haxe_xml__$Fast_NodeListAccess};var haxe_xml_Fast=function(e){if(e.nodeType!=Xml.Document&&e.nodeType!=Xml.Element)throw new js__$Boot_HaxeError("Invalid nodeType "+e.nodeType);this.x=e,this.node=new haxe_xml__$Fast_NodeAccess(e),this.nodes=new haxe_xml__$Fast_NodeListAccess(e),this.att=new haxe_xml__$Fast_AttribAccess(e),this.has=new haxe_xml__$Fast_HasAttribAccess(e),this.hasNode=new haxe_xml__$Fast_HasNodeAccess(e)};haxe_xml_Fast.__name__=["haxe","xml","Fast"],haxe_xml_Fast.prototype={x:null,node:null,nodes:null,att:null,has:null,hasNode:null,get_name:function(){if(this.x.nodeType==Xml.Document)return"Document";var e=this.x;if(e.nodeType!=Xml.Element)throw new js__$Boot_HaxeError("Bad node type, expected Element but found "+e.nodeType);return e.nodeName},get_innerData:function(){var e=this.x;if(e.nodeType!=Xml.Document&&e.nodeType!=Xml.Element)throw new js__$Boot_HaxeError("Bad node type, expected Element or Document but found "+e.nodeType);var t=HxOverrides.iter(e.children);if(!t.hasNext())throw new js__$Boot_HaxeError(this.get_name()+" does not have data");var n=t.next();if(t.hasNext()){var a,r=t.next();if(n.nodeType==Xml.PCData&&r.nodeType==Xml.CData){if(n.nodeType==Xml.Document||n.nodeType==Xml.Element)throw new js__$Boot_HaxeError("Bad node type, unexpected "+n.nodeType);a=""==StringTools.trim(n.nodeValue)}else a=!1;if(a){if(!t.hasNext()){if(r.nodeType==Xml.Document||r.nodeType==Xml.Element)throw new js__$Boot_HaxeError("Bad node type, unexpected "+r.nodeType);return r.nodeValue}var i,o,s=t.next();if(s.nodeType==Xml.PCData){if(s.nodeType==Xml.Document||s.nodeType==Xml.Element)throw new js__$Boot_HaxeError("Bad node type, unexpected "+s.nodeType);o=""==StringTools.trim(s.nodeValue)}else o=!1;if(i=!!o&&!t.hasNext()){if(r.nodeType==Xml.Document||r.nodeType==Xml.Element)throw new js__$Boot_HaxeError("Bad node type, unexpected "+r.nodeType);return r.nodeValue}}throw new js__$Boot_HaxeError(this.get_name()+" does not only have data")}if(n.nodeType!=Xml.PCData&&n.nodeType!=Xml.CData)throw new js__$Boot_HaxeError(this.get_name()+" does not have data");if(n.nodeType==Xml.Document||n.nodeType==Xml.Element)throw new js__$Boot_HaxeError("Bad node type, unexpected "+n.nodeType);return n.nodeValue},__class__:haxe_xml_Fast};var haxe_xml_XmlParserException=function(e,t,n){this.xml=t,this.message=e,this.position=n,this.lineNumber=1,this.positionAtLine=0;for(var a=0,r=n;a<r;){var i=a++,o=t.charCodeAt(i);10==o?(this.lineNumber++,this.positionAtLine=0):13!=o&&this.positionAtLine++}};haxe_xml_XmlParserException.__name__=["haxe","xml","XmlParserException"],haxe_xml_XmlParserException.prototype={message:null,lineNumber:null,positionAtLine:null,position:null,xml:null,toString:function(){return Type.getClassName(js_Boot.getClass(this))+": "+this.message+" at line "+this.lineNumber+" char "+this.positionAtLine},__class__:haxe_xml_XmlParserException};var haxe_xml_Parser=function(){};haxe_xml_Parser.__name__=["haxe","xml","Parser"],haxe_xml_Parser.parse=function(e,t){null==t&&(t=!1);var n=Xml.createDocument();return haxe_xml_Parser.doParse(e,t,0,n),n},haxe_xml_Parser.doParse=function(e,t,n,a){null==n&&(n=0);for(var r=null,i=1,o=1,s=null,l=0,_=0,u=0,c=e.charCodeAt(n),d=new StringBuf,p=1,h=-1;c==c;){switch(i){case 0:switch(c){case 9:case 10:case 13:case 32:break;default:i=o;continue}break;case 1:if(60!=c){l=n,i=13;continue}i=0,o=2;break;case 2:switch(c){case 33:if(91==e.charCodeAt(n+1)){if(n+=2,"CDATA["!=HxOverrides.substr(e,n,6).toUpperCase())throw new js__$Boot_HaxeError(new haxe_xml_XmlParserException("Expected <![CDATA[",e,n));n+=5,i=17,l=n+1}else if(68==e.charCodeAt(n+1)||100==e.charCodeAt(n+1)){if("OCTYPE"!=HxOverrides.substr(e,n+2,6).toUpperCase())throw new js__$Boot_HaxeError(new haxe_xml_XmlParserException("Expected <!DOCTYPE",e,n));n+=8,i=16,l=n+1}else{if(45!=e.charCodeAt(n+1)||45!=e.charCodeAt(n+2))throw new js__$Boot_HaxeError(new haxe_xml_XmlParserException("Expected <!--",e,n));n+=2,i=15,l=n+1}break;case 47:if(null==a)throw new js__$Boot_HaxeError(new haxe_xml_XmlParserException("Expected node name",e,n));l=n+1,i=0,o=10;break;case 63:i=14,l=n;break;default:i=3,l=n;continue}break;case 3:if(!(c>=97&&c<=122||c>=65&&c<=90||c>=48&&c<=57||58==c||46==c||95==c||45==c)){if(n==l)throw new js__$Boot_HaxeError(new haxe_xml_XmlParserException("Expected node name",e,n));r=Xml.createElement(HxOverrides.substr(e,l,n-l)),a.addChild(r),++_,i=0,o=4;continue}break;case 4:switch(c){case 47:i=11;break;case 62:i=9;break;default:i=5,l=n;continue}break;case 5:if(!(c>=97&&c<=122||c>=65&&c<=90||c>=48&&c<=57||58==c||46==c||95==c||45==c)){var g;if(l==n)throw new js__$Boot_HaxeError(new haxe_xml_XmlParserException("Expected attribute name",e,n));if(g=HxOverrides.substr(e,l,n-l),s=g,r.exists(s))throw new js__$Boot_HaxeError(new haxe_xml_XmlParserException("Duplicate attribute ["+s+"]",e,n));i=0,o=6;continue}break;case 6:if(61!=c)throw new js__$Boot_HaxeError(new haxe_xml_XmlParserException("Expected =",e,n));i=0,o=7;break;case 7:switch(c){case 34:case 39:d=new StringBuf,i=8,l=n+1,h=c;break;default:throw new js__$Boot_HaxeError(new haxe_xml_XmlParserException('Expected "',e,n))}break;case 8:switch(c){case 38:var m=n-l;d.b+=null==m?HxOverrides.substr(e,l,null):HxOverrides.substr(e,l,m),i=18,p=8,l=n+1;break;case 60:case 62:if(t)throw new js__$Boot_HaxeError(new haxe_xml_XmlParserException("Invalid unescaped "+String.fromCharCode(c)+" in attribute value",e,n));if(c==h){var v=n-l;d.b+=null==v?HxOverrides.substr(e,l,null):HxOverrides.substr(e,l,v);var f=d.b;d=new StringBuf,r.set(s,f),i=0,o=4}break;default:if(c==h){var $=n-l;d.b+=null==$?HxOverrides.substr(e,l,null):HxOverrides.substr(e,l,$);var b=d.b;d=new StringBuf,r.set(s,b),i=0,o=4}}break;case 9:n=haxe_xml_Parser.doParse(e,t,n,r),l=n,i=1;break;case 10:if(!(c>=97&&c<=122||c>=65&&c<=90||c>=48&&c<=57||58==c||46==c||95==c||45==c)){if(l==n)throw new js__$Boot_HaxeError(new haxe_xml_XmlParserException("Expected node name",e,n));var w=HxOverrides.substr(e,l,n-l);if(a.nodeType!=Xml.Element)throw new js__$Boot_HaxeError("Bad node type, expected Element but found "+a.nodeType);if(w!=a.nodeName){if(a.nodeType!=Xml.Element)throw new js__$Boot_HaxeError("Bad node type, expected Element but found "+a.nodeType);throw new js__$Boot_HaxeError(new haxe_xml_XmlParserException("Expected </"+a.nodeName+">",e,n))}i=0,o=12;continue}break;case 11:if(62!=c)throw new js__$Boot_HaxeError(new haxe_xml_XmlParserException("Expected >",e,n));i=1;break;case 12:if(62==c)return 0==_&&a.addChild(Xml.createPCData("")),n;throw new js__$Boot_HaxeError(new haxe_xml_XmlParserException("Expected >",e,n));case 13:if(60==c){var k=n-l;d.b+=null==k?HxOverrides.substr(e,l,null):HxOverrides.substr(e,l,k);var y=Xml.createPCData(d.b);d=new StringBuf,a.addChild(y),++_,i=0,o=2}else if(38==c){var x=n-l;d.b+=null==x?HxOverrides.substr(e,l,null):HxOverrides.substr(e,l,x),i=18,p=13,l=n+1}break;case 14:if(63==c&&62==e.charCodeAt(n+1)){++n;var C=HxOverrides.substr(e,l+1,n-l-2);a.addChild(Xml.createProcessingInstruction(C)),++_,i=1}break;case 15:45==c&&45==e.charCodeAt(n+1)&&62==e.charCodeAt(n+2)&&(a.addChild(Xml.createComment(HxOverrides.substr(e,l,n-l))),++_,n+=2,i=1);break;case 16:91==c?++u:93==c?--u:62==c&&0==u&&(a.addChild(Xml.createDocType(HxOverrides.substr(e,l,n-l))),
++_,i=1);break;case 17:if(93==c&&93==e.charCodeAt(n+1)&&62==e.charCodeAt(n+2)){var D=Xml.createCData(HxOverrides.substr(e,l,n-l));a.addChild(D),++_,n+=2,i=1}break;case 18:if(59==c){var S=HxOverrides.substr(e,l,n-l);if(35==S.charCodeAt(0)){var I=120==S.charCodeAt(1)?Std.parseInt("0"+HxOverrides.substr(S,1,S.length-1)):Std.parseInt(HxOverrides.substr(S,1,S.length-1));d.b+=String.fromCharCode(I)}else{var T=haxe_xml_Parser.escapes;if(null!=__map_reserved[S]?T.existsReserved(S):T.h.hasOwnProperty(S)){var M=haxe_xml_Parser.escapes,A=null!=__map_reserved[S]?M.getReserved(S):M.h[S];d.b+=Std.string(A)}else{if(t)throw new js__$Boot_HaxeError(new haxe_xml_XmlParserException("Undefined entity: "+S,e,n));d.b+=Std.string("&"+S+";")}}l=n+1,i=p}else if(!(c>=97&&c<=122||c>=65&&c<=90||c>=48&&c<=57||58==c||46==c||95==c||45==c)&&35!=c){if(t)throw new js__$Boot_HaxeError(new haxe_xml_XmlParserException("Invalid character in entity: "+String.fromCharCode(c),e,n));d.b+="&";var L=n-l;d.b+=null==L?HxOverrides.substr(e,l,null):HxOverrides.substr(e,l,L),l=n--,i=p}}c=e.charCodeAt(++n)}if(1==i&&(l=n,i=13),13==i){if(n!=l||0==_){var E=n-l;d.b+=null==E?HxOverrides.substr(e,l,null):HxOverrides.substr(e,l,E),a.addChild(Xml.createPCData(d.b)),++_}return n}if(!t&&18==i&&13==p){d.b+="&";var H=n-l;return d.b+=null==H?HxOverrides.substr(e,l,null):HxOverrides.substr(e,l,H),a.addChild(Xml.createPCData(d.b)),++_,n}throw new js__$Boot_HaxeError(new haxe_xml_XmlParserException("Unexpected end",e,n))};var js__$Boot_HaxeError=function(e){Error.call(this),this.val=e,this.message=String(e),Error.captureStackTrace&&Error.captureStackTrace(this,js__$Boot_HaxeError)};js__$Boot_HaxeError.__name__=["js","_Boot","HaxeError"],js__$Boot_HaxeError.wrap=function(e){return e instanceof Error?e:new js__$Boot_HaxeError(e)},js__$Boot_HaxeError.__super__=Error,js__$Boot_HaxeError.prototype=$extend(Error.prototype,{val:null,__class__:js__$Boot_HaxeError});var js_Browser=function(){};js_Browser.__name__=["js","Browser"],js_Browser.createXMLHttpRequest=function(){if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)return new ActiveXObject("Microsoft.XMLHTTP");throw new js__$Boot_HaxeError("Unable to create XMLHttpRequest object.")};var js_html_compat_ArrayBuffer=function(e){if(e instanceof Array&&null==e.__enum__)this.a=e,this.byteLength=e.length;else{var t=e;this.a=[];for(var n=0,a=t;n<a;){var r=n++;this.a[r]=0}this.byteLength=t}};js_html_compat_ArrayBuffer.__name__=["js","html","compat","ArrayBuffer"],js_html_compat_ArrayBuffer.sliceImpl=function(e,t){var n=new Uint8Array(this,e,null==t?null:t-e),a=new ArrayBuffer(n.byteLength),r=new Uint8Array(a);return r.set(n),a},js_html_compat_ArrayBuffer.prototype={byteLength:null,a:null,slice:function(e,t){return new js_html_compat_ArrayBuffer(this.a.slice(e,t))},__class__:js_html_compat_ArrayBuffer};var js_html_compat_Uint8Array=function(){};js_html_compat_Uint8Array.__name__=["js","html","compat","Uint8Array"],js_html_compat_Uint8Array._new=function(e,t,n){var a;if("number"==typeof e){a=[];for(var r=0,i=e;r<i;){var o=r++;a[o]=0}a.byteLength=a.length,a.byteOffset=0,a.buffer=new js_html_compat_ArrayBuffer(a)}else if(js_Boot.__instanceof(e,js_html_compat_ArrayBuffer)){var s=e;null==t&&(t=0),null==n&&(n=s.byteLength-t),a=0==t?s.a:s.a.slice(t,t+n),a.byteLength=a.length,a.byteOffset=t,a.buffer=s}else{if(!(e instanceof Array&&null==e.__enum__))throw new js__$Boot_HaxeError("TODO "+Std.string(e));a=e.slice(),a.byteLength=a.length,a.byteOffset=0,a.buffer=new js_html_compat_ArrayBuffer(a)}return a.subarray=js_html_compat_Uint8Array._subarray,a.set=js_html_compat_Uint8Array._set,a},js_html_compat_Uint8Array._set=function(e,t){if(js_Boot.__instanceof(e.buffer,js_html_compat_ArrayBuffer)){var n=e;if(e.byteLength+t>this.byteLength)throw new js__$Boot_HaxeError("set() outside of range");for(var a=0,r=e.byteLength;a<r;){var i=a++;this[i+t]=n[i]}}else{if(!(e instanceof Array&&null==e.__enum__))throw new js__$Boot_HaxeError("TODO");var o=e;if(o.length+t>this.byteLength)throw new js__$Boot_HaxeError("set() outside of range");for(var s=0,l=o.length;s<l;){var _=s++;this[_+t]=o[_]}}},js_html_compat_Uint8Array._subarray=function(e,t){var n=js_html_compat_Uint8Array._new(this.slice(e,t));return n.byteOffset=e,n};var pagr_Bindings=function(e){var t=this;this.app=e,this.wrapper=pagr_Dom.es5ify(e),pagr__$Dom_Query_$Impl_$.on("[data-pagr-action]","click",null,function(e){var n=e.at.getAttribute("data-pagr-action");t.eval(n,e.at)}),pagr__$Dom_Query_$Impl_$.on("[data-pagr-mode]","click",null,function(t){e.set_mode(t.at.getAttribute("data-pagr-mode"))}),this.fireWhenever(e.get_zoomChanged()),this.fireWhenever(e.pages.get_navigated()),this.fireWhenever(e.modes.get_changed()),this.fireWhenever(e.get_settingsChanged()),window.pagr=this.wrapper};pagr_Bindings.__name__=["pagr","Bindings"],pagr_Bindings.prototype={app:null,wrapper:null,fireWhenever:function(e,t){var n=$bind(this,this.updateBindings),a=t;e.handle(tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){n(a)}))},updateBindings:function(e){null==e&&(e=this.app.get_root());for(var t=0,n=pagr_Dom.query("[data-pagr-bind]",e);t<n.length;){var a=n[t];++t,this.eval(a.getAttribute("data-pagr-bind"),a)}for(var r=this.app.get_mode(),i=0,o=pagr_Dom.query("[data-pagr-mode]",e);i<o.length;){var s=o[i];++i;var l,_=s.getAttribute("data-pagr-mode");switch(_){case"delete":case"draw":case"line":case"notes":case"selectAll":case"selectMove":var u=_;l=u;break;default:l=null}var c=l==r;s.classList.toggle("active",c)}},eval:function(code,self){if(null!=code){var func=eval("(function (pagr) { "+code+"; })");return func.call(self,this.wrapper)}return null},__class__:pagr_Bindings};var pagr__$Dom_Query_$Impl_$={};pagr__$Dom_Query_$Impl_$.__name__=["pagr","_Dom","Query_Impl_"],pagr__$Dom_Query_$Impl_$.toArray=function(e){for(var t=[],n=0;n<e.length;){var a=e[n];++n,t.push(a)}return t},pagr__$Dom_Query_$Impl_$.on=function(e,t,n,a){return null==n&&(n=!1),pagr_Dom.on(window.document.body,t,n,function(t){for(var n=0,r=pagr_Dom.parents(t.target,e);n<r.length;){var i=r[n];if(++n,a({at:i,event:t}),t.defaultPrevented)return}})};var pagr_PageController=function(e){this.fromUserAction=!1,this._navigated=new tink_core_SignalTrigger,this.app=e,this.navigated=this._navigated,this.pageLayer=pagr_Dom.query(".pagr .pages")[0],this.pages=pagr_Dom.query(".pagr .page")};pagr_PageController.__name__=["pagr","PageController"],pagr_PageController.prototype={_navigated:null,back:null,app:null,basePath:null,fromUserAction:null,navigated:null,pageLayer:null,pages:null,all:function(){return pagr__$Dom_Query_$Impl_$.toArray(this.pages)},init:function(){var e=this;this.initHistory(),pagr_Dom.on(window.document,"doubletap",null,function(t){t.preventDefault(),e.app.reset()})},renderThumb:function(e){var t;try{t=pagr_Dom.query(".pagr-thumb",this.pages[e])[0].outerHTML}catch(n){t=""}var a=t;return a},initHistory:function(){var e=this,t=new RegExp("/*\\d+$","".split("u").join(""));this.basePath=window.location.pathname.replace(t,""),pagr_Dom.on(window,"popstate",null,$bind(this,this.onHistoryChange)),this.check();var n=!0;pagr__$Dom_Query_$Impl_$.on("a[href]","click",null,function(t){if(StringTools.startsWith(t.at.getAttribute("href"),"?page")&&(t.event.preventDefault(),t.event.stopPropagation(),t.event.stopImmediatePropagation(),n)){n=!1;new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){n=!0},10),$bind($_,$_.stop)));e.onNavigationClick(t)}})},check:function(){var e=this,t=window.history.state?window.history.state:this.getPageFromPath();if(this.get_page()!=t){new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){e.set_page(t),window.history.replaceState(t,null,e.basePath+"?page="+t)},100),$bind($_,$_.stop)))}},onNavigationClick:function(e){for(var t=0,n=pagr_Dom.query("input.toggle-window:checked");t<n.length;){var a=n[t];++t,a.click()}var r=e.event;r.preventDefault();var i=e.at;i.classList.contains("nav")?this.back=null:this.back="?"+(StringTools.startsWith(window.location.search,"?page")?window.location.href.split("?").pop():"page=1"),this.fromUserAction=!0,this.set_page(this.getPageFromPath(i.href))},onHistoryChange:function(e){e.state&&this.get_page()!=e.state&&(e.preventDefault(),this.set_page(e.state))},getPageFromPath:function(e){null==e&&(e=window.location.href);var t=new RegExp(".*\\?page=(\\d*)","".split("u").join("")),n=Std.parseInt(e.replace(t,"$1"));return isNaN(n)||n<1?1:n},getTitle:function(e){var t=this.pages[e].getAttribute("data-title");if(null==t)return"";var n=t;return n},activePages:function(){for(var e=[],t=0,n=pagr_Dom.query(".page.active");t<n.length;){var a=n[t];++t,e.push(Std.parseInt(a.getAttribute("data-pos")))}return e},getPages:function(){for(var e=[],t=0,n=pagr_Dom.query(".page.active");t<n.length;){var a=n[t];++t;var r=a.getAttribute("data-title");if(null!=r&&""!=r){var i=r;e.push(i)}}return e},setPage:function(e){var t=this;if(this.app.reset()){new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){t.setPage(e)},500),$bind($_,$_.stop)))}else{new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){t.app.applyTransform(tink_geom2__$Matrix_Matrix_$Impl_$.IDENTITY,{animated:!0})},100),$bind($_,$_.stop)));e<1&&(e=1);var n=this.pages.length;e>=n&&(e=n-1),e+=(e+1)%this.get_step();for(var a=this.get_step(),r=this.get_page(),i=[],o=e-a,s=e;o<s;){var l=o++,_=this.pages[l+1];if(null!=_){var u=_;this.revive(u)}}for(var c=0,d=pagr_Dom.query(".page");c<d.length;){var p=d[c];++c;var h=Std.parseInt(p.getAttribute("data-pos")),g=h>e-a&&h<=e;g||this.dispose(p),g!=p.classList.contains("active")&&i.push({elt:p,visible:g})}new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){for(var e=0;e<i.length;){var n=[i[e]];++e,n[0].visible&&t.get_belazy()&&!n[0].elt.classList.contains("lazy")&&(n[0].elt.classList.toggle("lazy",!0),pagr_Dom.on(n[0].elt,"transitionend",null,tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(e){return function(){e[0].elt.classList.toggle("lazy",!1)}}(n)))),n[0].elt.classList.toggle("active",n[0].visible)}var a=t._navigated,r=pagr__$Dom_Query_$Impl_$.toArray(pagr_Dom.query(".page.active"));tink_core__$Callback_CallbackList_$Impl_$.invoke(a.handlers,r)},10),$bind($_,$_.stop)));r!=e&&this.fromUserAction&&(window.history.pushState(e,null,this.basePath+"?page="+e),this.fromUserAction=!1)}},dispose:function(e){if(null!=e.parentNode)if(e.classList.contains("active")){if(!e.hasAttribute("data-pending")){e.setAttribute("data-pending","");new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){e.removeAttribute("data-pending"),e.classList.contains("active")||e.classList.contains("active")||null!=e.parentNode&&e.parentNode.removeChild(e)},2500),$bind($_,$_.stop)))}}else e.hasAttribute("data-pending")||e.classList.contains("active")||null!=e.parentNode&&e.parentNode.removeChild(e)},revive:function(e){if(null==e.parentNode||"none"==e.style.display)for(var t=Std.parseInt(e.getAttribute("data-pos")),n=this.pageLayer.children.length,a=0,r=n+1;a<r;){var i=a++;if((0==i||t>Std.parseInt(this.pageLayer.children[i-1].getAttribute("data-pos")))&&(i==n||t<Std.parseInt(this.pageLayer.children[i].getAttribute("data-pos"))))return void(i<n?this.pageLayer.insertBefore(e,this.pageLayer.children[i]):this.pageLayer.appendChild(e))}},get_step:function(){return"portrait"==this.app.get_orientation()?1:2},get_navigated:function(){return this.navigated},get_page:function(){var e=pagr_Dom.query(".page.active");return Std.parseInt(e[e.length-1].getAttribute("data-pos"))},set_page:function(e){return this.setPage(e),e},get_belazy:function(){return pagr_App.isIos},__class__:pagr_PageController};var pagr_Tooltip=function(){};pagr_Tooltip.__name__=["pagr","Tooltip"],pagr_Tooltip.init=function(){pagr__$Dom_Query_$Impl_$.on('.pagr[data-setting-tooltips="1"] .tooltip+*',"mouseover",null,pagr_Tooltip.initTooltip),pagr__$Dom_Query_$Impl_$.on('.pagr[data-setting-tooltips="1"] [data-tooltip-id]',"mouseover",null,pagr_Tooltip.activate),pagr__$Dom_Query_$Impl_$.on("[data-tooltip-id]","mouseout",null,tink_core__$Callback_Callback_$Impl_$.fromNiladic(pagr_Tooltip.hide)),pagr__$Dom_Query_$Impl_$.on(".tooltip-layer [data-id]","mouseover",null,tink_core__$Callback_Callback_$Impl_$.fromNiladic(pagr_Tooltip.hide))},pagr_Tooltip.hide=function(){for(var e=0,t=pagr_Dom.query(".tooltip.active");e<t.length;){var n=t[e];++e,n.classList.remove("active")}},pagr_Tooltip.initTooltip=function(e){var t=e.at;if(t.removeAttribute("title"),!pagr_Tooltip.layer.contains(t)){var n=t.previousElementSibling,a=Std.string(pagr_Tooltip.idCounter++);pagr_Tooltip.layer.appendChild(n);new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){n.setAttribute("data-id",a),t.setAttribute("data-tooltip-id",a),pagr_Tooltip.activate(e)},100),$bind($_,$_.stop)))}},pagr_Tooltip.activate=function(e){for(var t=e.at,n=t.getAttribute("data-tooltip-id"),a=0,r=pagr_Dom.query(".tooltip-layer .tooltip");a<r.length;){var i=r[a];++a,i.classList.remove("active")}var o=pagr_Dom.query('.tooltip-layer .tooltip[data-id="'+n+'"]')[0],s=""!=o.getAttribute("data-placement")?o.getAttribute("placement"):"horizontal";o.classList.add("active"),"horizontal"==s?pagr_Tooltip.attachHorizontal(o,t):pagr_Tooltip.attachVertical(o,t)},pagr_Tooltip.attachHorizontal=function(e,t){var n=t.getBoundingClientRect();e.setAttribute("data-halign",n.left<100?"left":n.right>window.innerWidth-100?"right":"center"),e.setAttribute("data-valign",n.top<100?"bottom":"top"),e.style.left=(n.left+n.right)/2+"px";var a="bottom"==e.getAttribute("data-valign")?n.bottom+"px":n.top+"px";e.style.top=a},pagr_Tooltip.attachVertical=function(e,t){var n=t.getBoundingClientRect(),a=pagr_Dom.query(".tooltip-content",e)[0].getBoundingClientRect();e.setAttribute("data-halign",n.right>window.innerWidth/2?"left":"right"),e.style.top=(n.top+n.bottom)/2+"px","right"==e.getAttribute("data-halign")?e.style.left=n.right+"px":e.style.left=n.left-a.width+"px"};var pagr_Windows=function(){};pagr_Windows.__name__=["pagr","Windows"],pagr_Windows.handleResize=function(){var e=pagr_Dom.query("input.toggle-window:checked + .window:not(.maxi)")[0];if(null!=e){var t=window.innerHeight-150,n=e.querySelector(".content");n.scrollHeight;n.style.maxHeight=t+"px"}},pagr_Windows.get=function(e){var t=pagr_Windows.winMap,n="toggle-window-"+e.toLowerCase(),a=t;return null!=__map_reserved[n]?a.getReserved(n):a.h[n]},pagr_Windows.init=function(){for(var e=0,t=pagr_Dom.query(".windows .window");e<t.length;){var n=t[e];++e;var a=pagr_Windows.winMap,r=n.previousElementSibling.id.toLowerCase(),i=a;null!=__map_reserved[r]?i.setReserved(r,n):i.h[r]=n}pagr__$Dom_Query_$Impl_$.on(".toggle-window","click",null,function(e){var t=e.at.checked,n=pagr_Windows.winMap,a=e.at.id.toLowerCase(),r=n,i=null!=__map_reserved[a]?r.getReserved(a):r.h[a],o='nav ul li label[for="'+i.previousElementSibling.id+'"]',s=pagr_Dom.query(o)[0];if(null!=i){new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay(function(){i.classList.toggle("active",t),null!=s&&s.classList.toggle("active",t)},0),$bind($_,$_.stop)))}t&&pagr_Windows.handleResize()}),pagr_Dom.on(window,"resize",null,tink_core__$Callback_Callback_$Impl_$.fromNiladic(pagr_Windows.handleResize));var o=null;pagr__$Dom_Query_$Impl_$.on(".top-menu label","click",null,function(e){var t="#"+e.at.htmlFor,n=pagr_Dom.query(t)[0];null!=o&&o!=n&&o.checked&&(o.checked=!1),o=n})};var pagr_modes_ModeController=function(e){this.sidebarToggled=!1;var t=this;this._changed=new tink_core_SignalTrigger,this.changed=this._changed,this.app=e,this.draw=new dua_modes_drawing_DrawMode(e,"draw",.5,["#90d7f1","#f2dd5e","#e194c0"]),this.line=new dua_modes_drawing_DrawMode(e,"line",1,["#000000","#ec2224","#8ec74e"]),this.notes=new dua_modes_Notes(e),this.selectMove=new dua_modes_SelectMove(e),this.sidebarToggler=pagr_Dom.query("#toggle-aside-section")[0],this.selectAll=new dua_modes_SelectAll(e),this.get_changed().handle(function(e){"line"!=e&&"draw"!=e&&"notes"!=e&&"selectAll"!=e||t.set_annotation(!0)}),e.pages.get_navigated().handle(function(e){"selectAll"==t.get_mode()&&t.set_mode(null)}),this.set_annotation(!0),this.set_interactive(!0),pagr__$Dom_Query_$Impl_$.on("[data-pagr-annotation]","click",null,function(e){t.onAnnotationToggle(!t.get_annotation())}),pagr__$Dom_Query_$Impl_$.on("[data-pagr-interactive]","click",null,tink_core__$Callback_Callback_$Impl_$.fromNiladic($bind(this,this.onInteractiveToggle))),pagr__$Dom_Query_$Impl_$.on('.ctrl-search >input[type="checkbox"]',"change",null,function(e){!t.get_interactive()&&e.at.checked&&t.onInteractiveToggle()}),this.sidebarToggler.click(),pagr_Dom.on(this.sidebarToggler,"click",null,tink_core__$Callback_Callback_$Impl_$.fromNiladic(function(){t.sidebarToggled||t.get_interactive()||t.onInteractiveToggle(),t.sidebarToggled=!1})),pagr__$Dom_Query_$Impl_$.on('aside.menu.button.active li[data-layer^="layer"]',"click",null,function(e){if(!t.get_interactive()){new tink_core__$Callback_SimpleLink(($_=haxe_Timer.delay($bind(t,t.onInteractiveToggle),1),$bind($_,$_.stop)))}})};pagr_modes_ModeController.__name__=["pagr","modes","ModeController"],pagr_modes_ModeController.prototype={_changed:null,changed:null,app:null,notes:null,selectAll:null,sidebarToggler:null,sidebarToggled:null,onInteractiveToggle:function(){var e=!this.get_interactive();this.set_interactive(e);for(var t=0,n=pagr_Dom.query(".annotation-layers >div");t<n.length;){var a=n[t];++t;a.offsetHeight;a.classList.toggle("animate",e)}if(!e){this.onAnnotationToggle(e);for(var r=0,i=pagr_Dom.query(".annotation-layers .anchor.active");r<i.length;){var o=i[r];++r,o.click()}}null!=pagr_Dom.query("aside.menu.rubric")[0]&&this.sidebarToggler.checked!=e&&(this.sidebarToggled=!0,this.sidebarToggler.click()),this.handleAnchors(e)},onAnnotationToggle:function(e){if(this.set_annotation(e),!e){var t="selectMove";this.app.set_mode(t);for(var n=".draw-layer [data-guid].active",a=0,r=pagr_Dom.query(n);a<r.length;){var i=r[a];++a,i.classList.remove("active")}}},handleAnchors:function(e){for(var t=[],n=0,a=pagr_Dom.query("aside.menu.active")[0].attributes;n<a.length;){var r=a[n];++n,StringTools.startsWith(r.name,"data-layer-")&&t.push(r.name)}for(var i=t,o=0;o<i.length;){var s=i[o];++o,e?this.app.get_root().setAttribute(s,""):this.app.get_root().removeAttribute(s)}},get_changed:function(){return this.changed},get_mode:function(){var e=this.app.get_root().getAttribute("data-mode");switch(e){case"delete":case"draw":case"line":case"notes":case"selectAll":case"selectMove":var t=e;return t;default:return null}},set_mode:function(e){var t=this.get_mode();if(t!=e){var n=pagr_Dom.query('[data-pagr-mode="'+t+'"].active ~ div.active')[0];null!=n&&n.classList.remove("active"),this.app.get_root().setAttribute("data-mode",e),tink_core__$Callback_CallbackList_$Impl_$.invoke(this._changed.handlers,e)}return e},get_annotation:function(){return"on"==this.app.get_root().getAttribute("data-annotation")},set_annotation:function(e){return this.app.get_root().setAttribute("data-annotation",e?"on":"off"),e&&this.notes.updateNotesPosition(),e},get_interactive:function(){return"on"==this.app.get_root().getAttribute("data-book-interactive")},set_interactive:function(e){return this.app.get_root().setAttribute("data-book-interactive",e?"on":"off"),e||this.set_annotation(!1),e},__class__:pagr_modes_ModeController};var tink_core__$Callback_Callback_$Impl_$={};tink_core__$Callback_Callback_$Impl_$.__name__=["tink","core","_Callback","Callback_Impl_"],tink_core__$Callback_Callback_$Impl_$.fromNiladic=function(e){var t=function(t){e()};return t},tink_core__$Callback_Callback_$Impl_$.defer=function(e){haxe_Timer.delay(e,0)};var tink_core__$Callback_ListCell=function(e,t){if(null==e)throw new js__$Boot_HaxeError("callback expected but null received");this.cb=e,this.list=t};tink_core__$Callback_ListCell.__name__=["tink","core","_Callback","ListCell"],tink_core__$Callback_ListCell.__interfaces__=[tink_core__$Callback_LinkObject],tink_core__$Callback_ListCell.prototype={list:null,cb:null,clear:function(){this.list=null,this.cb=null},dissolve:function(){var e=this.list;if(null!=e){var t=e;this.clear(),HxOverrides.remove(t,this)}},__class__:tink_core__$Callback_ListCell};var tink_core__$Callback_CallbackList_$Impl_$={};tink_core__$Callback_CallbackList_$Impl_$.__name__=["tink","core","_Callback","CallbackList_Impl_"],tink_core__$Callback_CallbackList_$Impl_$.add=function(e,t){var n=new tink_core__$Callback_ListCell(t,e);return e.push(n),n},tink_core__$Callback_CallbackList_$Impl_$.invoke=function(e,t){for(var n=0,a=e.slice();n<a.length;){var r=a[n];++n,null!=r.cb&&r.cb(t)}},tink_core__$Callback_CallbackList_$Impl_$.clear=function(e){for(var t=0,n=e.splice(0,e.length);t<n.length;){var a=n[t];++t,a.clear()}};var tink_core_TypedError=function(e,t,n){null==e&&(e=500),this.code=e,this.message=t,this.pos=n,this.exceptionStack=[],this.callStack=[]};tink_core_TypedError.__name__=["tink","core","TypedError"],tink_core_TypedError.withData=function(e,t,n,a){return tink_core_TypedError.typed(e,t,n,a)},tink_core_TypedError.typed=function(e,t,n,a){var r=new tink_core_TypedError(e,t,a);return r.data=n,r},tink_core_TypedError.catchExceptions=function(e,t,n){try{return tink_core_Outcome.Success(e())}catch(a){if(a instanceof js__$Boot_HaxeError&&(a=a.val),js_Boot.__instanceof(a,tink_core_TypedError)){var r=a;return tink_core_Outcome.Failure(r)}var i=a;return tink_core_Outcome.Failure(null==t?tink_core_TypedError.withData(null,"Unexpected Error",i,n):t(i))}},tink_core_TypedError.reporter=function(e,t,n){return function(a){return tink_core_TypedError.withData(e,t,a,n)}},tink_core_TypedError.rethrow=function(e){throw js__$Boot_HaxeError.wrap(e)},tink_core_TypedError.prototype={message:null,code:null,data:null,pos:null,callStack:null,exceptionStack:null,printPos:function(){return this.pos.className+"."+this.pos.methodName+":"+this.pos.lineNumber},toString:function(){var e="Error#"+this.code+": "+this.message;return null!=this.pos&&(e+=" @ "+this.printPos()),e},throwSelf:function(){throw new js__$Boot_HaxeError(this)},__class__:tink_core_TypedError};var tink_core__$Future_Future_$Impl_$={};tink_core__$Future_Future_$Impl_$.__name__=["tink","core","_Future","Future_Impl_"],tink_core__$Future_Future_$Impl_$.flatten=function(e){return new tink_core__$Future_NestedFuture(e)},tink_core__$Future_Future_$Impl_$.ofMany=function(e,t){null==t&&(t=!0);for(var n=new tink_core__$Future_SyncFuture(new tink_core__$Lazy_LazyConst([])),a=0;a<e.length;){var r=[e[a]];++a;var i=n.flatMap(function(e){return function(t){var n=function(){return function(e){return t.concat([e])}}(),a=e[0].map(n);return a}}(r));n=i}return t?n.gather():n},tink_core__$Future_Future_$Impl_$.fromMany=function(e){return tink_core__$Future_Future_$Impl_$.ofMany(e)},tink_core__$Future_Future_$Impl_$.async=function(e,t){if(null==t&&(t=!1),t){var n=e;return tink_core__$Future_Future_$Impl_$.flatten(new tink_core__$Future_SyncFuture(new tink_core__$Lazy_LazyFunc(function(){return tink_core__$Future_Future_$Impl_$.async(n,!1)})))}var a=new tink_core_FutureTrigger;return e($bind(a,a.trigger)),a};var tink_core__$Future_FutureObject=function(){};tink_core__$Future_FutureObject.__name__=["tink","core","_Future","FutureObject"],tink_core__$Future_FutureObject.prototype={map:null,flatMap:null,handle:null,gather:null,__class__:tink_core__$Future_FutureObject};var tink_core__$Future_SyncFuture=function(e){this.value=e};tink_core__$Future_SyncFuture.__name__=["tink","core","_Future","SyncFuture"],tink_core__$Future_SyncFuture.__interfaces__=[tink_core__$Future_FutureObject],tink_core__$Future_SyncFuture.prototype={value:null,map:function(e){return new tink_core__$Future_SyncFuture(this.value.map(e))},flatMap:function(e){return new tink_core__$Future_LazyFuture(this.value.map(e))},handle:function(e){return e(this.value.get()),null},gather:function(){return this},__class__:tink_core__$Future_SyncFuture};var tink_core__$Future_LazyFuture=function(e){this.l=e};tink_core__$Future_LazyFuture.__name__=["tink","core","_Future","LazyFuture"],tink_core__$Future_LazyFuture.__interfaces__=[tink_core__$Future_FutureObject],tink_core__$Future_LazyFuture.prototype={l:null,map:function(e){return new tink_core__$Future_LazyFuture(this.l.map(function(t){var n=t.map(e);return n.gather()}))},flatMap:function(e){return new tink_core__$Future_LazyFuture(this.l.map(function(t){var n=t.flatMap(e);return n.gather()}))},handle:function(e){return this.l.get().handle(e)},gather:function(){return new tink_core__$Future_LazyFuture(this.l.map(function(e){return e.gather()}))},__class__:tink_core__$Future_LazyFuture};var tink_core__$Future_SimpleFuture=function(e){this.f=e};tink_core__$Future_SimpleFuture.__name__=["tink","core","_Future","SimpleFuture"],tink_core__$Future_SimpleFuture.__interfaces__=[tink_core__$Future_FutureObject],tink_core__$Future_SimpleFuture.prototype={f:null,handle:function(e){return this.f(e)},map:function(e){var t=this;return new tink_core__$Future_SimpleFuture(function(n){return t.f(function(t){var a=e(t);n(a)})})},flatMap:function(e){var t=e,n=this;return tink_core__$Future_Future_$Impl_$.flatten(new tink_core__$Future_SimpleFuture(function(e){return n.f(function(n){var a=t(n);e(a)})}))},gather:function(){return tink_core_FutureTrigger.gatherFuture(this)},__class__:tink_core__$Future_SimpleFuture};var tink_core__$Future_NestedFuture=function(e){this.outer=e};tink_core__$Future_NestedFuture.__name__=["tink","core","_Future","NestedFuture"],tink_core__$Future_NestedFuture.__interfaces__=[tink_core__$Future_FutureObject],tink_core__$Future_NestedFuture.prototype={outer:null,map:function(e){var t=this.outer.flatMap(function(t){var n=t.map(e);return n.gather()});return t.gather()},flatMap:function(e){var t=this.outer.flatMap(function(t){var n=t.flatMap(e);return n.gather()});return t.gather()},gather:function(){return tink_core_FutureTrigger.gatherFuture(this)},handle:function(e){var t=null;return t=this.outer.handle(function(n){t=n.handle(function(t){e(t)})})},__class__:tink_core__$Future_NestedFuture};var tink_core_FutureTrigger=function(){var e=[];this.list=e};tink_core_FutureTrigger.__name__=["tink","core","FutureTrigger"],tink_core_FutureTrigger.__interfaces__=[tink_core__$Future_FutureObject],tink_core_FutureTrigger.gatherFuture=function(e){var t=null,n=new tink_core__$Future_SimpleFuture(function(n){return null==t&&(t=new tink_core_FutureTrigger,e.handle($bind(t,t.trigger)),e=null),t.handle(n)});return n},tink_core_FutureTrigger.prototype={result:null,list:null,handle:function(e){var t=this.list;if(null==t)return e(this.result),null;var n=t;return tink_core__$Callback_CallbackList_$Impl_$.add(n,e)},map:function(e){var t=this.list;if(null==t)return new tink_core__$Future_SyncFuture(new tink_core__$Lazy_LazyConst(e(this.result)));var n=new tink_core_FutureTrigger;return tink_core__$Callback_CallbackList_$Impl_$.add(this.list,function(t){var a=e(t);n.trigger(a)}),n},flatMap:function(e){var t=this.list;if(null==t)return e(this.result);var n=new tink_core_FutureTrigger;return tink_core__$Callback_CallbackList_$Impl_$.add(this.list,function(t){e(t).handle($bind(n,n.trigger))}),n},gather:function(){return this},trigger:function(e){if(null==this.list)return!1;var t=this.list;return this.list=null,this.result=e,tink_core_FutureTrigger.depth>=1e3?tink_core__$Callback_Callback_$Impl_$.defer(function(){tink_core_FutureTrigger.depth++,tink_core__$Callback_CallbackList_$Impl_$.invoke(t,e),tink_core__$Callback_CallbackList_$Impl_$.clear(t),tink_core_FutureTrigger.depth--}):(tink_core_FutureTrigger.depth++,tink_core__$Callback_CallbackList_$Impl_$.invoke(t,e),tink_core__$Callback_CallbackList_$Impl_$.clear(t),tink_core_FutureTrigger.depth--),!0},__class__:tink_core_FutureTrigger};var tink_core__$Lazy_LazyObject=function(){};tink_core__$Lazy_LazyObject.__name__=["tink","core","_Lazy","LazyObject"],tink_core__$Lazy_LazyObject.prototype={get:null,map:null,__class__:tink_core__$Lazy_LazyObject};var tink_core__$Lazy_LazyConst=function(e){this.value=e};tink_core__$Lazy_LazyConst.__name__=["tink","core","_Lazy","LazyConst"],tink_core__$Lazy_LazyConst.__interfaces__=[tink_core__$Lazy_LazyObject],tink_core__$Lazy_LazyConst.prototype={value:null,get:function(){return this.value},map:function(e){return new tink_core__$Lazy_LazyConst(e(this.value))},__class__:tink_core__$Lazy_LazyConst};var tink_core__$Lazy_LazyFunc=function(e){this.f=e};tink_core__$Lazy_LazyFunc.__name__=["tink","core","_Lazy","LazyFunc"],tink_core__$Lazy_LazyFunc.__interfaces__=[tink_core__$Lazy_LazyObject],tink_core__$Lazy_LazyFunc.prototype={f:null,result:null,get:function(){return null!=this.f&&(this.result=this.f(),this.f=null),this.result},map:function(e){var t=this;return new tink_core__$Lazy_LazyFunc(function(){var n=t.get();return e(n)})},__class__:tink_core__$Lazy_LazyFunc};var tink_core_Noise={__ename__:!0,__constructs__:["Noise"]};tink_core_Noise.Noise=["Noise",0],tink_core_Noise.Noise.toString=$estr,tink_core_Noise.Noise.__enum__=tink_core_Noise;var tink_core_Outcome={__ename__:!0,__constructs__:["Success","Failure"]};tink_core_Outcome.Success=function(e){var t=["Success",0,e];return t.__enum__=tink_core_Outcome,t.toString=$estr,t},tink_core_Outcome.Failure=function(e){var t=["Failure",1,e];return t.__enum__=tink_core_Outcome,t.toString=$estr,t};var tink_core_MPair=function(e,t){this.a=e,this.b=t};tink_core_MPair.__name__=["tink","core","MPair"],tink_core_MPair.prototype={a:null,b:null,__class__:tink_core_MPair};var tink_geom2__$Matrix_Matrix_$Impl_$={};tink_geom2__$Matrix_Matrix_$Impl_$.__name__=["tink","geom2","_Matrix","Matrix_Impl_"],tink_geom2__$Matrix_Matrix_$Impl_$.transformPoint=function(e,t){var n,a=new tink_core_MPair(e.a*t.a+e.c*t.b+e.tx,e.b*t.a+e.d*t.b+e.ty);return n=a},tink_geom2__$Matrix_Matrix_$Impl_$.concat=function(e,t){var n={a:t.a*e.a+t.c*e.b,b:t.b*e.a+t.d*e.b,c:t.a*e.c+t.c*e.d,d:t.b*e.c+t.d*e.d,tx:t.a*e.tx+t.c*e.ty+t.tx,ty:t.b*e.tx+t.d*e.ty+t.ty};return n},tink_geom2__$Matrix_Matrix_$Impl_$.scale=function(e,t){var n={a:t,b:0,c:0,d:t,tx:0,ty:0};return tink_geom2__$Matrix_Matrix_$Impl_$.concat(e,n)},tink_geom2__$Matrix_Matrix_$Impl_$.move=function(e,t){var n={a:1,b:0,c:0,d:1,tx:t.a,ty:t.b};return tink_geom2__$Matrix_Matrix_$Impl_$.concat(e,n)},tink_geom2__$Matrix_Matrix_$Impl_$.toString=function(e){return"matrix("+e.a+", "+e.b+", "+e.c+", "+e.d+", "+e.tx+", "+e.ty+")"};var utils_GUID=function(){};utils_GUID.__name__=["utils","GUID"],utils_GUID.rand=function(e,t){null==t&&(t=61),t>utils_GUID.CHARS.length&&(t=utils_GUID.CHARS.length);for(var n=[],a=0,r=e;a<r;){a++;n.push(Std.random(t))}return n.join("")},utils_GUID.create=function(){return utils_GUID.rand(4,66)+utils_GUID.rand(4,66)+utils_GUID.rand(4,66)+utils_GUID.rand(5,60)+utils_GUID.rand(5,60)};var utils_Helper=function(){};utils_Helper.__name__=["utils","Helper"],utils_Helper.debounce=function(e,t,n){var a=utils_Helper.timers,r=null!=__map_reserved[e]?a.getReserved(e):a.h[e];null!=r&&r.stop(),r=new haxe_Timer(n),r.run=function(){r.stop(),t()};var i=utils_Helper.timers;null!=__map_reserved[e]?i.setReserved(e,r):i.h[e]=r},utils_Helper.mergeInto=function(e,t){for(var n=0,a=Reflect.fields(t);n<a.length;){var r=a[n];++n;var i=Reflect.field(t,r);!Reflect.isObject(i)||"string"==typeof i||i instanceof Array&&null==i.__enum__||null==Reflect.field(e,r)?e[r]=i:utils_Helper.mergeInto(Reflect.field(e,r),i)}},utils_Helper.merge=function(e,t){var n=Reflect.copy(t);return utils_Helper.mergeInto(n,e),n};var utils_Sheet=function(){this.extraSheet=null,this.extraRules=[];var e=window.document.createElement("style");e.appendChild(window.document.createTextNode("")),window.document.head.appendChild(e),this.extraSheet=e.sheet||e.styleSheet};utils_Sheet.__name__=["utils","Sheet"],utils_Sheet.prototype={extraRules:null,extraSheet:null,removeRule:function(e){var t,n=this.extraRules[e];if(null!=n){this.extraSheet.deleteRule(n),this.extraRules[e]=null,t=this.extraRules.length;
for(var a=0,r=t;a<r;){var i=a++;this.extraRules[i]>n&&this.extraRules[i]--}}},addCssRule:function(e,t){var n=this,a=this.extraRules.length;return this.extraRules[a]=this.extraSheet.cssRules.length,this.extraSheet.addRule?this.extraSheet.addRule(e,t):this.extraSheet.insertRule(e+"{"+t+"}",this.extraRules[a]),{get:function(e){var t=n.extraRules[a];return n.extraSheet.cssRules[t].style[e]},set:function(e,t){var r=n.extraRules[a];null!=r&&n.extraSheet.cssRules[r].style.setProperty(e,t)},remove:function(){n.removeRule(a)}}},__class__:utils_Sheet};var $_,$fid=0;String.prototype.__class__=String,String.__name__=["String"],Array.__name__=["Array"],Date.prototype.__class__=Date,Date.__name__=["Date"];var Int={__name__:["Int"]},Dynamic={__name__:["Dynamic"]},Float=Number;Float.__name__=["Float"];var Bool=Boolean;Bool.__ename__=["Bool"];var Class={__name__:["Class"]},Enum={},prefixes=["moz","webkit","ms"],obj=Object,fields=function(e){var t=[];for(var n in e)t.push(n);return t},copy=function(source,target){for(var _g=0,_g1=fields(source);_g<_g1.length;){var f=_g1[_g];++_g;for(var _g2=0;_g2<prefixes.length;){var p=prefixes[_g2];if(++_g2,StringTools.startsWith(f,p)){var name=HxOverrides.substr(f,p.length,1).toLowerCase()+HxOverrides.substr(f,p.length+1,null);null==obj.getOwnPropertyDescriptor(target,name)&&obj.defineProperty(target,name,{get:eval("(function () { return this."+f+"; })"),set:eval("(function (param) { this."+f+" = param; })")})}}}},dummy=window.document.createElement("div");copy(dummy,HTMLElement.prototype),dummy.requestFullScreen&&(HTMLElement.prototype.requestFullscreen=dummy.requestFullScreen),copy(dummy.style,CSSStyleDeclaration.prototype),copy(window.document,window.document),window.document.mozCancelFullScreen&&(window.document.exitFullscreen=window.document.mozCancelFullScreen),null==HTMLElement.prototype.matches&&(HTMLElement.prototype.matches=HTMLElement.prototype.matchesSelector);var __map_reserved={},ArrayBuffer=$global.ArrayBuffer||js_html_compat_ArrayBuffer;null==ArrayBuffer.prototype.slice&&(ArrayBuffer.prototype.slice=js_html_compat_ArrayBuffer.sliceImpl);var Uint8Array=$global.Uint8Array||js_html_compat_Uint8Array._new;DateTools.DAY_SHORT_NAMES=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],DateTools.DAY_NAMES=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],DateTools.MONTH_SHORT_NAMES=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],DateTools.MONTH_NAMES=["January","February","March","April","May","June","July","August","September","October","November","December"],Outline.ccw=function(e){var t,n=Math.PI/2,a={a:Math.cos(n),b:-Math.sin(n),c:Math.sin(n),d:Math.cos(n),tx:0,ty:0};return t=a}(this),Outline.cw=function(e){var t,n=-Math.PI/2,a={a:Math.cos(n),b:-Math.sin(n),c:Math.sin(n),d:Math.cos(n),tx:0,ty:0};return t=a}(this),Outline.sq2=Math.sqrt(2),Xml.Element=0,Xml.PCData=1,Xml.CData=2,Xml.Comment=3,Xml.DocType=4,Xml.ProcessingInstruction=5,Xml.Document=6,pagr_Dom.helper=window.document.createElement("div"),pagr_Dom.counter=0,dua_ConfirmDialog.window=pagr_Dom.query(".window.error.confirm")[0],dua_ConfirmDialog.confirmBtn=pagr_Dom.query('[type="submit"]',dua_ConfirmDialog.window)[0],dua_ConfirmDialog.cancelBtn=pagr_Dom.query('[type="reset"]',dua_ConfirmDialog.window)[0],dua_ConfirmDialog.msgEl=pagr_Dom.query(".message",dua_ConfirmDialog.window)[0],dua_ConfirmDialog.detailsEl=pagr_Dom.query(".details",dua_ConfirmDialog.window)[0],dua_ConfirmDialog.toggler=pagr_Dom.query("#toggle-window-confirm")[0],pagr_App.OPTIMAL_DENSITY=.6666666666666666,pagr_App.MINIMAL_DENSITY=.5,pagr_App.DEVICE_PIXEL_RATIO=window.devicePixelRatio>0?window.devicePixelRatio:1,pagr_App.platform=function(e){for(var t,n="win,ipad,iphone,ipod,mac,android,linux".split(","),a=n.pop(),r=window.navigator.platform.toLowerCase(),i=0;i<n.length;){var o=n[i];if(++i,StringTools.startsWith(r,o)){a=o;break}}return t=a}(this),pagr_App.isIos=function(e){var t,n=pagr_App.platform;return t=function(e){var t;switch(n){case"ipad":case"iphone":case"ipod":t=!0;break;default:t=!1}return t}(e)}(this),pagr_App.isTouchDevice="undefined"!=typeof window.ontouchstart||window.navigator.maxTouchPoints,pagr_App.runtime=window.KlettRuntime,pagr_App.epd=!1,dua_SettingsLoader.DEFAULT={productInfo:{title:"Klett Dua",subtitle:"",productNumber:"<UNDEFINED>",productForm:"<UNDEFINED>",appVersion:"<UNDEFINED>",projectId:"<UNDEFINED>"},tracking:{file:"",enabled:!1,includeIds:!1},logo:"imgs/logo_klett.png",onlineCheck:{url:"https://annotation.klett.de/annotation/rest/api-docs",interval:4,enabled:!1},expiration:{redirectUrl:"<UNDEFINED>",enabled:!1},content:{menu:[{type:"rubric",hasNews:!0,filter:null,title:"DUA"},{type:"button",hasNews:!1,title:"SLA",filter:null}]},copyright:"Ernst Klett Verlag GmbH, Stuttgart",annotations:{overwritable:!1,enabled:!0,sync:{allowed:!1,enabled:!1,redirectUrl:"<UNDEFINED>",server:{baseUrl:"<UNDEFINED>",baseParameter:{bookshelfId:"<UNDEFINED>",mandant:"<UNDEFINED>",version:"<UNDEFINED>",dienstId:"<UNDEFINED>",dienstPassword:"<UNDEFINED>"},httpAuth:{enabled:!1,user:"<UNDEFINED>",password:"<UNDEFINED>"},apiKey:"<UNDEFINED>"},supportEmail:"support@klett.de"}},usePdfOnIOS:{overwritable:!0,enabled:!0},newsService:{overwritable:!0,enabled:!1,baseUrl:"<UNDEFINED>"},sidebar:{overwritable:!0,enabled:!0},cloudIcon:{overwritable:!0,enabled:!0,link:"<UNDEFINED>"},tooltips:{overwritable:!0,enabled:!0},pageTransition3d:{overwritable:!0,enabled:!0},rememberLastPage:{overwritable:!0,enabled:!0},search:{overwritable:!0,enabled:!0},closeDialogue:{overwritable:!1,enabled:!1}},js_Boot.__toStr={}.toString,dua__$_$impl_Confirm.EXIT=function(e){var t,n=tink_template__$Html_Html_$Impl_$.buffer(),a='\n  <p>Möchten Sie das Programm schließen?</p>\n  <span class="settings"><input id="reopen" name="rememberLastPage" type="checkbox" data-pagr-bind="this.checked = pagr.settings.rememberLastPage.enabled"></span>\n  <label for="reopen" style="display: inline">Beim erneuten Starten des Programms wird diese Seite geöffnet.</label>\n';n.s+=a;var r=n.s;return t=r}(this),dua__$_$impl_Confirm.WANNA_SYNC=function(e){var t,n=tink_template__$Html_Html_$Impl_$.buffer(),a="\n  <p>Möchten Sie Ihre Notizen und Anmerkungen online synchronisieren?</p>\n  <p>Wenn Sie online synchronisieren, können Sie von überall auf Ihre Notizen und Anmerkungen zurückgreifen und diese bearbeiten.</p>\n";n.s+=a;var r=n.s;return t=r}(this),dua_annotations_ApiEndpoints.Create={method:"POST",url:"annotation",parser:function(e){return JSON.parse(e)}},dua_annotations_ApiEndpoints.Read={method:"POST",url:"annotationlist",parser:function(e){return JSON.parse(e)}},dua_annotations_ApiEndpoints.Update={method:"PUT",url:"annotation",parser:function(e){return JSON.parse(e)}},dua_annotations_ApiEndpoints.Delete={method:"DELETE",url:"annotation",parser:function(e){return JSON.parse(e)}},dua_modes_Notes.ANNOTATION_TYPE="dua_notice",dua_modes__$_$impl_NotesUI.COLORS=function(e){var t,n=new haxe_ds_StringMap;return null!=__map_reserved["#90d7f1"]?n.setReserved("#90d7f1","color1"):n.h["#90d7f1"]="color1",null!=__map_reserved["#feee8e"]?n.setReserved("#feee8e","color2"):n.h["#feee8e"]="color2",null!=__map_reserved["#e194c0"]?n.setReserved("#e194c0","color3"):n.h["#e194c0"]="color3",t=n}(this),dua_modes_drawing_Drawing.map=new haxe_ds_StringMap,dua_modes_drawing_DrawingCanvas.store=dua_annotations_AnnotationStore.getInstance(),haxe_xml_Parser.escapes=function(e){var t,n=new haxe_ds_StringMap;return null!=__map_reserved.lt?n.setReserved("lt","<"):n.h.lt="<",null!=__map_reserved.gt?n.setReserved("gt",">"):n.h.gt=">",null!=__map_reserved.amp?n.setReserved("amp","&"):n.h.amp="&",null!=__map_reserved.quot?n.setReserved("quot",'"'):n.h.quot='"',null!=__map_reserved.apos?n.setReserved("apos","'"):n.h.apos="'",t=n}(this),js_html_compat_Uint8Array.BYTES_PER_ELEMENT=1,pagr_Tooltip.layer=pagr_Dom.query(".tooltip-layer")[0],pagr_Tooltip.idCounter=0,pagr_Windows.winMap=new haxe_ds_StringMap,tink_core_FutureTrigger.depth=0,tink_geom2__$Matrix_Matrix_$Impl_$.IDENTITY=function(e){var t,n={a:1,b:0,c:0,d:1,tx:0,ty:0};return t=n}(this),utils_GUID.CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",utils_Helper.timers=new haxe_ds_StringMap,dua_Dua.main()}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this);